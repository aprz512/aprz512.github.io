<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: true,
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="1. 核心模块 “Since the functions in the C runtime library are not part of the Win32 API, we believe the number of applications that will be affected by this bug to be very limited.” - Microsoft, January">
<meta property="og:type" content="website">
<meta property="og:title" content="python 核心模块">
<meta property="og:url" content="http://aprz512.github.io/temp/python核心模块.html">
<meta property="og:site_name" content="二手程序员">
<meta property="og:description" content="1. 核心模块 “Since the functions in the C runtime library are not part of the Win32 API, we believe the number of applications that will be affected by this bug to be very limited.” - Microsoft, January">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-06-07T07:55:24.618Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python 核心模块">
<meta name="twitter:description" content="1. 核心模块 “Since the functions in the C runtime library are not part of the Win32 API, we believe the number of applications that will be affected by this bug to be very limited.” - Microsoft, January">
  <link rel="canonical" href="http://aprz512.github.io/temp/python核心模块">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>
<link href="https://fonts.loli.net/css?family=EB+Garamond:400,400i,700,700i|Noto+Serif+SC:400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet">

  <title>python 核心模块 | 二手程序员</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-right">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">二手程序员</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">吹灭读书灯，一身都是月。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">22</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">14</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">204</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  

</nav>
  <div class="site-search">
    
  <div class="popup search-popup">
  <div class="search-header">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <div class="search-input-wrapper">
      <input autocomplete="off" autocorrect="off" autocapitalize="none"
             placeholder="搜索..." spellcheck="false"
             type="text" id="search-input">
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
  <div id="search-result"></div>
</div>


  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">python 核心模块

</h1>

<div class="post-meta">
  

</div>

</header>

      
      
      
      <div class="post-body">
        
          <hr>
<h1 id="1-核心模块"><a href="#1-核心模块" class="headerlink" title="1. 核心模块"></a>1. 核心模块</h1><ul>
<li>“Since the functions in the C runtime library are not part of the Win32 API, we believe the number of applications that will be affected by this bug to be very limited.” - Microsoft, January 1999</li>
</ul>
<hr>
  <a id="more"></a>

<h2 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1. 介绍"></a>1.1. 介绍</h2><p>  Python 的标准库包括了很多的模块, 从 Python 语言自身特定的类型和声明, 到一些只用于少数程序的不著名的模块.</p>
<p>  本章描述了一些基本的标准库模块. 任何大型 Python 程序都有可能直接或间接地使用到这类模块的大部分.</p>
<h3 id="1-1-1-内建函数和异常"><a href="#1-1-1-内建函数和异常" class="headerlink" title="1.1.1. 内建函数和异常"></a>1.1.1. 内建函数和异常</h3><p>  下面的这两个模块比其他模块加在一起还要重要: 定义内建函数(例如 len, int, range …)的 <code>_ _builtin_ _</code> 模块, 以及定义所有内建异常的 <code>exceptions</code> 模块.</p>
<p>  Python 在启动时导入这两个模块, 使任何程序都能够使用它们.</p>
<h3 id="1-1-2-操作系统接口模块"><a href="#1-1-2-操作系统接口模块" class="headerlink" title="1.1.2. 操作系统接口模块"></a>1.1.2. 操作系统接口模块</h3><p>  Python 有许多使用了 POSIX 标准 API 和标准 C 语言库的模块. 它们为底层操作系统提供了平台独立的接口.</p>
<p>  这类的模块包括: 提供文件和进程处理功能的 <code>os</code> 模块; 提供平台独立的文件名处理 (分拆目录名, 文件名, 后缀等)的 <code>os.path</code> 模块; 以及时间日期处理相关的 <code>time/datetime</code>模块.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!Feather注: datetime 为 Py2.3 新增模块, 提供增强的时间处理方法 ]</span><br></pre></td></tr></table></figure>

<p>  延伸一点说, 网络和线程模块同样也可以归为这一个类型. 不过 Python 并没有在所有的平台/版本实现这些.</p>
<h3 id="1-1-3-类型支持模块"><a href="#1-1-3-类型支持模块" class="headerlink" title="1.1.3. 类型支持模块"></a>1.1.3. 类型支持模块</h3><p>  标准库里有许多用于支持内建类型操作的库. <code>string</code> 模块实现了常用的字符串处理.<code>math</code> 模块提供了数学计算操作和常量(pi, e都属于这类常量), <code>cmath</code> 模块为复数提供了和 <code>math</code> 一样的功能.</p>
<h3 id="1-1-4-正则表达式"><a href="#1-1-4-正则表达式" class="headerlink" title="1.1.4. 正则表达式"></a>1.1.4. 正则表达式</h3><p>  <code>re</code> 模块为 Python 提供了正则表达式支持. 正则表达式是用于匹配字符串或特定子字符串的 有特定语法的字符串模式.</p>
<h3 id="1-1-5-语言支持模块"><a href="#1-1-5-语言支持模块" class="headerlink" title="1.1.5. 语言支持模块"></a>1.1.5. 语言支持模块</h3><p>  sys 模块可以让你访问解释器相关参数,比如模块搜索路径,解释器版本号等. <code>operator</code>模块提供了和内建操作符作用相同的函数. <code>copy</code> 模块允许 你复制对象, Python 2.0 新加入的 <code>gc</code> 模块提供了对垃圾收集的相关控制功能.</p>
<hr>
<h2 id="1-2-builtin-模块"><a href="#1-2-builtin-模块" class="headerlink" title="1.2. _ builtin _ 模块"></a>1.2. _ <em>builtin</em> _ 模块</h2><p>  这个模块包含 Python 中使用的内建函数. 一般不用手动导入这个模块; Python会帮你做好一切.</p>
<h3 id="1-2-1-使用元组或字典中的参数调用函数"><a href="#1-2-1-使用元组或字典中的参数调用函数" class="headerlink" title="1.2.1. 使用元组或字典中的参数调用函数"></a>1.2.1. 使用元组或字典中的参数调用函数</h3><p>  Python允许你实时地创建函数参数列表. 只要把所有的参数放入一个元组中， 然后通过内建的 <code>apply</code> 函数调用函数. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-1" target="_blank" rel="noopener">Example 1-1</a>.</p>
<h4 id="1-2-1-1-Example-1-1-使用-apply-函数"><a href="#1-2-1-1-Example-1-1-使用-apply-函数" class="headerlink" title="1.2.1.1. Example 1-1. 使用 apply 函数"></a>1.2.1.1. Example 1-1. 使用 apply 函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-apply-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> a, b</span><br><span class="line"></span><br><span class="line">apply(function, (<span class="string">"whither"</span>, <span class="string">"canada?"</span>))</span><br><span class="line">apply(function, (<span class="number">1</span>, <span class="number">2</span> + <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">whither canada?</span><br><span class="line"><span class="number">1</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>  要想把关键字参数传递给一个函数, 你可以将一个字典作为 <code>apply</code> 函数的第 3 个参数,参考 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-2" target="_blank" rel="noopener">Example 1-2</a>.</p>
<h4 id="1-2-1-2-Example-1-2-使用-apply-函数传递关键字参数"><a href="#1-2-1-2-Example-1-2-使用-apply-函数传递关键字参数" class="headerlink" title="1.2.1.2. Example 1-2. 使用 apply 函数传递关键字参数"></a>1.2.1.2. Example 1-2. 使用 apply 函数传递关键字参数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-apply-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> a, b</span><br><span class="line"></span><br><span class="line">apply(function, (<span class="string">"crunchy"</span>, <span class="string">"frog"</span>))</span><br><span class="line">apply(function, (<span class="string">"crunchy"</span>,), &#123;<span class="string">"b"</span>: <span class="string">"frog"</span>&#125;)</span><br><span class="line">apply(function, (), &#123;<span class="string">"a"</span>: <span class="string">"crunchy"</span>, <span class="string">"b"</span>: <span class="string">"frog"</span>&#125;)</span><br><span class="line"></span><br><span class="line">crunchy frog</span><br><span class="line">crunchy frog</span><br><span class="line">crunchy frog</span><br></pre></td></tr></table></figure>

<p>  <code>apply</code> 函数的一个常见用法是把构造函数参数从子类传递到基类, 尤其是构造函数需要接受很多参数的时候. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-3" target="_blank" rel="noopener">Example 1-3</a> 所示.</p>
<h4 id="1-2-1-3-Example-1-3-使用-apply-函数调用基类的构造函数"><a href="#1-2-1-3-Example-1-3-使用-apply-函数调用基类的构造函数" class="headerlink" title="1.2.1.3. Example 1-3. 使用 apply 函数调用基类的构造函数"></a>1.2.1.3. Example 1-3. 使用 apply 函数调用基类的构造函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-apply-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, color=<span class="string">"white"</span>, width=<span class="number">10</span>, height=<span class="number">10</span>)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"create a"</span>, color, self, <span class="string">"sized"</span>, width, <span class="string">"x"</span>, height</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoundedRectangle</span><span class="params">(Rectangle)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, **kw)</span>:</span></span><br><span class="line">        apply(Rectangle._ _init_ _, (self,), kw)</span><br><span class="line"></span><br><span class="line">rect = Rectangle(color=<span class="string">"green"</span>, height=<span class="number">100</span>, width=<span class="number">100</span>)</span><br><span class="line">rect = RoundedRectangle(color=<span class="string">"blue"</span>, height=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">create a green &lt;Rectangle instance at <span class="number">8</span>c8260&gt; sized <span class="number">100</span> x <span class="number">100</span></span><br><span class="line">create a blue &lt;RoundedRectangle instance at <span class="number">8</span>c84c0&gt; sized <span class="number">10</span> x <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>  Python 2.0 提供了另个方法来做相同的事. 你只需要使用一个传统的函数调用 , 使用 <code>*</code>来标记元组, <code>**</code> 来标记字典.</p>
<p>  下面两个语句是等价的:</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = function(*args, **kwargs)</span><br><span class="line">result = apply(function, args, kwargs)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-2-加载和重载模块"><a href="#1-2-2-加载和重载模块" class="headerlink" title="1.2.2. 加载和重载模块"></a>1.2.2. 加载和重载模块</h3><p>  如果你写过较庞大的 Python 程序, 那么你就应该知道 <code>import</code> 语句是用来导入外部模块的 (当然也可以使用 <code>from-import</code> 版本). 不过你可能不知道 <code>import</code> 其实是靠调用内建 函数 <code>_ _import_ _</code> 来工作的.</p>
<p>  通过这个戏法你可以动态地调用函数. 当你只知道模块名称(字符串)的时候, 这将很方便. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-4" target="_blank" rel="noopener">Example 1-4</a> 展示了这种用法, 动态地导入所有以 “<code>-plugin</code>“ 结尾的模块.</p>
<h4 id="1-2-2-1-Example-1-4-使用-import-函数加载模块"><a href="#1-2-2-1-Example-1-4-使用-import-函数加载模块" class="headerlink" title="1.2.2.1. Example 1-4. 使用 __import__函数加载模块"></a>1.2.2.1. Example 1-4. 使用 <code>__import__</code>函数加载模块</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-<span class="keyword">import</span>-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> glob, os</span><br><span class="line"></span><br><span class="line">modules = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> module_file <span class="keyword">in</span> glob.glob(<span class="string">"*-plugin.py"</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        module_name, ext = os.path.splitext(os.path.basename(module_file))</span><br><span class="line">        module = __import__(module_name)</span><br><span class="line">        modules.append(module)</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">pass</span> <span class="comment"># ignore broken modules</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># say hello to all modules</span></span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> modules:</span><br><span class="line">    module.hello()</span><br><span class="line"></span><br><span class="line">example-plugin says hello</span><br></pre></td></tr></table></figure>

<p>  注意这个 plug-in 模块文件名中有个 “-“ (hyphens). 这意味着你不能使用普通的 <code>import</code> 命令, 因为 Python 的辨识符不允许有 “-“ .</p>
<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-5" target="_blank" rel="noopener">Example 1-5</a> 展示了 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-4" target="_blank" rel="noopener">Example 1-4</a> 中使用的 plug-in .</p>
<h4 id="1-2-2-2-Example-1-5-Plug-in-例子"><a href="#1-2-2-2-Example-1-5-Plug-in-例子" class="headerlink" title="1.2.2.2. Example 1-5. Plug-in 例子"></a>1.2.2.2. Example 1-5. Plug-in 例子</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">File: example-plugin.py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"example-plugin says hello"</span></span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-6" target="_blank" rel="noopener">Example 1-6</a> 展示了如何根据给定模块名和函数名获得想要的函数对象.</p>
<h4 id="1-2-2-3-Example-1-6-使用-import-函数获得特定函数"><a href="#1-2-2-3-Example-1-6-使用-import-函数获得特定函数" class="headerlink" title="1.2.2.3. Example 1-6. 使用 __import__ 函数获得特定函数"></a>1.2.2.3. Example 1-6. 使用 <code>__import__</code> 函数获得特定函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-<span class="keyword">import</span>-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getfunctionbyname</span><span class="params">(module_name, function_name)</span>:</span></span><br><span class="line">    module = _ _import_ _(module_name)</span><br><span class="line">    <span class="keyword">return</span> getattr(module, function_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> repr(getfunctionbyname(<span class="string">"dumbdbm"</span>, <span class="string">"open"</span>))</span><br><span class="line"></span><br><span class="line">&lt;function open at <span class="number">794</span>fa0&gt;</span><br></pre></td></tr></table></figure>

<p>  你也可以使用这个函数实现延迟化的模块导入 (lazy module loading). 例如在 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-7" target="_blank" rel="noopener">Example 1-7</a> 中 的 <code>string</code> 模块只在第一次使用的时候导入.</p>
<h4 id="1-2-2-4-Example-1-7-使用-import-函数实现-延迟导入"><a href="#1-2-2-4-Example-1-7-使用-import-函数实现-延迟导入" class="headerlink" title="1.2.2.4. Example 1-7. 使用 __import__ 函数实现 延迟导入"></a>1.2.2.4. Example 1-7. 使用 <code>__import__</code> 函数实现 延迟导入</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-<span class="keyword">import</span>-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyImport</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, module_name)</span>:</span></span><br><span class="line">        self.module_name = module_name</span><br><span class="line">        self.module = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_getattr_</span> <span class="title">_</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.module <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.module = _ _import_ _(self.module_name)</span><br><span class="line">        <span class="keyword">return</span> getattr(self.module, name)</span><br><span class="line"></span><br><span class="line">string = LazyImport(<span class="string">"string"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> string.lowercase</span><br><span class="line"></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br></pre></td></tr></table></figure>

<p>  Python 也提供了重新加载已加载模块的基本支持. [Example 1-8 #eg-1-8 会加载 3 次 <em>hello.py</em> 文件.</p>
<h4 id="1-2-2-5-Example-1-8-使用-reload-函数"><a href="#1-2-2-5-Example-1-8-使用-reload-函数" class="headerlink" title="1.2.2.5. Example 1-8. 使用 reload 函数"></a>1.2.2.5. Example 1-8. 使用 reload 函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-reload-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hello</span><br><span class="line">reload(hello)</span><br><span class="line">reload(hello)</span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br></pre></td></tr></table></figure>

<p>  reload 直接接受模块作为参数.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!Feather 注:  ^ 原句无法理解, 稍后讨论.]</span><br></pre></td></tr></table></figure>

<p>  注意，当你重加载模块时, 它会被重新编译, 新的模块会代替模块字典里的老模块. 但是, 已经用原模块里的类建立的实例仍然使用的是老模块(不会被更新).</p>
<p>  同样地, 使用 <code>from-import</code> 直接创建的到模块内容的引用也是不会被更新的.</p>
<h3 id="1-2-3-关于名称空间"><a href="#1-2-3-关于名称空间" class="headerlink" title="1.2.3. 关于名称空间"></a>1.2.3. 关于名称空间</h3><p>  <code>dir</code> 返回由给定模块, 类, 实例, 或其他类型的所有成员组成的列表. 这可能在交互式 Python 解释器下很有用, 也可以用在其他地方. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-9" target="_blank" rel="noopener">Example 1-9</a>展示了 <code>dir</code> 函数的用法.</p>
<h4 id="1-2-3-1-Example-1-9-使用-dir-函数"><a href="#1-2-3-1-Example-1-9-使用-dir-函数" class="headerlink" title="1.2.3.1. Example 1-9. 使用 dir 函数"></a>1.2.3.1. Example 1-9. 使用 dir 函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-dir-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> value, <span class="string">"=&gt;"</span>, dir(value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">dump(<span class="number">0</span>)</span><br><span class="line">dump(<span class="number">1.0</span>)</span><br><span class="line">dump(<span class="number">0.0j</span>) <span class="comment"># complex number</span></span><br><span class="line">dump([]) <span class="comment"># list</span></span><br><span class="line">dump(&#123;&#125;) <span class="comment"># dictionary</span></span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line">dump(len) <span class="comment"># function</span></span><br><span class="line">dump(sys) <span class="comment"># module</span></span><br><span class="line"></span><br><span class="line">0 =&gt; []</span><br><span class="line">1.0 =&gt; []</span><br><span class="line">0j =&gt; ['conjugate', 'imag', 'real']</span><br><span class="line">[] =&gt; ['append', 'count', 'extend', 'index', 'insert',</span><br><span class="line">    <span class="string">'pop'</span>, <span class="string">'remove'</span>, <span class="string">'reverse'</span>, <span class="string">'sort'</span>]</span><br><span class="line">&#123;&#125; =&gt; ['clear', 'copy', 'get', 'has_key', 'items',</span><br><span class="line">    <span class="string">'keys'</span>, <span class="string">'update'</span>, <span class="string">'values'</span>]</span><br><span class="line">string =&gt; []</span><br><span class="line">&lt;built-in function len&gt; =&gt; ['_ _doc_ _', '_ _name_ _', '_ _self_ _']</span><br><span class="line">&lt;module 'sys' (built-in)&gt; =&gt; ['_ _doc_ _', '_ _name_ _',</span><br><span class="line">    <span class="string">'_ _stderr_ _'</span>, <span class="string">'_ _stdin_ _'</span>, <span class="string">'_ _stdout_ _'</span>, <span class="string">'argv'</span>,</span><br><span class="line">    <span class="string">'builtin_module_names'</span>, <span class="string">'copyright'</span>, <span class="string">'dllhandle'</span>,</span><br><span class="line">    <span class="string">'exc_info'</span>, <span class="string">'exc_type'</span>, <span class="string">'exec_prefix'</span>, <span class="string">'executable'</span>,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  在例子 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-10" target="_blank" rel="noopener">Example 1-10</a>中定义的 <code>getmember</code> 函数返回给定类定义的所有类级别的属性和方法.</p>
<h4 id="1-2-3-2-Example-1-10-使用-dir-函数查找类的所有成员"><a href="#1-2-3-2-Example-1-10-使用-dir-函数查找类的所有成员" class="headerlink" title="1.2.3.2. Example 1-10. 使用 dir 函数查找类的所有成员"></a>1.2.3.2. Example 1-10. 使用 dir 函数查找类的所有成员</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-dir-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getmembers</span><span class="params">(klass, members=None)</span>:</span></span><br><span class="line">    <span class="comment"># get a list of all class members, ordered by class</span></span><br><span class="line">    <span class="keyword">if</span> members <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        members = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> klass._ _bases_ _:</span><br><span class="line">        getmembers(k, members)</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> dir(klass):</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">not</span> <span class="keyword">in</span> members:</span><br><span class="line">            members.append(m)</span><br><span class="line">    <span class="keyword">return</span> members</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> getmembers(A)</span><br><span class="line"><span class="keyword">print</span> getmembers(B)</span><br><span class="line"><span class="keyword">print</span> getmembers(IOError)</span><br><span class="line"></span><br><span class="line">[<span class="string">'_ _doc_ _'</span>, <span class="string">'_ _module_ _'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]</span><br><span class="line">[<span class="string">'_ _doc_ _'</span>, <span class="string">'_ _module_ _'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br><span class="line">[<span class="string">'_ _doc_ _'</span>, <span class="string">'_ _getitem_ _'</span>, <span class="string">'_ _init_ _'</span>, <span class="string">'_ _module_ _'</span>, <span class="string">'_ _str_ _'</span>]</span><br></pre></td></tr></table></figure>

<p>  <code>getmembers</code> 函数返回了一个有序列表. 成员在列表中名称出现的越早, 它所处的类层次就越高. 如果无所谓顺序的话, 你可以使用字典代替列表.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!Feather 注: 字典是无序的, 而列表和元组是有序的, 网上有关于有序字典的讨论]</span><br></pre></td></tr></table></figure>

<p>  <code>vars</code> 函数与此相似, 它返回的是包含每个成员当前值的字典. 如果你使用不带参数的 <code>vars</code> , 它将返回当前局部名称空间的可见元素(同 <code>locals()</code> 函数 ). 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-11" target="_blank" rel="noopener">Example 1-11</a>所表示.</p>
<h4 id="1-2-3-3-Example-1-11-使用-vars-函数"><a href="#1-2-3-3-Example-1-11-使用-vars-函数" class="headerlink" title="1.2.3.3. Example 1-11. 使用 vars 函数"></a>1.2.3.3. Example 1-11. 使用 vars 函数</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-vars-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line">book = <span class="string">"library2"</span></span><br><span class="line">pages = <span class="number">250</span></span><br><span class="line">scripts = <span class="number">350</span></span><br></pre></td></tr></table></figure>

<p>  print “the %(book)s book contains more than %(scripts)s scripts” % vars()</p>
<p>  the library book contains more than 350 scripts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">### 1.2.4. 检查对象类型</span><br><span class="line"></span><br><span class="line">Python 是一种动态类型语言, 这意味着给一个定变量名可以在不同的场合绑定到不同的类型上. 在接下面例子中, 同样的函数分别被整数, 浮点数, 以及一个字符串调用:</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">def function(value):</span><br><span class="line">    print value</span><br><span class="line">function(1)</span><br><span class="line">function(1.0)</span><br><span class="line">function(&quot;one&quot;)</span><br></pre></td></tr></table></figure>

<p>  <code>type</code> 函数 (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-12" target="_blank" rel="noopener">Example 1-12</a> 所示) 允许你检查一个变量的类型. 这个函数会返回一个 <em>type descriptor (类型描述符)</em>, 它对于 Python 解释器提供的每个类型都是不同的.</p>
<h4 id="1-2-4-1-Example-1-12-使用-type-函数"><a href="#1-2-4-1-Example-1-12-使用-type-函数" class="headerlink" title="1.2.4.1. Example 1-12. 使用 type 函数"></a>1.2.4.1. Example 1-12. 使用 type 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-type-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> type(value), value</span><br><span class="line"></span><br><span class="line">dump(<span class="number">1</span>)</span><br><span class="line">dump(<span class="number">1.0</span>)</span><br><span class="line">dump(<span class="string">"one"</span>)</span><br><span class="line"></span><br><span class="line">&lt;type <span class="string">'int'</span>&gt; <span class="number">1</span></span><br><span class="line">&lt;type <span class="string">'float'</span>&gt; <span class="number">1.0</span></span><br><span class="line">&lt;type <span class="string">'string'</span>&gt; one</span><br></pre></td></tr></table></figure>

<p>  每个类型都有一个对应的类型对象, 所以你可以使用 <code>is</code> 操作符 (对象身份?) 来 检查类型. (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-13" target="_blank" rel="noopener">Example 1-13</a>所示).</p>
<h4 id="1-2-4-2-Example-1-13-对文件名和文件对象使用-type-函数"><a href="#1-2-4-2-Example-1-13-对文件名和文件对象使用-type-函数" class="headerlink" title="1.2.4.2. Example 1-13. 对文件名和文件对象使用 type 函数"></a>1.2.4.2. Example 1-13. 对文件名和文件对象使用 type 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-type-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(file)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(file, type(<span class="string">""</span>)):</span><br><span class="line">        file = open(file, <span class="string">"rb"</span>)</span><br><span class="line">    <span class="keyword">return</span> file.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> len(load(<span class="string">"samples/sample.jpg"</span>)), <span class="string">"bytes"</span></span><br><span class="line"><span class="keyword">print</span> len(load(open(<span class="string">"samples/sample.jpg"</span>, <span class="string">"rb"</span>))), <span class="string">"bytes"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4672</span> bytes</span><br><span class="line"><span class="number">4672</span> bytes</span><br></pre></td></tr></table></figure>

<p>  <code>callable</code> 函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-14" target="_blank" rel="noopener">Example 1-14</a> 所示, 可以检查一个对象是否是可调用的 (无论是直接调用或是通过 <code>apply</code>). 对于函数, 方法, <code>lambda</code> 函式, 类, 以及实现了 <code>_ _call_ _</code> 方法的类实例, 它都返回 True.</p>
<h4 id="1-2-4-3-Example-1-14-使用-callable-函数"><a href="#1-2-4-3-Example-1-14-使用-callable-函数" class="headerlink" title="1.2.4.3. Example 1-14. 使用 callable 函数"></a>1.2.4.3. Example 1-14. 使用 callable 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-callable-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(function)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> callable(function):</span><br><span class="line">        <span class="keyword">print</span> function, <span class="string">"is callable"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> function, <span class="string">"is *not* callable"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_call_</span> <span class="title">_</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line"></span><br><span class="line">dump(<span class="number">0</span>) <span class="comment"># simple objects</span></span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line">dump(callable)</span><br><span class="line">dump(dump) <span class="comment"># function</span></span><br><span class="line"></span><br><span class="line">dump(A) <span class="comment"># classes</span></span><br><span class="line">dump(B)</span><br><span class="line">dump(B.method)</span><br><span class="line"></span><br><span class="line">dump(a) <span class="comment"># instances</span></span><br><span class="line">dump(b)</span><br><span class="line">dump(b.method)</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="keyword">is</span> *<span class="keyword">not</span>* callable</span><br><span class="line">string <span class="keyword">is</span> *<span class="keyword">not</span>* callable</span><br><span class="line">&lt;built-<span class="keyword">in</span> function callable&gt; <span class="keyword">is</span> callable</span><br><span class="line">&lt;function dump at <span class="number">8</span>ca320&gt; <span class="keyword">is</span> callable</span><br><span class="line">A <span class="keyword">is</span> callable</span><br><span class="line">B <span class="keyword">is</span> callable</span><br><span class="line">&lt;unbound method A.method&gt; <span class="keyword">is</span> callable</span><br><span class="line">&lt;A instance at <span class="number">8</span>caa10&gt; <span class="keyword">is</span> *<span class="keyword">not</span>* callable</span><br><span class="line">&lt;B instance at <span class="number">8</span>cab00&gt; <span class="keyword">is</span> callable</span><br><span class="line">&lt;method A.method of B instance at <span class="number">8</span>cab00&gt; <span class="keyword">is</span> callable</span><br></pre></td></tr></table></figure>

<p>  注意类对象 (A 和 B 都是可调用的; 如果调用它们, 就产生新的对象(类实例). 但是 A 类的实例不可调用, 因为它的类没有实现 _ <em>call</em> _ 方法.</p>
<p>  你可以在 <code>operator</code> 模块中找到检查对象是否为某一内建类型(数字, 序列, 或者字典等) 的函数. 但是, 因为创建一个类很简单(比如实现基本序列方法的类), 所以对这些 类型使用显式的类型判断并不是好主意.</p>
<p>  在处理类和实例的时候会复杂些. Python 不会把类作为本质上的类型对待; 相反地, 所有的类都属于一个特殊的类类型(special class type), 所有的类实例属于一个特殊的实例类型(special instance type).</p>
<p>  这意味着你不能使用 <code>type</code> 函数来测试一个实例是否属于一个给定的类; 所有的实例都是同样 的类型! 为了解决这个问题, 你可以使用 <code>isinstance</code> 函数,它会检查一个对象是 不是给定类(或其子类)的实例. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-15" target="_blank" rel="noopener">Example 1-15</a> 展示了 <code>isinstance</code> 函数的使用.</p>
<h4 id="1-2-4-4-Example-1-15-使用-isinstance-函数"><a href="#1-2-4-4-Example-1-15-使用-isinstance-函数" class="headerlink" title="1.2.4.4. Example 1-15. 使用 isinstance 函数"></a>1.2.4.4. Example 1-15. 使用 isinstance 函数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-isinstance-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(A, B)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> object, <span class="string">"=&gt;"</span>,</span><br><span class="line">    <span class="keyword">if</span> isinstance(object, A):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"A"</span>,</span><br><span class="line">    <span class="keyword">if</span> isinstance(object, B):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"B"</span>,</span><br><span class="line">    <span class="keyword">if</span> isinstance(object, C):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"C"</span>,</span><br><span class="line">    <span class="keyword">if</span> isinstance(object, D):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"D"</span>,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line">c = C()</span><br><span class="line">d = D()</span><br><span class="line"></span><br><span class="line">dump(a)</span><br><span class="line">dump(b)</span><br><span class="line">dump(c)</span><br><span class="line">dump(d)</span><br><span class="line">dump(<span class="number">0</span>)</span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line"></span><br><span class="line">&lt;A instance at 8ca6d0&gt; =&gt; A</span><br><span class="line">&lt;B instance at 8ca750&gt; =&gt; B</span><br><span class="line">&lt;C instance at 8ca780&gt; =&gt; A C</span><br><span class="line">&lt;D instance at 8ca7b0&gt; =&gt; A B D</span><br><span class="line">0 =&gt;</span><br><span class="line">string =&gt;</span><br></pre></td></tr></table></figure>

<p>  <code>issubclass</code> 函数与此相似, 它用于检查一个类对象是否与给定类相同, 或者是给定类的子类. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-16" target="_blank" rel="noopener">Example 1-16</a> 所示.</p>
<p>  注意, <code>isinstance</code> 可以接受任何对象作为参数, 而 <code>issubclass</code> 函数在接受非类对象参 数时会引发 <em>TypeError</em> 异常.</p>
<h4 id="1-2-4-5-Example-1-16-使用-issubclass-函数"><a href="#1-2-4-5-Example-1-16-使用-issubclass-函数" class="headerlink" title="1.2.4.5. Example 1-16. 使用 issubclass 函数"></a>1.2.4.5. Example 1-16. 使用 issubclass 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-issubclass-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(A, B)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> object, <span class="string">"=&gt;"</span>,</span><br><span class="line">    <span class="keyword">if</span> issubclass(object, A):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"A"</span>,</span><br><span class="line">    <span class="keyword">if</span> issubclass(object, B):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"B"</span>,</span><br><span class="line">    <span class="keyword">if</span> issubclass(object, C):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"C"</span>,</span><br><span class="line">    <span class="keyword">if</span> issubclass(object, D):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"D"</span>,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">dump(A)</span><br><span class="line">dump(B)</span><br><span class="line">dump(C)</span><br><span class="line">dump(D)</span><br><span class="line">dump(<span class="number">0</span>)</span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line"></span><br><span class="line">A =&gt; A</span><br><span class="line">B =&gt; B </span><br><span class="line">C =&gt; A C</span><br><span class="line">D =&gt; A B D</span><br><span class="line">0 =&gt;</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "builtin-issubclass-example-1.py", line 29, in ?</span><br><span class="line">  File <span class="string">"builtin-issubclass-example-1.py"</span>, line <span class="number">15</span>, <span class="keyword">in</span> dump</span><br><span class="line">TypeError: arguments must be classes</span><br></pre></td></tr></table></figure>

<h3 id="1-2-5-计算-Python-表达式"><a href="#1-2-5-计算-Python-表达式" class="headerlink" title="1.2.5. 计算 Python 表达式"></a>1.2.5. 计算 Python 表达式</h3><p>  Python 提供了在程序中与解释器交互的多种方法. 例如 <code>eval</code> 函数将一个字符串 作为 Python 表达式求值. 你可以传递一串文本, 简单的表达式, 或者使用 内建 Python 函数. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-17" target="_blank" rel="noopener">Example 1-17</a> 所示.</p>
<h4 id="1-2-5-1-Example-1-17-使用-eval-函数"><a href="#1-2-5-1-Example-1-17-使用-eval-函数" class="headerlink" title="1.2.5.1. Example 1-17. 使用 eval 函数"></a>1.2.5.1. Example 1-17. 使用 eval 函数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-eval-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(expression)</span>:</span></span><br><span class="line">    result = eval(expression)</span><br><span class="line">    <span class="keyword">print</span> expression, <span class="string">"=&gt;"</span>, result, type(result)</span><br><span class="line"></span><br><span class="line">dump(<span class="string">"1"</span>)</span><br><span class="line">dump(<span class="string">"1.0"</span>)</span><br><span class="line">dump(<span class="string">"'string'"</span>)</span><br><span class="line">dump(<span class="string">"1.0 + 2.0"</span>)</span><br><span class="line">dump(<span class="string">"'*' * 10"</span>)</span><br><span class="line">dump(<span class="string">"len('world')"</span>)</span><br><span class="line"></span><br><span class="line">1 =&gt; 1 &lt;type 'int'&gt;</span><br><span class="line">1.0 =&gt; 1.0 &lt;type 'float'&gt;</span><br><span class="line">'string' =&gt; string &lt;type 'string'&gt;</span><br><span class="line">1.0 + 2.0 =&gt; 3.0 &lt;type 'float'&gt;</span><br><span class="line">'*' * 10 =&gt; ********** &lt;type 'string'&gt;</span><br><span class="line">len('world') =&gt; 5 &lt;type 'int'&gt;</span><br></pre></td></tr></table></figure>

<p>  如果你不确定字符串来源的安全性, 那么你在使用 <code>eval</code> 的时候会遇到些麻烦. 例如, 某个用户可能会使用 <code>_ _import_ _</code> 函数加载 <code>os</code> 模块, 然后从硬盘删除文件 (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-18" target="_blank" rel="noopener">Example 1-18</a> 所示).</p>
<h4 id="1-2-5-2-Example-1-18-使用-eval-函数执行任意命令"><a href="#1-2-5-2-Example-1-18-使用-eval-函数执行任意命令" class="headerlink" title="1.2.5.2. Example 1-18. 使用 eval 函数执行任意命令"></a>1.2.5.2. Example 1-18. 使用 eval 函数执行任意命令</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-eval-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').getcwd()"</span>)</span><br><span class="line"><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').remove('file')"</span>)</span><br><span class="line"></span><br><span class="line">/home/fredrik/librarybook</span><br><span class="line">Traceback (innermost last):</span><br><span class="line"> File "builtin-eval-example-2", line 2, in ?</span><br><span class="line"> File "&lt;string&gt;", line 0, in ?</span><br><span class="line">os.error: (<span class="number">2</span>, <span class="string">'No such file or directory'</span>)</span><br></pre></td></tr></table></figure>

<p>  这里我们得到了一个 <em>os.error</em> 异常, 这说明 <em>Python 事实上在尝试删除文件!</em></p>
<p>  幸运地是, 这个问题很容易解决. 你可以给 <code>eval</code> 函数传递第 2 个参数, 一个定义了该表达式求值时名称空间的字典. 我们测试下, 给函数传递个空字典:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').remove('file')"</span>, &#123;&#125;)</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "&lt;stdin&gt;", line 1, in ?</span><br><span class="line">  File "&lt;string&gt;", line 0, in ?</span><br><span class="line">os.error: (<span class="number">2</span>, <span class="string">'No such file or directory'</span>)</span><br></pre></td></tr></table></figure>

<p>  呃…. 我们还是得到了个 <em>os.error</em> 异常.</p>
<p>  这是因为 Python 在求值前会检查这个字典, 如果没有发现名称为 <code>_ _builtins_ _</code> 的变量(复数形式), 它就会添加一个:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>namespace = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').remove('file')"</span>, namespace)</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "&lt;stdin&gt;", line 1, in ?</span><br><span class="line">  File "&lt;string&gt;", line 0, in ?</span><br><span class="line">os.error: (<span class="number">2</span>, <span class="string">'No such file or directory'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>namespace.keys()</span><br><span class="line">[<span class="string">'_ _builtins_ _'</span>]</span><br></pre></td></tr></table></figure>

<p>  如果你打印这个 namespace 的内容, 你会发现里边有所有的内建函数.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!Feather 注: 如果我RP不错的话, 添加的这个_ _builtins_ _就是当前的_ _builtins_ _]</span><br></pre></td></tr></table></figure>

<p>  我们注意到了如果这个变量存在, Python 就不会去添加默认的, 那么我们的解决方法也来了, 为传递的字典参数加入一个 <code>_ _builtins_ _</code> 项即可. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-19" target="_blank" rel="noopener">Example 1-19</a> 所示.</p>
<h4 id="1-2-5-3-Example-1-19-安全地使用-eval-函数求值"><a href="#1-2-5-3-Example-1-19-安全地使用-eval-函数求值" class="headerlink" title="1.2.5.3. Example 1-19. 安全地使用 eval 函数求值"></a>1.2.5.3. Example 1-19. 安全地使用 eval 函数求值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-eval-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').getcwd()"</span>, &#123;&#125;)</span><br><span class="line"><span class="keyword">print</span> eval(<span class="string">"_ _import_ _('os').remove('file')"</span>, &#123;<span class="string">"_ _builtins_ _"</span>: &#123;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">/home/fredrik/librarybook</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "builtin-eval-example-3.py", line 2, in ?</span><br><span class="line">  File "&lt;string&gt;", line 0, in ?</span><br><span class="line">NameError: _ _import_ _</span><br></pre></td></tr></table></figure>

<p>  即使这样, 你仍然无法避免针对 CPU 和内存资源的攻击. (比如, 形如 <code>eval(&quot;&#39;*&#39;*1000000*2*2*2*2*2*2*2*2*2&quot;)</code> 的语句在执行后会使你的程序耗尽系统资源).</p>
<h3 id="1-2-6-编译和执行代码"><a href="#1-2-6-编译和执行代码" class="headerlink" title="1.2.6. 编译和执行代码"></a>1.2.6. 编译和执行代码</h3><p>  <code>eval</code> 函数只针对简单的表达式. 如果要处理大块的代码, 你应该使用 <code>compile</code> 和 <code>exec</code> 函数 (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-20" target="_blank" rel="noopener">Example 1-20</a> 所示).</p>
<h4 id="1-2-6-1-Example-1-20-使用-compile-函数检查语法"><a href="#1-2-6-1-Example-1-20-使用-compile-函数检查语法" class="headerlink" title="1.2.6.1. Example 1-20. 使用 compile 函数检查语法"></a>1.2.6.1. Example 1-20. 使用 compile 函数检查语法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-compile-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line">NAME = <span class="string">"script.py"</span></span><br><span class="line"></span><br><span class="line">BODY = <span class="string">"""</span></span><br><span class="line"><span class="string">prnt 'owl-stretching time'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    compile(BODY, NAME, <span class="string">"exec"</span>)</span><br><span class="line"><span class="keyword">except</span> SyntaxError, v:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"syntax error:"</span>, v, <span class="string">"in"</span>, NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># syntax error: invalid syntax in script.py</span></span><br></pre></td></tr></table></figure>

<p>  成功执行后, <code>compile</code> 函数会返回一个代码对象, 你可以使用 <code>exec</code> 语句执行它, 参见 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-21" target="_blank" rel="noopener">Example 1-21</a> .</p>
<h4 id="1-2-6-2-Example-1-21-执行已编译的代码"><a href="#1-2-6-2-Example-1-21-执行已编译的代码" class="headerlink" title="1.2.6.2. Example 1-21. 执行已编译的代码"></a>1.2.6.2. Example 1-21. 执行已编译的代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-compile-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line">BODY = <span class="string">"""</span></span><br><span class="line"><span class="string">print 'the ant, an introduction'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">code = compile(BODY, <span class="string">"&lt;script&gt;"</span>, <span class="string">"exec"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">exec</span> code</span><br><span class="line"></span><br><span class="line">&lt;code object ? at 8c6be0, file "&lt;script&gt;", line 0&gt;</span><br><span class="line">the ant, an introduction</span><br></pre></td></tr></table></figure>

<p>  使用 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-22" target="_blank" rel="noopener">Example 1-22</a> 中的类可以在程序执行时实时地生成代码. <code>write</code> 方法用于添加代码, <code>indent</code> 和 <code>dedent</code> 方法用于控制缩进结构. 其他部分交给类来处理.</p>
<h4 id="1-2-6-3-Example-1-22-简单的代码生成工具"><a href="#1-2-6-3-Example-1-22-简单的代码生成工具" class="headerlink" title="1.2.6.3. Example 1-22. 简单的代码生成工具"></a>1.2.6.3. Example 1-22. 简单的代码生成工具</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-compile-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys, string</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CodeGeneratorBackend</span>:</span></span><br><span class="line">    <span class="string">"Simple code generator for Python"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">begin</span><span class="params">(self, tab=<span class="string">"\t"</span>)</span>:</span></span><br><span class="line">        self.code = []</span><br><span class="line">        self.tab = tab</span><br><span class="line">        self.level = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.code.append(<span class="string">""</span>) <span class="comment"># make sure there's a newline at the end </span></span><br><span class="line">        <span class="keyword">return</span> compile(string.join(self.code, <span class="string">"\n"</span>), <span class="string">"&lt;code&gt;"</span>, <span class="string">"exec"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, string)</span>:</span></span><br><span class="line">        self.code.append(self.tab * self.level + string)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">indent</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.level = self.level + <span class="number">1</span></span><br><span class="line">        <span class="comment"># in 2.0 and later, this can be written as: self.level += 1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dedent</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.level == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError, <span class="string">"internal error in code generator"</span></span><br><span class="line">        self.level = self.level - <span class="number">1</span></span><br><span class="line">        <span class="comment"># or: self.level -= 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># try it out!</span></span><br><span class="line"></span><br><span class="line">c = CodeGeneratorBackend()</span><br><span class="line">c.begin()</span><br><span class="line">c.write(<span class="string">"for i in range(5):"</span>)</span><br><span class="line">c.indent()</span><br><span class="line">c.write(<span class="string">"print 'code generation made easy!'"</span>)</span><br><span class="line">c.dedent()</span><br><span class="line"><span class="keyword">exec</span> c.end()</span><br><span class="line"></span><br><span class="line">code generation made easy!</span><br><span class="line">code generation made easy!</span><br><span class="line">code generation made easy!</span><br><span class="line">code generation made easy!</span><br><span class="line">code generation made easy!</span><br></pre></td></tr></table></figure>

<p>  Python 还提供了 <code>execfile</code> 函数, 一个从文件加载代码, 编译代码, 执行代码的快捷方式. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-23" target="_blank" rel="noopener">Example 1-23</a> 简单地展示了如何使用这个函数.</p>
<h4 id="1-2-6-4-Example-1-23-使用-execfile-函数"><a href="#1-2-6-4-Example-1-23-使用-execfile-函数" class="headerlink" title="1.2.6.4. Example 1-23. 使用 execfile 函数"></a>1.2.6.4. Example 1-23. 使用 execfile 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-execfile-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line">execfile(<span class="string">"hello.py"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EXECFILE</span><span class="params">(filename, locals=None, globals=None)</span>:</span></span><br><span class="line">    <span class="keyword">exec</span> compile(open(filename).read(), filename, <span class="string">"exec"</span>) <span class="keyword">in</span> locals, globals</span><br><span class="line"></span><br><span class="line">EXECFILE(<span class="string">"hello.py"</span>)</span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-24" target="_blank" rel="noopener">Example 1-24</a> 中的代码是 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-23" target="_blank" rel="noopener">Example 1-23</a> 中使用的 hello.py 文件.</p>
<h4 id="1-2-6-5-Example-1-24-hello-py-脚本"><a href="#1-2-6-5-Example-1-24-hello-py-脚本" class="headerlink" title="1.2.6.5. Example 1-24. hello.py 脚本"></a>1.2.6.5. Example 1-24. hello.py 脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">File: hello.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"hello again, and welcome to the show"</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-7-从-builtin-模块重载函数"><a href="#1-2-7-从-builtin-模块重载函数" class="headerlink" title="1.2.7. 从 _ builtin _ 模块重载函数"></a>1.2.7. 从 _ <em>builtin</em> _ 模块重载函数</h3><p>  因为 Python 在检查局部名称空间和模块名称空间前不会检查内建函数, 所以有时候你可能要显式地引用 <code>_ _builtin_ _</code> 模块. 例如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-25" target="_blank" rel="noopener">Example 1-25</a> 重载了内建的 <code>open</code> 函数. 这时候要想使用原来的 <code>open</code> 函数, 就需要脚本显式地指明模块名称.</p>
<h4 id="1-2-7-1-Example-1-25-显式地访问-builtin-模块中的函数"><a href="#1-2-7-1-Example-1-25-显式地访问-builtin-模块中的函数" class="headerlink" title="1.2.7.1. Example 1-25. 显式地访问 _ builtin _ 模块中的函数"></a>1.2.7.1. Example 1-25. 显式地访问 _ <em>builtin</em> _ 模块中的函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: builtin-open-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(filename, mode=<span class="string">"rb"</span>)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> _ _builtin_ _</span><br><span class="line">    file = _ _builtin_ _.open(filename, mode)</span><br><span class="line">    <span class="keyword">if</span> file.read(<span class="number">5</span>) <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">"GIF87"</span>, <span class="string">"GIF89"</span>):</span><br><span class="line">        <span class="keyword">raise</span> IOError, <span class="string">"not a GIF file"</span></span><br><span class="line">    file.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> file</span><br><span class="line"></span><br><span class="line">fp = open(<span class="string">"samples/sample.gif"</span>)</span><br><span class="line"><span class="keyword">print</span> len(fp.read()), <span class="string">"bytes"</span></span><br><span class="line"></span><br><span class="line">fp = open(<span class="string">"samples/sample.jpg"</span>)</span><br><span class="line"><span class="keyword">print</span> len(fp.read()), <span class="string">"bytes"</span></span><br><span class="line"></span><br><span class="line"><span class="number">3565</span> bytes</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "builtin-open-example-1.py", line 12, in ?</span><br><span class="line">  File <span class="string">"builtin-open-example-1.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> open</span><br><span class="line">IOError: <span class="keyword">not</span> a GIF file</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[!Feather 注: 明白这个open()函数是干什么的么? 检查一个文件是否是 GIF 文件, </span><br><span class="line">一般如这类的图片格式都在文件开头有默认的格式. </span><br><span class="line">另外打开文件推荐使用file()而不是open() , 虽然暂时没有区别]</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-3-exceptions-模块"><a href="#1-3-exceptions-模块" class="headerlink" title="1.3. exceptions 模块"></a>1.3. exceptions 模块</h2><p>  <code>exceptions</code> 模块提供了标准异常的层次结构. Python 启动的时候会自动导入这个模块, 并且将它加入到 <code>_ _builtin_ _</code> 模块中. 也就是说, 一般不需要手动导入这个模块.</p>
<p>  在 1.5.2 版本时它是一个普通模块, 2.0 以及以后版本成为内建模块.</p>
<p>  该模块定义了以下标准异常:</p>
<ul>
<li><p><em>Exception</em> 是所有异常的基类. 强烈建议(但不是必须)自定义的异常也继承这个类.</p>
</li>
<li><p><em>SystemExit(Exception)</em> 由 <code>sys.exit</code> 函数引发. 如果它在最顶层没有被 <code>try-except</code> 语句捕获,</p>
<p>那么解释器将直接关闭而不会显示任何跟踪返回信息.</p>
</li>
<li><p><em>StandardError(Exception)</em> 是所有内建异常的基类(除 <em>SystemExit</em> 外).</p>
</li>
<li><p><em>KeyboardInterrupt(StandardError)</em> 在用户按下 Control-C(或其他打断按键)后 被引发. 如果它可能会在你使用 “捕获所有” 的 <code>try-except</code> 语句时导致奇怪的问题.</p>
</li>
<li><p><em>ImportError(StandardError)</em> 在 Python 导入模块失败时被引发.</p>
</li>
<li><p><em>EnvironmentError</em> 作为所有解释器环境引发异常的基类. (也就是说, 这些异常一般不是由于程序 bug 引起).</p>
</li>
<li><p><em>IOError(EnvironmentError)</em> 用于标记 I/O 相关错误.</p>
</li>
<li><p><em>OSError(EnvironmentError)</em> 用于标记 <code>os</code> 模块引起的错误.</p>
</li>
<li><p><em>WindowsError(OSError)</em> 用于标记 <code>os</code> 模块中 Windows 相关错误.</p>
</li>
<li><p><em>NameError(StandardError)</em> 在 Python 查找全局或局部名称失败时被引发.</p>
</li>
<li><p><em>UnboundLocalError(NameError)</em> , 当一个局部变量还没有赋值就被使用时, 会引发这个异常. 这个异常只有在2.0及之后的版本有; 早期版本只会引发一个普通的 <em>NameError</em> .</p>
</li>
<li><p><em>AttributeError(StandardError)</em> , 当 Python 寻找(或赋值)给一个实例属性, 方法, 模块功能或其它有效的命名失败时, 会引发这个异常.</p>
</li>
<li><p><em>SyntaxError(StandardError)</em> , 当解释器在编译时遇到语法错误, 这个异常就被引发.</p>
</li>
<li><p>(2.0 及以后版本) <em>IndentationError(SyntaxError)</em> 在遇到非法的缩进时被引发. 该异常只用于 2.0 及以后版本, 之前版本会引发一个 <em>SyntaxError</em> 异常.</p>
</li>
<li><p>(2.0 及以后版本) <em>TabError(IndentationError)</em> , 当使用 <code>-tt</code> 选项检查不一致缩进时有可能被引发. 该异常只用于 2.0 及以后版本, 之前版本会引发一个 <em>SyntaxError</em> 异常.</p>
</li>
<li><p><em>TypeError(StandardError)</em> , 当给定类型的对象不支持一个操作时被引发.</p>
</li>
<li><p><em>AssertionError(StandardError)</em> 在 <code>assert</code> 语句失败时被引发(即表达式为 false 时).</p>
</li>
<li><p><em>LookupError(StandardError)</em> 作为序列或字典没有包含给定索引或键时所引发异常的基类.</p>
</li>
<li><p><em>IndexError(LookupError)</em> , 当序列对象使用给定索引数索引失败时(不存在索引对应对象)引发该异常.</p>
</li>
<li><p><em>KeyError(LookupError)</em> 当字典对象使用给定索引索引失败时(不存在索引对应对象)引发该异常.</p>
</li>
<li><p><em>ArithmeticError(StandardError)</em> 作为数学计算相关异常的基类.</p>
</li>
<li><p><em>OverflowError(ArithmeticError)</em> 在操作溢出时被引发(例如当一个整数太大, 导致不能符合给定类型).</p>
</li>
<li><p><em>ZeroDivisionError(ArithmeticError)</em> , 当你尝试用 0 除某个数时被引发.</p>
</li>
<li><p><em>FloatingPointError(ArithmeticError)</em> , 当浮点数操作失败时被引发.</p>
</li>
<li><p><em>ValueError(StandardError)</em> , 当一个参数类型正确但值不合法时被引发.</p>
</li>
<li><p>(2.0 及以后版本) <em>UnicodeError(ValueError)</em> , Unicode 字符串类型相关异常. 只使用在 2.0 及以后版本.</p>
</li>
<li><p><em>RuntimeError(StandardError)</em> , 当出现运行时问题时引发, 包括在限制模式下尝试访问外部内容, 未知的硬件问题等等.</p>
</li>
<li><p><em>NotImplementedError(RuntimeError)</em> , 用于标记未实现的函数, 或无效的方法.</p>
</li>
<li><p><em>SystemError(StandardError)</em> , 解释器内部错误. 该异常值会包含更多的细节</p>
<p>(经常会是一些深层次的东西, 比如 “<code>eval_code2: NULL globals&quot; )</code>. 这本书的作者编了 5 年程序都没见过这个错误. (想必是没有用 <code>raise SystemError</code>).</p>
</li>
<li><p><em>MemoryError(StandardError)</em> , 当解释器耗尽内存时会引发该异常. 注意只有在底层内存分配抱怨时这个异常才会发生; 如果是在你的旧机器上, 这个异常发生之前系统会陷入混乱的内存交换中.</p>
<p>你可以创建自己的异常类. 只需要继承内建的 <em>Exception</em> 类(或者它的任意一个合适的子类)即可, 有需要时可以再重载它的 <code>_ _str_ _</code> 方法. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-26" target="_blank" rel="noopener">Example 1-26</a> 展示了如何使用 <code>exceptions</code>模块.</p>
</li>
</ul>
<h4 id="1-3-0-1-Example-1-26-使用-exceptions-模块"><a href="#1-3-0-1-Example-1-26-使用-exceptions-模块" class="headerlink" title="1.3.0.1. Example 1-26. 使用 exceptions 模块"></a>1.3.0.1. Example 1-26. 使用 exceptions 模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">File: exceptions-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="comment"># python imports this module by itself, so the following</span></span><br><span class="line"><span class="comment"># line isn't really needed</span></span><br><span class="line"><span class="comment"># python 会自动导入该模块, 所以以下这行是不必要的</span></span><br><span class="line"><span class="comment"># import exceptions</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTTPError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="comment"># indicates an HTTP protocol error</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, url, errcode, errmsg)</span>:</span></span><br><span class="line">        self.url = url</span><br><span class="line">        self.errcode = errcode</span><br><span class="line">        self.errmsg = errmsg</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_str_</span> <span class="title">_</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="string">"&lt;HTTPError for %s: %s %s&gt;"</span> %</span><br><span class="line">            (self.url, self.errcode, self.errmsg)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> HTTPError(<span class="string">"http://www.python.org/foo"</span>, <span class="number">200</span>, <span class="string">"Not Found"</span>)</span><br><span class="line"><span class="keyword">except</span> HTTPError, error:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"url"</span>, <span class="string">"=&gt;"</span>, error.url</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"errcode"</span>, <span class="string">"=&gt;"</span>, error.errcode</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"errmsg"</span>, <span class="string">"=&gt;"</span>, error.errmsg</span><br><span class="line">    <span class="keyword">raise</span> <span class="comment"># reraise exception</span></span><br><span class="line"></span><br><span class="line">url =&gt; http://www.python.org/foo</span><br><span class="line">errcode =&gt; 200</span><br><span class="line">errmsg =&gt; Not Found</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "exceptions-example-1", line 16, in ?</span><br><span class="line">HTTPError: &lt;HTTPError <span class="keyword">for</span> http://www.python.org/foo: <span class="number">200</span> Not Found&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-4-os-模块"><a href="#1-4-os-模块" class="headerlink" title="1.4. os 模块"></a>1.4. os 模块</h2><p>  这个模块中的大部分函数通过对应平台相关模块实现, 比如 <code>posix</code> 和 <code>nt. os</code> 模块会在第一次导入的时候自动加载合适的执行模块.</p>
<h3 id="1-4-1-处理文件"><a href="#1-4-1-处理文件" class="headerlink" title="1.4.1. 处理文件"></a>1.4.1. 处理文件</h3><p>  内建的 <code>open / file</code> 函数用于创建, 打开和编辑文件, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-27" target="_blank" rel="noopener">Example 1-27</a> 所示. 而 <code>os</code> 模块提供了重命名和删除文件所需的函数.</p>
<h4 id="1-4-1-1-Example-1-27-使用-os-模块重命名和删除文件"><a href="#1-4-1-1-Example-1-27-使用-os-模块重命名和删除文件" class="headerlink" title="1.4.1.1. Example 1-27. 使用 os 模块重命名和删除文件"></a>1.4.1.1. Example 1-27. 使用 os 模块重命名和删除文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace</span><span class="params">(file, search_for, replace_with)</span>:</span></span><br><span class="line">    <span class="comment"># replace strings in a text file</span></span><br><span class="line"></span><br><span class="line">    back = os.path.splitext(file)[<span class="number">0</span>] + <span class="string">".bak"</span></span><br><span class="line">    temp = os.path.splitext(file)[<span class="number">0</span>] + <span class="string">".tmp"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># remove old temp file, if any</span></span><br><span class="line">        os.remove(temp)</span><br><span class="line">    <span class="keyword">except</span> os.error:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    fi = open(file)</span><br><span class="line">    fo = open(temp, <span class="string">"w"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> fi.readlines():</span><br><span class="line">        fo.write(string.replace(s, search_for, replace_with))</span><br><span class="line"></span><br><span class="line">    fi.close()</span><br><span class="line">    fo.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># remove old backup file, if any</span></span><br><span class="line">        os.remove(back)</span><br><span class="line">    <span class="keyword">except</span> os.error:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rename original to backup...</span></span><br><span class="line">    os.rename(file, back)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...and temporary to original</span></span><br><span class="line">    os.rename(temp, file)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># try it out!</span></span><br><span class="line"></span><br><span class="line">file = <span class="string">"samples/sample.txt"</span></span><br><span class="line"></span><br><span class="line">replace(file, <span class="string">"hello"</span>, <span class="string">"tjena"</span>)</span><br><span class="line">replace(file, <span class="string">"tjena"</span>, <span class="string">"hello"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-4-2-处理目录"><a href="#1-4-2-处理目录" class="headerlink" title="1.4.2. 处理目录"></a>1.4.2. 处理目录</h3><p>  <code>os</code> 模块也包含了一些用于目录处理的函数.</p>
<p>  <code>listdir</code> 函数返回给定目录中所有文件名(包括目录名)组成的列表, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-28" target="_blank" rel="noopener">Example 1-28</a> 所示. 而 Unix 和 Windows 中使用的当前目录和父目录标记(. 和 .. )不包含在此列表中.</p>
<h4 id="1-4-2-1-Example-1-28-使用-os-列出目录下的文件"><a href="#1-4-2-1-Example-1-28-使用-os-列出目录下的文件" class="headerlink" title="1.4.2.1. Example 1-28. 使用 os 列出目录下的文件"></a>1.4.2.1. Example 1-28. 使用 os 列出目录下的文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-5.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(<span class="string">"samples"</span>):</span><br><span class="line">    <span class="keyword">print</span> file</span><br><span class="line"></span><br><span class="line">sample.au</span><br><span class="line">sample.jpg</span><br><span class="line">sample.wav</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  <code>getcwd</code> 和 <code>chdir</code> 函数分别用于获得和改变当前工作目录. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-29" target="_blank" rel="noopener">Example 1-29</a> 所示.</p>
<h4 id="1-4-2-2-Example-1-29-使用-os-模块改变当前工作目录"><a href="#1-4-2-2-Example-1-29-使用-os-模块改变当前工作目录" class="headerlink" title="1.4.2.2. Example 1-29. 使用 os 模块改变当前工作目录"></a>1.4.2.2. Example 1-29. 使用 os 模块改变当前工作目录</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-4.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># where are we?</span></span><br><span class="line">cwd = os.getcwd()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"1"</span>, cwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># go down</span></span><br><span class="line">os.chdir(<span class="string">"samples"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"2"</span>, os.getcwd()</span><br><span class="line"></span><br><span class="line"><span class="comment"># go back up</span></span><br><span class="line">os.chdir(os.pardir)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"3"</span>, os.getcwd()</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> /ematter/librarybook</span><br><span class="line"><span class="number">2</span> /ematter/librarybook/samples</span><br><span class="line"><span class="number">3</span> /ematter/librarybook</span><br></pre></td></tr></table></figure>

<p>  <code>makedirs</code> 和 <code>removedirs</code> 函数用于创建或删除目录层，如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-30" target="_blank" rel="noopener">Example 1-30</a> 所示.</p>
<h4 id="1-4-2-3-Example-1-30-使用-os-模块创建-删除多个目录级"><a href="#1-4-2-3-Example-1-30-使用-os-模块创建-删除多个目录级" class="headerlink" title="1.4.2.3. Example 1-30. 使用 os 模块创建/删除多个目录级"></a>1.4.2.3. Example 1-30. 使用 os 模块创建/删除多个目录级</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-6.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.makedirs(<span class="string">"test/multiple/levels"</span>)</span><br><span class="line"></span><br><span class="line">fp = open(<span class="string">"test/multiple/levels/file"</span>, <span class="string">"w"</span>)</span><br><span class="line">fp.write(<span class="string">"inspector praline"</span>)</span><br><span class="line">fp.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove the file</span></span><br><span class="line">os.remove(<span class="string">"test/multiple/levels/file"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># and all empty directories above it</span></span><br><span class="line">os.removedirs(<span class="string">"test/multiple/levels"</span>)</span><br></pre></td></tr></table></figure>

<p>  <code>removedirs</code> 函数会删除所给路径中最后一个目录下所有的空目录. 而 <code>mkdir</code> 和 <code>rmdir</code> 函数只能处理单个目录级. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-31" target="_blank" rel="noopener">Example 1-31</a> 所示.</p>
<h4 id="1-4-2-4-Example-1-31-使用-os-模块创建-删除目录"><a href="#1-4-2-4-Example-1-31-使用-os-模块创建-删除目录" class="headerlink" title="1.4.2.4. Example 1-31. 使用 os 模块创建/删除目录"></a>1.4.2.4. Example 1-31. 使用 os 模块创建/删除目录</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-7.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.mkdir(<span class="string">"test"</span>)</span><br><span class="line">os.rmdir(<span class="string">"test"</span>)</span><br><span class="line"></span><br><span class="line">os.rmdir(<span class="string">"samples"</span>) <span class="comment"># this will fail</span></span><br><span class="line"></span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "os-example-7", line 6, in ?</span><br><span class="line">OSError: [Errno <span class="number">41</span>] Directory <span class="keyword">not</span> empty: <span class="string">'samples'</span></span><br></pre></td></tr></table></figure>

<p>  如果需要删除非空目录, 你可以使用 <code>shutil</code> 模块中的 <code>rmtree</code> 函数.</p>
<h3 id="1-4-3-处理文件属性"><a href="#1-4-3-处理文件属性" class="headerlink" title="1.4.3. 处理文件属性"></a>1.4.3. 处理文件属性</h3><p>  <code>stat</code> 函数可以用来获取一个存在文件的信息, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-32" target="_blank" rel="noopener">Example 1-32</a> 所示. 它返回一个类元组对象(stat_result对象, 包含 10 个元素), 依次是st_mode (权限模式), st_ino (inode number), st_dev (device), st_nlink (number of hard links), st_uid (所有者用户 ID), st_gid (所有者所在组 ID ), st_size (文件大小, 字节), st_atime (最近一次访问时间), st_mtime (最近修改时间), st_ctime (平台相关; Unix下的最近一次元数据/metadata修改时间, 或者 Windows 下的创建时间) - 以上项目也可作为属性访问.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!Feather 注: 原文为 9 元元组. 另,返回对象并非元组类型,为 struct.]</span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-1-Example-1-32-使用-os-模块获取文件属性"><a href="#1-4-3-1-Example-1-32-使用-os-模块获取文件属性" class="headerlink" title="1.4.3.1. Example 1-32. 使用 os 模块获取文件属性"></a>1.4.3.1. Example 1-32. 使用 os 模块获取文件属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">file = <span class="string">"samples/sample.jpg"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(st)</span>:</span></span><br><span class="line">    mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime = st</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- size:"</span>, size, <span class="string">"bytes"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- owner:"</span>, uid, gid</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- created:"</span>, time.ctime(ctime)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- last accessed:"</span>, time.ctime(atime)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- last modified:"</span>, time.ctime(mtime)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- mode:"</span>, oct(mode)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"- inode/dev:"</span>, ino, dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># get stats for a filename</span></span><br><span class="line"></span><br><span class="line">st = os.stat(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"stat"</span>, file</span><br><span class="line">dump(st)</span><br><span class="line"><span class="keyword">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># get stats for an open file</span></span><br><span class="line"></span><br><span class="line">fp = open(file)</span><br><span class="line"></span><br><span class="line">st = os.fstat(fp.fileno())</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"fstat"</span>, file</span><br><span class="line">dump(st)</span><br><span class="line"></span><br><span class="line">stat samples/sample.jpg</span><br><span class="line">- size: <span class="number">4762</span> bytes</span><br><span class="line">- owner: <span class="number">0</span> <span class="number">0</span></span><br><span class="line">- created: Tue Sep <span class="number">07</span> <span class="number">22</span>:<span class="number">45</span>:<span class="number">58</span> <span class="number">1999</span></span><br><span class="line">- last accessed: Sun Sep <span class="number">19</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">1999</span></span><br><span class="line">- last modified: Sun May <span class="number">19</span> <span class="number">01</span>:<span class="number">42</span>:<span class="number">16</span> <span class="number">1996</span></span><br><span class="line">- mode: <span class="number">0100666</span></span><br><span class="line">- inode/dev: <span class="number">0</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">fstat samples/sample.jpg</span><br><span class="line">- size: <span class="number">4762</span> bytes</span><br><span class="line">- owner: <span class="number">0</span> <span class="number">0</span></span><br><span class="line">- created: Tue Sep <span class="number">07</span> <span class="number">22</span>:<span class="number">45</span>:<span class="number">58</span> <span class="number">1999</span></span><br><span class="line">- last accessed: Sun Sep <span class="number">19</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">1999</span></span><br><span class="line">- last modified: Sun May <span class="number">19</span> <span class="number">01</span>:<span class="number">42</span>:<span class="number">16</span> <span class="number">1996</span></span><br><span class="line">- mode: <span class="number">0100666</span></span><br><span class="line">- inode/dev: <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>  返回对象中有些属性在非 Unix 平台下是无意义的, 比如 (<code>st_inode</code> , <code>st_dev</code>)为 Unix 下的为每个文件提供了唯一标识, 但在其他平台可能为任意无意义数据 .</p>
<p>  <code>stat</code> 模块包含了很多可以处理该返回对象的常量及函数. 下面的代码展示了其中的一些.</p>
<p>  可以使用 <code>chmod</code> 和 <code>utime</code> 函数修改文件的权限模式和时间属性，如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-33" target="_blank" rel="noopener">Example 1-33</a> 所示.</p>
<h4 id="1-4-3-2-Example-1-33-使用-os-模块修改文件的权限和时间戳"><a href="#1-4-3-2-Example-1-33-使用-os-模块修改文件的权限和时间戳" class="headerlink" title="1.4.3.2. Example 1-33. 使用 os 模块修改文件的权限和时间戳"></a>1.4.3.2. Example 1-33. 使用 os 模块修改文件的权限和时间戳</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> stat, time</span><br><span class="line"></span><br><span class="line">infile = <span class="string">"samples/sample.jpg"</span></span><br><span class="line">outfile = <span class="string">"out.jpg"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy contents</span></span><br><span class="line">fi = open(infile, <span class="string">"rb"</span>)</span><br><span class="line">fo = open(outfile, <span class="string">"wb"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    s = fi.read(<span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    fo.write(s)</span><br><span class="line"></span><br><span class="line">fi.close()</span><br><span class="line">fo.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy mode and timestamp</span></span><br><span class="line">st = os.stat(infile)</span><br><span class="line">os.chmod(outfile, stat.S_IMODE(st[stat.ST_MODE]))</span><br><span class="line">os.utime(outfile, (st[stat.ST_ATIME], st[stat.ST_MTIME]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"original"</span>, <span class="string">"=&gt;"</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"mode"</span>, oct(stat.S_IMODE(st[stat.ST_MODE]))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"atime"</span>, time.ctime(st[stat.ST_ATIME])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"mtime"</span>, time.ctime(st[stat.ST_MTIME])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"copy"</span>, <span class="string">"=&gt;"</span></span><br><span class="line">st = os.stat(outfile)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"mode"</span>, oct(stat.S_IMODE(st[stat.ST_MODE]))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"atime"</span>, time.ctime(st[stat.ST_ATIME])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"mtime"</span>, time.ctime(st[stat.ST_MTIME])</span><br><span class="line"></span><br><span class="line">original =&gt;</span><br><span class="line">mode <span class="number">0666</span></span><br><span class="line">atime Thu Oct <span class="number">14</span> <span class="number">15</span>:<span class="number">15</span>:<span class="number">50</span> <span class="number">1999</span></span><br><span class="line">mtime Mon Nov <span class="number">13</span> <span class="number">15</span>:<span class="number">42</span>:<span class="number">36</span> <span class="number">1995</span></span><br><span class="line">copy =&gt;</span><br><span class="line">mode <span class="number">0666</span></span><br><span class="line">atime Thu Oct <span class="number">14</span> <span class="number">15</span>:<span class="number">15</span>:<span class="number">50</span> <span class="number">1999</span></span><br><span class="line">mtime Mon Nov <span class="number">13</span> <span class="number">15</span>:<span class="number">42</span>:<span class="number">36</span> <span class="number">1995</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-4-处理进程"><a href="#1-4-4-处理进程" class="headerlink" title="1.4.4. 处理进程"></a>1.4.4. 处理进程</h3><p>  <code>system</code> 函数在当前进程下执行一个新命令, 并等待它完成, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-34" target="_blank" rel="noopener">Example 1-34</a> 所示.</p>
<h4 id="1-4-4-1-Example-1-34-使用-os-执行操作系统命令"><a href="#1-4-4-1-Example-1-34-使用-os-执行操作系统命令" class="headerlink" title="1.4.4.1. Example 1-34. 使用 os 执行操作系统命令"></a>1.4.4.1. Example 1-34. 使用 os 执行操作系统命令</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-8.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.name == <span class="string">"nt"</span>:</span><br><span class="line">    command = <span class="string">"dir"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    command = <span class="string">"ls -l"</span></span><br><span class="line"></span><br><span class="line">os.system(command)</span><br><span class="line"></span><br><span class="line">-rwxrw-r--   <span class="number">1</span> effbot  effbot        <span class="number">76</span> Oct  <span class="number">9</span> <span class="number">14</span>:<span class="number">17</span> README</span><br><span class="line">-rwxrw-r--   <span class="number">1</span> effbot  effbot      <span class="number">1727</span> Oct  <span class="number">7</span> <span class="number">19</span>:<span class="number">00</span> SimpleAsyncHTTP.py</span><br><span class="line">-rwxrw-r--   <span class="number">1</span> effbot  effbot       <span class="number">314</span> Oct  <span class="number">7</span> <span class="number">20</span>:<span class="number">29</span> aifc-example<span class="number">-1.</span>py</span><br><span class="line">-rwxrw-r--   <span class="number">1</span> effbot  effbot       <span class="number">259</span> Oct  <span class="number">7</span> <span class="number">20</span>:<span class="number">38</span> anydbm-example<span class="number">-1.</span>py</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  命令通过操作系统的标准 shell 执行, 并返回 shell 的退出状态. 需要注意的是在 Windows 95/98 下, shell 通常是 <code>command.com</code> , 它的退出状态总是 0.</p>
<ul>
<li><p>由于 os.system 直接将命令传递给 shell , 所以如果你不检查传入参数的时候会很危险</p>
<p>(比如命令 <code>os.system(&quot;viewer %s&quot; % file)</code>, 将 file 变量设置为 “<code>sample.jpg; rm -rf $HOME&quot; ....</code>). 如果不确定参数的安全性, 那么最好使用 <code>exec</code> 或 <code>spawn</code> 代替(稍后介绍).</p>
<p><code>exec</code> 函数会使用新进程替换当前进程(或者说是”转到进程”). 在 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-35" target="_blank" rel="noopener">Example 1-35</a> 中, 字符串 “goodbye” 永远不会被打印.</p>
</li>
</ul>
<h4 id="1-4-4-2-Example-1-35-使用-os-模块启动新进程"><a href="#1-4-4-2-Example-1-35-使用-os-模块启动新进程" class="headerlink" title="1.4.4.2. Example 1-35. 使用 os 模块启动新进程"></a>1.4.4.2. Example 1-35. 使用 os 模块启动新进程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File: os-<span class="keyword">exec</span>-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">program = <span class="string">"python"</span></span><br><span class="line">arguments = [<span class="string">"hello.py"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> os.execvp(program, (program,) +  tuple(arguments))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"goodbye"</span></span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br></pre></td></tr></table></figure>

<p>  Python 提供了很多表现不同的 <code>exec</code> 函数. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-35" target="_blank" rel="noopener">Example 1-35</a> 使用的是 <code>execvp</code> 函数, 它会从标准路径搜索执行程序, 把第二个参数(元组)作为单独的参数传递给程序, 并使用当前的环境变量来运行程序. 其他七个同类型函数请参阅 <em>Python Library Reference</em> .</p>
<p>  在 Unix 环境下, 你可以通过组合使用 <code>exec</code> , <code>fork</code> 以及 <code>wait</code> 函数来从当前程序调用另一个程序, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-36" target="_blank" rel="noopener">Example 1-36</a> 所示. <code>fork</code> 函数复制当前进程, <code>wait</code> 函数会等待一个子进程执行结束.</p>
<h4 id="1-4-4-3-Example-1-36-使用-os-模块调用其他程序-Unix"><a href="#1-4-4-3-Example-1-36-使用-os-模块调用其他程序-Unix" class="headerlink" title="1.4.4.3. Example 1-36. 使用 os 模块调用其他程序 (Unix)"></a>1.4.4.3. Example 1-36. 使用 os 模块调用其他程序 (Unix)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">File: os-<span class="keyword">exec</span>-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(program, *args)</span>:</span></span><br><span class="line">    pid = os.fork()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pid:</span><br><span class="line">        os.execvp(program, (program,) +  args)</span><br><span class="line">    <span class="keyword">return</span> os.wait()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">run(<span class="string">"python"</span>, <span class="string">"hello.py"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"goodbye"</span></span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">goodbye</span><br></pre></td></tr></table></figure>

<p>  <code>fork</code> 函数在子进程返回中返回 0 (这个进程首先从 <code>fork</code> 返回值), 在父进程中返回一个非 0 的进程标识符(子进程的 PID ). 也就是说, 只有当我们处于子进程的时候 “<code>not pid</code>“ 才为真.</p>
<p>  <code>fork</code> 和 <code>wait</code> 函数在 Windows 上是不可用的, 但是你可以使用 <code>spawn</code> 函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-37" target="_blank" rel="noopener">Example 1-37</a> 所示. 不过, <code>spawn</code> 不会沿着路径搜索可执行文件, 你必须自己处理好这些.</p>
<h4 id="1-4-4-4-Example-1-37-使用-os-模块调用其他程序-Windows"><a href="#1-4-4-4-Example-1-37-使用-os-模块调用其他程序-Windows" class="headerlink" title="1.4.4.4. Example 1-37. 使用 os 模块调用其他程序 (Windows)"></a>1.4.4.4. Example 1-37. 使用 os 模块调用其他程序 (Windows)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: os-spawn-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(program, *args)</span>:</span></span><br><span class="line">    <span class="comment"># find executable</span></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> string.split(os.environ[<span class="string">"PATH"</span>], os.pathsep):</span><br><span class="line">        file = os.path.join(path, program) + <span class="string">".exe"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> os.spawnv(os.P_WAIT, file, (file,) + args)</span><br><span class="line">        <span class="keyword">except</span> os.error:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">raise</span> os.error, <span class="string">"cannot find executable"</span></span><br><span class="line"></span><br><span class="line">run(<span class="string">"python"</span>, <span class="string">"hello.py"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"goodbye"</span></span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">goodbye</span><br></pre></td></tr></table></figure>

<p>  <code>spawn</code> 函数还可用于在后台运行一个程序. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-38" target="_blank" rel="noopener">Example 1-38</a> 给 <code>run</code> 函数添加了一个可选的 <code>mode</code> 参数; 当设置为 <code>os.P_NOWAIT</code> 时, 这个脚本不会等待子程序结束, 默认值 <code>os.P_WAIT</code> 时 <code>spawn</code> 会等待子进程结束.</p>
<p>  其它的标志常量还有 <code>os.P_OVERLAY</code> ,它使得 <code>spawn</code> 的行为和 <code>exec</code> 类似, 以及 <code>os.P_DETACH</code> , 它在后台运行子进程, 与当前控制台和键盘焦点隔离.</p>
<h4 id="1-4-4-5-Example-1-38-使用-os-模块在后台执行程序-Windows"><a href="#1-4-4-5-Example-1-38-使用-os-模块在后台执行程序-Windows" class="headerlink" title="1.4.4.5. Example 1-38. 使用 os 模块在后台执行程序 (Windows)"></a>1.4.4.5. Example 1-38. 使用 os 模块在后台执行程序 (Windows)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: os-spawn-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(program, *args, **kw)</span>:</span></span><br><span class="line">    <span class="comment"># find executable</span></span><br><span class="line">    mode = kw.get(<span class="string">"mode"</span>, os.P_WAIT)</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> string.split(os.environ[<span class="string">"PATH"</span>], os.pathsep):</span><br><span class="line">        file = os.path.join(path, program) + <span class="string">".exe"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> os.spawnv(mode, file, (file,) + args)</span><br><span class="line">        <span class="keyword">except</span> os.error:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">raise</span> os.error, <span class="string">"cannot find executable"</span></span><br><span class="line"></span><br><span class="line">run(<span class="string">"python"</span>, <span class="string">"hello.py"</span>, mode=os.P_NOWAIT)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"goodbye"</span></span><br><span class="line"></span><br><span class="line">goodbye</span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-39" target="_blank" rel="noopener">Example 1-39</a> 提供了一个在 Unix 和 Windows 平台上通用的 <code>spawn</code> 方法.</p>
<h4 id="1-4-4-6-Example-1-39-使用-spawn-或-fork-exec-调用其他程序"><a href="#1-4-4-6-Example-1-39-使用-spawn-或-fork-exec-调用其他程序" class="headerlink" title="1.4.4.6. Example 1-39. 使用 spawn 或 fork/exec 调用其他程序"></a>1.4.4.6. Example 1-39. 使用 spawn 或 fork/exec 调用其他程序</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">File: os-spawn-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.name <span class="keyword">in</span> (<span class="string">"nt"</span>, <span class="string">"dos"</span>):</span><br><span class="line">    exefile = <span class="string">".exe"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    exefile = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(program, *args)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># possible 2.0 shortcut!</span></span><br><span class="line">        <span class="keyword">return</span> os.spawnvp(program, (program,) + args)</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        spawnv = os.spawnv</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># assume it's unix</span></span><br><span class="line">        pid = os.fork()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pid:</span><br><span class="line">            os.execvp(program, (program,) + args)</span><br><span class="line">        <span class="keyword">return</span> os.wait()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># got spawnv but no spawnp: go look for an executable</span></span><br><span class="line">        <span class="keyword">for</span> path <span class="keyword">in</span> string.split(os.environ[<span class="string">"PATH"</span>], os.pathsep):</span><br><span class="line">            file = os.path.join(path, program) + exefile</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> spawnv(os.P_WAIT, file, (file,) + args)</span><br><span class="line">            <span class="keyword">except</span> os.error:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">raise</span> IOError, <span class="string">"cannot find executable"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># try it out!</span></span><br><span class="line"></span><br><span class="line">spawn(<span class="string">"python"</span>, <span class="string">"hello.py"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"goodbye"</span></span><br><span class="line"></span><br><span class="line">hello again, <span class="keyword">and</span> welcome to the show</span><br><span class="line">goodbye</span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-39" target="_blank" rel="noopener">Example 1-39</a> 首先尝试调用 <code>spawnvp</code> 函数. 如果该函数不存在 (一些版本/平台没有这个函数), 它将继续查找一个名为 <code>spawnv</code> 的函数并且 开始查找程序路径. 作为最后的选择, 它会调用 <code>exec</code> 和 <code>fork</code> 函数完成工作.</p>
<h3 id="1-4-5-处理守护进程-Daemon-Processes"><a href="#1-4-5-处理守护进程-Daemon-Processes" class="headerlink" title="1.4.5. 处理守护进程(Daemon Processes)"></a>1.4.5. 处理守护进程(Daemon Processes)</h3><p>  Unix 系统中, 你可以使用 <code>fork</code> 函数把当前进程转入后台(一个”守护者/daemon”). 一般来说, 你需要派生(fork off)一个当前进程的副本, 然后终止原进程, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-40" target="_blank" rel="noopener">Example 1-40</a> 所示.</p>
<h4 id="1-4-5-1-Example-1-40-使用-os-模块使脚本作为守护执行-Unix"><a href="#1-4-5-1-Example-1-40-使用-os-模块使脚本作为守护执行-Unix" class="headerlink" title="1.4.5.1. Example 1-40. 使用 os 模块使脚本作为守护执行 (Unix)"></a>1.4.5.1. Example 1-40. 使用 os 模块使脚本作为守护执行 (Unix)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-14.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid:</span><br><span class="line">    os._exit(<span class="number">0</span>) <span class="comment"># kill original</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"daemon started"</span></span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"daemon terminated"</span></span><br></pre></td></tr></table></figure>

<p>  需要创建一个真正的后台程序稍微有点复杂, 首先调用 <code>setpgrp</code> 函数创建一个 “进程组首领/process group leader”. 否则, 向无关进程组发送的信号(同时)会引起守护进程的问题:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.setpgrp()</span><br></pre></td></tr></table></figure>

<p>  为了确保守护进程创建的文件能够获得程序指定的 mode flags(权限模式标记?), 最好删除 user mode mask:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.umask(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>  然后, 你应该重定向 <em>stdout/stderr</em> 文件, 而不能只是简单地关闭它们(如果你的程序需要 <code>stdout</code> 或 <code>stderr</code> 写入内容的时候, 可能会出现意想不到的问题).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullDevice</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">sys.stdin.close()</span><br><span class="line">sys.stdout = NullDevice()</span><br><span class="line">sys.stderr = NullDevice()</span><br></pre></td></tr></table></figure>

<p>  换言之, 由于 Python 的 <code>print</code> 和 C 中的 <code>printf/fprintf</code> 在设备(device) 没有连接后不会关闭你的程序, 此时守护进程中的 <code>sys.stdout.write()</code> 会抛出一个 <em>IOError</em> 异常, 而你的程序依然在后台运行的很好….</p>
<p>  另外, 先前例子中的 <code>_exit</code> 函数会终止当前进程. 而 <code>sys.exit</code> 不同, 如果调用者(caller) 捕获了 <em>SystemExit</em> 异常, 程序仍然会继续执行. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-41" target="_blank" rel="noopener">Example 1-41</a> 所示.</p>
<h4 id="1-4-5-2-Example-1-41-使用-os-模块终止当前进程"><a href="#1-4-5-2-Example-1-41-使用-os-模块终止当前进程" class="headerlink" title="1.4.5.2. Example 1-41. 使用 os 模块终止当前进程"></a>1.4.5.2. Example 1-41. 使用 os 模块终止当前进程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">File: os-example<span class="number">-9.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> SystemExit, value:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"caught exit(%s)"</span> % value</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    os._exit(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">except</span> SystemExit, value:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"caught exit(%s)"</span> % value</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"bye!"</span></span><br><span class="line"></span><br><span class="line">caught exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-5-os-path-模块"><a href="#1-5-os-path-模块" class="headerlink" title="1.5. os.path 模块"></a>1.5. os.path 模块</h2><p>  <code>os.path</code> 模块包含了各种处理长文件名(路径名)的函数. 先导入 (import) <code>os</code> 模块, 然后就可以以 <code>os.path</code> 访问该模块.</p>
<h3 id="1-5-1-处理文件名"><a href="#1-5-1-处理文件名" class="headerlink" title="1.5.1. 处理文件名"></a>1.5.1. 处理文件名</h3><p>  <code>os.path</code> 模块包含了许多与平台无关的处理长文件名的函数. 也就是说, 你不需要处理前后斜杠, 冒号等. 我们可以看看 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-42" target="_blank" rel="noopener">Example 1-42</a> 中的样例代码.</p>
<h4 id="1-5-1-1-Example-1-42-使用-os-path-模块处理文件名"><a href="#1-5-1-1-Example-1-42-使用-os-path-模块处理文件名" class="headerlink" title="1.5.1.1. Example 1-42. 使用 os.path 模块处理文件名"></a>1.5.1.1. Example 1-42. 使用 os.path 模块处理文件名</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">filename = <span class="string">"my/little/pony"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"using"</span>, os.name, <span class="string">"..."</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"split"</span>, <span class="string">"=&gt;"</span>, os.path.split(filename)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"splitext"</span>, <span class="string">"=&gt;"</span>, os.path.splitext(filename)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"dirname"</span>, <span class="string">"=&gt;"</span>, os.path.dirname(filename)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"basename"</span>, <span class="string">"=&gt;"</span>, os.path.basename(filename)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"join"</span>, <span class="string">"=&gt;"</span>, os.path.join(os.path.dirname(filename),</span><br><span class="line">                                 os.path.basename(filename))</span><br><span class="line"></span><br><span class="line">using nt ...</span><br><span class="line">split =&gt; ('my/little', 'pony')</span><br><span class="line">splitext =&gt; ('my/little/pony', '')</span><br><span class="line">dirname =&gt; my/little</span><br><span class="line">basename =&gt; pony</span><br><span class="line">join =&gt; my/little\pony</span><br></pre></td></tr></table></figure>

<p>  注意这里的 <code>split</code> 只分割出最后一项(不带斜杠).</p>
<p>  <code>os.path</code> 模块中还有许多函数允许你简单快速地获知文件名的一些特征，如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-43" target="_blank" rel="noopener">Example 1-43</a> 所示。</p>
<h4 id="1-5-1-2-Example-1-43-使用-os-path-模块检查文件名的特征"><a href="#1-5-1-2-Example-1-43-使用-os-path-模块检查文件名的特征" class="headerlink" title="1.5.1.2. Example 1-43. 使用 os.path 模块检查文件名的特征"></a>1.5.1.2. Example 1-43. 使用 os.path 模块检查文件名的特征</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FILES = (</span><br><span class="line">    os.curdir,</span><br><span class="line">    <span class="string">"/"</span>,</span><br><span class="line">    <span class="string">"file"</span>,</span><br><span class="line">    <span class="string">"/file"</span>,</span><br><span class="line">    <span class="string">"samples"</span>,</span><br><span class="line">    <span class="string">"samples/sample.jpg"</span>,</span><br><span class="line">    <span class="string">"directory/file"</span>,</span><br><span class="line">    <span class="string">"../directory/file"</span>,</span><br><span class="line">    <span class="string">"/directory/file"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> FILES:</span><br><span class="line">    <span class="keyword">print</span> file, <span class="string">"=&gt;"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"EXISTS"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.isabs(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ISABS"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ISDIR"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ISFILE"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.islink(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ISLINK"</span>,</span><br><span class="line">    <span class="keyword">if</span> os.path.ismount(file):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ISMOUNT"</span>,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">. =&gt; EXISTS ISDIR</span><br><span class="line">/ =&gt; EXISTS ISABS ISDIR ISMOUNT</span><br><span class="line">file =&gt;</span><br><span class="line">/file =&gt; ISABS</span><br><span class="line">samples =&gt; EXISTS ISDIR</span><br><span class="line">samples/sample.jpg =&gt; EXISTS ISFILE</span><br><span class="line">directory/file =&gt;</span><br><span class="line">../directory/file =&gt;</span><br><span class="line">/directory/file =&gt; ISABS</span><br></pre></td></tr></table></figure>

<p>  <code>expanduser</code> 函数以与大部分Unix shell相同的方式处理用户名快捷符号(~, 不过在 Windows 下工作不正常), 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-44" target="_blank" rel="noopener">Example 1-44</a> 所示.</p>
<h4 id="1-5-1-3-Example-1-44-使用-os-path-模块将用户名插入到文件名"><a href="#1-5-1-3-Example-1-44-使用-os-path-模块将用户名插入到文件名" class="headerlink" title="1.5.1.3. Example 1-44. 使用 os.path 模块将用户名插入到文件名"></a>1.5.1.3. Example 1-44. 使用 os.path 模块将用户名插入到文件名</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-expanduser-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> os.path.expanduser(<span class="string">"~/.pythonrc"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># /home/effbot/.pythonrc</span></span><br></pre></td></tr></table></figure>

<p>  <code>expandvars</code> 函数将文件名中的环境变量替换为对应值, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-45" target="_blank" rel="noopener">Example 1-45</a> 所示.</p>
<h4 id="1-5-1-4-Example-1-45-使用-os-path-替换文件名中的环境变量"><a href="#1-5-1-4-Example-1-45-使用-os-path-替换文件名中的环境变量" class="headerlink" title="1.5.1.4. Example 1-45. 使用 os.path 替换文件名中的环境变量"></a>1.5.1.4. Example 1-45. 使用 os.path 替换文件名中的环境变量</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-expandvars-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">"USER"</span>] = <span class="string">"user"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> os.path.expandvars(<span class="string">"/home/$USER/config"</span>)</span><br><span class="line"><span class="keyword">print</span> os.path.expandvars(<span class="string">"$USER/folders"</span>)</span><br><span class="line"></span><br><span class="line">/home/user/config</span><br><span class="line">user/folders</span><br></pre></td></tr></table></figure>

<h3 id="1-5-2-搜索文件系统"><a href="#1-5-2-搜索文件系统" class="headerlink" title="1.5.2. 搜索文件系统"></a>1.5.2. 搜索文件系统</h3><p>  <code>walk</code> 函数会帮你找出一个目录树下的所有文件 (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-46" target="_blank" rel="noopener">Example 1-46</a></p>
<ul>
<li>所示). 它的参数依次是目录名, 回调函数, 以及传递给回调函数的数据对象.</li>
</ul>
<h4 id="1-5-2-1-Example-1-46-使用-os-path-搜索文件系统"><a href="#1-5-2-1-Example-1-46-使用-os-path-搜索文件系统" class="headerlink" title="1.5.2.1. Example 1-46. 使用 os.path 搜索文件系统"></a>1.5.2.1. Example 1-46. 使用 os.path 搜索文件系统</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-walk-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(arg, directory, files)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">print</span> os.path.join(directory, file), repr(arg)</span><br><span class="line"></span><br><span class="line">os.path.walk(<span class="string">"."</span>, callback, <span class="string">"secret message"</span>)</span><br><span class="line"></span><br><span class="line">./aifc-example<span class="number">-1.</span>py <span class="string">'secret message'</span></span><br><span class="line">./anydbm-example<span class="number">-1.</span>py <span class="string">'secret message'</span></span><br><span class="line">./array-example<span class="number">-1.</span>py <span class="string">'secret message'</span></span><br><span class="line">...</span><br><span class="line">./samples <span class="string">'secret message'</span></span><br><span class="line">./samples/sample.jpg <span class="string">'secret message'</span></span><br><span class="line">./samples/sample.txt <span class="string">'secret message'</span></span><br><span class="line">./samples/sample.zip <span class="string">'secret message'</span></span><br><span class="line">./samples/articles <span class="string">'secret message'</span></span><br><span class="line">./samples/articles/article<span class="number">-1.</span>txt <span class="string">'secret message'</span></span><br><span class="line">./samples/articles/article<span class="number">-2.</span>txt <span class="string">'secret message'</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  <code>walk</code> 函数的接口多少有点晦涩 (也许只是对我个人而言, 我总是记不住参数的顺序). <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-47" target="_blank" rel="noopener">Example 1-47</a> 中展示的 <code>index</code> 函数会返回一个文件名列表, 你可以直接使用 <code>for-in</code> 循环处理文件.</p>
<h4 id="1-5-2-2-Example-1-47-使用-os-listdir-搜索文件系统"><a href="#1-5-2-2-Example-1-47-使用-os-listdir-搜索文件系统" class="headerlink" title="1.5.2.2. Example 1-47. 使用 os.listdir 搜索文件系统"></a>1.5.2.2. Example 1-47. 使用 os.listdir 搜索文件系统</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-walk-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(directory)</span>:</span></span><br><span class="line">    <span class="comment"># like os.listdir, but traverses directory trees</span></span><br><span class="line">    stack = [directory]</span><br><span class="line">    files = []</span><br><span class="line">    <span class="keyword">while</span> stack:</span><br><span class="line">        directory = stack.pop()</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(directory):</span><br><span class="line">            fullname = os.path.join(directory, file)</span><br><span class="line">            files.append(fullname)</span><br><span class="line">            <span class="keyword">if</span> os.path.isdir(fullname) <span class="keyword">and</span> <span class="keyword">not</span> os.path.islink(fullname):</span><br><span class="line">                stack.append(fullname)</span><br><span class="line">    <span class="keyword">return</span> files</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> index(<span class="string">"."</span>):</span><br><span class="line">    <span class="keyword">print</span> file</span><br><span class="line"></span><br><span class="line">.\aifc-example<span class="number">-1.</span>py</span><br><span class="line">.\anydbm-example<span class="number">-1.</span>py</span><br><span class="line">.\array-example<span class="number">-1.</span>py</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  如果你不想列出所有的文件 (基于性能或者是内存的考虑) , <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-48" target="_blank" rel="noopener">Example 1-48</a> 展示了另一种方法. 这里 <em>DirectoryWalker</em> 类的行为与序列对象相似, 一次返回一个文件. (generator?)</p>
<h4 id="1-5-2-3-Example-1-48-使用-DirectoryWalker-搜索文件系统"><a href="#1-5-2-3-Example-1-48-使用-DirectoryWalker-搜索文件系统" class="headerlink" title="1.5.2.3. Example 1-48. 使用 DirectoryWalker 搜索文件系统"></a>1.5.2.3. Example 1-48. 使用 DirectoryWalker 搜索文件系统</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-walk-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectoryWalker</span>:</span></span><br><span class="line">    <span class="comment"># a forward iterator that traverses a directory tree</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, directory)</span>:</span></span><br><span class="line">        self.stack = [directory]</span><br><span class="line">        self.files = []</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_getitem_</span> <span class="title">_</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = self.files[self.index]</span><br><span class="line">                self.index = self.index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="comment"># pop next directory from stack</span></span><br><span class="line">                self.directory = self.stack.pop()</span><br><span class="line">                self.files = os.listdir(self.directory)</span><br><span class="line">                self.index = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># got a filename</span></span><br><span class="line">                fullname = os.path.join(self.directory, file)</span><br><span class="line">                <span class="keyword">if</span> os.path.isdir(fullname) <span class="keyword">and</span> <span class="keyword">not</span> os.path.islink(fullname):</span><br><span class="line">                    self.stack.append(fullname)</span><br><span class="line">                <span class="keyword">return</span> fullname</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> DirectoryWalker(<span class="string">"."</span>):</span><br><span class="line">    <span class="keyword">print</span> file</span><br><span class="line"></span><br><span class="line">.\aifc-example<span class="number">-1.</span>py</span><br><span class="line">.\anydbm-example<span class="number">-1.</span>py</span><br><span class="line">.\array-example<span class="number">-1.</span>py</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>  注意 <em>DirectoryWalker</em> 类并不检查传递给 <code>_ _getitem_ _</code> 方法的索引值. 这意味着如果你越界访问序列成员(索引数字过大)的话, 这个类将不能正常工作.</p>
<p>  最后, 如果你需要处理文件大小和时间戳, <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-49" target="_blank" rel="noopener">Example 1-49</a> 给出了一个类, 它返回文件名和它的 <code>os.stat</code> 属性(一个元组). 这个版本在每个文件上都能节省一次或两次 <code>stat</code> 调用( <code>os.path.isdir</code> 和 <code>os.path.islink</code> 内部都使用了 <code>stat</code> ), 并且在一些平台上运行很快.</p>
<h4 id="1-5-2-4-Example-1-49-使用-DirectoryStatWalker-搜索文件系统"><a href="#1-5-2-4-Example-1-49-使用-DirectoryStatWalker-搜索文件系统" class="headerlink" title="1.5.2.4. Example 1-49. 使用 DirectoryStatWalker 搜索文件系统"></a>1.5.2.4. Example 1-49. 使用 DirectoryStatWalker 搜索文件系统</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">File: os-path-walk-example<span class="number">-4.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, stat</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectoryStatWalker</span>:</span></span><br><span class="line">    <span class="comment"># a forward iterator that traverses a directory tree, and</span></span><br><span class="line">    <span class="comment"># returns the filename and additional file information</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, directory)</span>:</span></span><br><span class="line">        self.stack = [directory]</span><br><span class="line">        self.files = []</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_getitem_</span> <span class="title">_</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = self.files[self.index]</span><br><span class="line">                self.index = self.index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="comment"># pop next directory from stack</span></span><br><span class="line">                self.directory = self.stack.pop()</span><br><span class="line">                self.files = os.listdir(self.directory)</span><br><span class="line">                self.index = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># got a filename</span></span><br><span class="line">                fullname = os.path.join(self.directory, file)</span><br><span class="line">                st = os.stat(fullname)</span><br><span class="line">                mode = st[stat.ST_MODE]</span><br><span class="line">                <span class="keyword">if</span> stat.S_ISDIR(mode) <span class="keyword">and</span> <span class="keyword">not</span> stat.S_ISLNK(mode):</span><br><span class="line">                    self.stack.append(fullname)</span><br><span class="line">                <span class="keyword">return</span> fullname, st</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file, st <span class="keyword">in</span> DirectoryStatWalker(<span class="string">"."</span>):</span><br><span class="line">    <span class="keyword">print</span> file, st[stat.ST_SIZE]</span><br><span class="line"></span><br><span class="line">.\aifc-example<span class="number">-1.</span>py <span class="number">336</span></span><br><span class="line">.\anydbm-example<span class="number">-1.</span>py <span class="number">244</span></span><br><span class="line">.\array-example<span class="number">-1.</span>py <span class="number">526</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-6-stat-模块"><a href="#1-6-stat-模块" class="headerlink" title="1.6. stat 模块"></a>1.6. stat 模块</h2><p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-50" target="_blank" rel="noopener">Example 1-50</a> 展示了 <code>stat</code> 模块的基本用法, 这个模块包含了一些 <code>os.stat</code> 函数中可用的常量和测试函数.</p>
<h4 id="1-6-0-1-Example-1-50-Using-the-stat-Module"><a href="#1-6-0-1-Example-1-50-Using-the-stat-Module" class="headerlink" title="1.6.0.1. Example 1-50. Using the stat Module"></a>1.6.0.1. Example 1-50. Using the stat Module</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">File: stat-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> stat</span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"></span><br><span class="line">st = os.stat(<span class="string">"samples/sample.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"mode"</span>, <span class="string">"=&gt;"</span>, oct(stat.S_IMODE(st[stat.ST_MODE]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"type"</span>, <span class="string">"=&gt;"</span>,</span><br><span class="line"><span class="keyword">if</span> stat.S_ISDIR(st[stat.ST_MODE]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"DIRECTORY"</span>,</span><br><span class="line"><span class="keyword">if</span> stat.S_ISREG(st[stat.ST_MODE]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"REGULAR"</span>,</span><br><span class="line"><span class="keyword">if</span> stat.S_ISLNK(st[stat.ST_MODE]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"LINK"</span>,</span><br><span class="line"><span class="keyword">print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"size"</span>, <span class="string">"=&gt;"</span>, st[stat.ST_SIZE]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"last accessed"</span>, <span class="string">"=&gt;"</span>, time.ctime(st[stat.ST_ATIME])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"last modified"</span>, <span class="string">"=&gt;"</span>, time.ctime(st[stat.ST_MTIME])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"inode changed"</span>, <span class="string">"=&gt;"</span>, time.ctime(st[stat.ST_CTIME])</span><br><span class="line"></span><br><span class="line">mode =&gt; 0664</span><br><span class="line">type =&gt; REGULAR</span><br><span class="line">size =&gt; 305</span><br><span class="line">last accessed =&gt; Sun Oct 10 22:12:30 1999</span><br><span class="line">last modified =&gt; Sun Oct 10 18:39:37 1999</span><br><span class="line">inode changed =&gt; Sun Oct 10 15:26:38 1999</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-7-string-模块"><a href="#1-7-string-模块" class="headerlink" title="1.7. string 模块"></a>1.7. string 模块</h2><p>  <code>string</code> 模块提供了一些用于处理字符串类型的函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-51" target="_blank" rel="noopener">Example 1-51</a> 所示.</p>
<h4 id="1-7-0-1-Example-1-51-使用-string-模块"><a href="#1-7-0-1-Example-1-51-使用-string-模块" class="headerlink" title="1.7.0.1. Example 1-51. 使用 string 模块"></a>1.7.0.1. Example 1-51. 使用 string 模块</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: string-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">text = <span class="string">"Monty Python's Flying Circus"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"upper"</span>, <span class="string">"=&gt;"</span>, string.upper(text)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"lower"</span>, <span class="string">"=&gt;"</span>, string.lower(text)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"split"</span>, <span class="string">"=&gt;"</span>, string.split(text)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"join"</span>, <span class="string">"=&gt;"</span>, string.join(string.split(text), <span class="string">"+"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"replace"</span>, <span class="string">"=&gt;"</span>, string.replace(text, <span class="string">"Python"</span>, <span class="string">"Java"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"find"</span>, <span class="string">"=&gt;"</span>, string.find(text, <span class="string">"Python"</span>), string.find(text, <span class="string">"Java"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"count"</span>, <span class="string">"=&gt;"</span>, string.count(text, <span class="string">"n"</span>)</span><br><span class="line"></span><br><span class="line">upper =&gt; MONTY PYTHON'S FLYING CIRCUS</span><br><span class="line">lower =&gt; monty python's flying circus</span><br><span class="line">split =&gt; ['Monty', "Python's", 'Flying', 'Circus']</span><br><span class="line">join =&gt; Monty+Python's+Flying+Circus</span><br><span class="line">replace =&gt; Monty Java's Flying Circus</span><br><span class="line">find =&gt; 6 -1</span><br><span class="line">count =&gt; 3</span><br></pre></td></tr></table></figure>

<p>  在 Python 1.5.2 以及更早版本中, <code>string</code> 使用 <code>strop</code> 中的函数来实现模块功能.</p>
<p>  在 Python1.6 和后继版本，更多的字符串操作都可以作为字符串方法来访问, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-52" target="_blank" rel="noopener">Example 1-52</a> 所示, <code>string</code> 模块中的许多函数只是对相对应字符串方法的封装.</p>
<h4 id="1-7-0-2-Example-1-52-使用字符串方法替代-string-模块函数"><a href="#1-7-0-2-Example-1-52-使用字符串方法替代-string-模块函数" class="headerlink" title="1.7.0.2. Example 1-52. 使用字符串方法替代 string 模块函数"></a>1.7.0.2. Example 1-52. 使用字符串方法替代 string 模块函数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: string-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line">text = <span class="string">"Monty Python's Flying Circus"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"upper"</span>, <span class="string">"=&gt;"</span>, text.upper()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"lower"</span>, <span class="string">"=&gt;"</span>, text.lower()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"split"</span>, <span class="string">"=&gt;"</span>, text.split()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"join"</span>, <span class="string">"=&gt;"</span>, <span class="string">"+"</span>.join(text.split())</span><br><span class="line"><span class="keyword">print</span> <span class="string">"replace"</span>, <span class="string">"=&gt;"</span>, text.replace(<span class="string">"Python"</span>, <span class="string">"Perl"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"find"</span>, <span class="string">"=&gt;"</span>, text.find(<span class="string">"Python"</span>), text.find(<span class="string">"Perl"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"count"</span>, <span class="string">"=&gt;"</span>, text.count(<span class="string">"n"</span>)</span><br><span class="line"></span><br><span class="line">upper =&gt; MONTY PYTHON'S FLYING CIRCUS</span><br><span class="line">lower =&gt; monty python's flying circus</span><br><span class="line">split =&gt; ['Monty', "Python's", 'Flying', 'Circus']</span><br><span class="line">join =&gt; Monty+Python's+Flying+Circus</span><br><span class="line">replace =&gt; Monty Perl's Flying Circus</span><br><span class="line">find =&gt; 6 -1</span><br><span class="line">count =&gt; 3</span><br></pre></td></tr></table></figure>

<p>  为了增强模块对字符的处理能力, 除了字符串方法, <code>string</code> 模块还包含了类型转换函数用于把字符串转换为其他类型, (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-53" target="_blank" rel="noopener">Example 1-53</a> 所示).</p>
<h4 id="1-7-0-3-Example-1-53-使用-string-模块将字符串转为数字"><a href="#1-7-0-3-Example-1-53-使用-string-模块将字符串转为数字" class="headerlink" title="1.7.0.3. Example 1-53. 使用 string 模块将字符串转为数字"></a>1.7.0.3. Example 1-53. 使用 string 模块将字符串转为数字</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: string-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> int(<span class="string">"4711"</span>),</span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"4711"</span>),</span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"11147"</span>, <span class="number">8</span>), <span class="comment"># octal 八进制</span></span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"1267"</span>, <span class="number">16</span>), <span class="comment"># hexadecimal 十六进制</span></span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"3mv"</span>, <span class="number">36</span>) <span class="comment"># whatever...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"4711"</span>, <span class="number">0</span>),</span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"04711"</span>, <span class="number">0</span>),</span><br><span class="line"><span class="keyword">print</span> string.atoi(<span class="string">"0x4711"</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> float(<span class="string">"4711"</span>),</span><br><span class="line"><span class="keyword">print</span> string.atof(<span class="string">"1"</span>),</span><br><span class="line"><span class="keyword">print</span> string.atof(<span class="string">"1.23e5"</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">4711</span> <span class="number">4711</span> <span class="number">4711</span> <span class="number">4711</span> <span class="number">4711</span></span><br><span class="line"><span class="number">4711</span> <span class="number">2505</span> <span class="number">18193</span></span><br><span class="line"><span class="number">4711.0</span> <span class="number">1.0</span> <span class="number">123000.0</span></span><br></pre></td></tr></table></figure>

<p>  大多数情况下 (特别是当你使用的是1.6及更高版本时) ，你可以使用 <code>int</code> 和 <code>float</code> 函数代替 <code>string</code> 模块中对应的函数。</p>
<p>  <code>atoi</code> 函数可以接受可选的第二个参数, 指定数基(number base). 如果数基为 0, 那么函数将检查字符串的前几个字符来决定使用的数基: 如果为 “0x,” 数基将为 16 (十六进制), 如果为 “0,” 则数基为 8 (八进制). 默认数基值为 10 (十进制), 当你未传递参数时就使用这个值.</p>
<p>  在 1.6 及以后版本中, <code>int</code> 函数和 <code>atoi</code> 一样可以接受第二个参数. 与字符串版本函数不一样的是 , <code>int</code> 和 <code>float</code> 可以接受 Unicode 字符串对象.</p>
<hr>
<h2 id="1-8-re-模块"><a href="#1-8-re-模块" class="headerlink" title="1.8. re 模块"></a>1.8. re 模块</h2><ul>
<li><p>“Some people, when confronted with a problem, think ‘I know, I’ll use regular expressions.’ Now they have two problems.” - Jamie Zawinski, on comp.lang.emacs</p>
<p><code>re</code> 模块提供了一系列功能强大的正则表达式 (regular expression) 工具, 它们允许你快速检查给定字符串是否与给定的模式匹配 (使用 <code>match</code> 函数), 或者包含这个模式 (使用 <code>search</code> 函数). 正则表达式是以紧凑(也很神秘)的语法写出的字符串模式.</p>
<p><code>match</code> 尝试从字符串的起始匹配一个模式, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-54" target="_blank" rel="noopener">Example 1-54</a> 所示. 如果模式匹配了某些内容 (包括空字符串, 如果模式允许的话) , 它将返回一个匹配对象. 使用它的 <code>group</code> 方法可以找出匹配的内容.</p>
</li>
</ul>
<h4 id="1-8-0-1-Example-1-54-使用-re-模块来匹配字符串"><a href="#1-8-0-1-Example-1-54-使用-re-模块来匹配字符串" class="headerlink" title="1.8.0.1. Example 1-54. 使用 re 模块来匹配字符串"></a>1.8.0.1. Example 1-54. 使用 re 模块来匹配字符串</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">"The Attila the Hun Show"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a single character 单个字符</span></span><br><span class="line">m = re.match(<span class="string">"."</span>, text)</span><br><span class="line"><span class="keyword">if</span> m: <span class="keyword">print</span> repr(<span class="string">"."</span>), <span class="string">"=&gt;"</span>, repr(m.group(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># any string of characters 任何字符串</span></span><br><span class="line">m = re.match(<span class="string">".*"</span>, text)</span><br><span class="line"><span class="keyword">if</span> m: <span class="keyword">print</span> repr(<span class="string">".*"</span>), <span class="string">"=&gt;"</span>, repr(m.group(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># a string of letters (at least one) 只包含字母的字符串(至少一个)</span></span><br><span class="line">m = re.match(<span class="string">"\w+"</span>, text)</span><br><span class="line"><span class="keyword">if</span> m: <span class="keyword">print</span> repr(<span class="string">"\w+"</span>), <span class="string">"=&gt;"</span>, repr(m.group(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># a string of digits 只包含数字的字符串</span></span><br><span class="line">m = re.match(<span class="string">"\d+"</span>, text)</span><br><span class="line"><span class="keyword">if</span> m: <span class="keyword">print</span> repr(<span class="string">"\d+"</span>), <span class="string">"=&gt;"</span>, repr(m.group(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"> '.' =&gt; 'T'</span><br><span class="line">'.*' =&gt; 'The Attila the Hun Show'</span><br><span class="line">'\\w+' =&gt; 'The'</span><br></pre></td></tr></table></figure>

<p>  可以使用圆括号在模式中标记区域. 找到匹配后, <code>group</code> 方法可以抽取这些区域的内容， 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-55" target="_blank" rel="noopener">Example 1-55</a> 所示. <code>group(1)</code> 会返回第一组的内容, <code>group(2)</code> 返回第二组的内容, 这样… 如果你传递多个组数给 <code>group</code> 函数, 它会返回一个元组.</p>
<h4 id="1-8-0-2-Example-1-55-使用-re-模块抽出匹配的子字符串"><a href="#1-8-0-2-Example-1-55-使用-re-模块抽出匹配的子字符串" class="headerlink" title="1.8.0.2. Example 1-55. 使用 re 模块抽出匹配的子字符串"></a>1.8.0.2. Example 1-55. 使用 re 模块抽出匹配的子字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text =<span class="string">"10/15/99"</span></span><br><span class="line"></span><br><span class="line">m = re.match(<span class="string">"(\d&#123;2&#125;)/(\d&#123;2&#125;)/(\d&#123;2,4&#125;)"</span>, text)</span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    <span class="keyword">print</span> m.group(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">(<span class="string">'10'</span>, <span class="string">'15'</span>, <span class="string">'99'</span>)</span><br></pre></td></tr></table></figure>

<p>  <code>search</code> 函数会在字符串内查找模式匹配, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-56" target="_blank" rel="noopener">Example 1-56</a> 所示. 它在所有可能的字符位置尝试匹配模式, 从最左边开始, 一旦找到匹配就返回一个匹配对象. 如果没有找到相应的匹配, 就返回 <em>None</em> .</p>
<h4 id="1-8-0-3-Example-1-56-使用-re-模块搜索子字符串"><a href="#1-8-0-3-Example-1-56-使用-re-模块搜索子字符串" class="headerlink" title="1.8.0.3. Example 1-56. 使用 re 模块搜索子字符串"></a>1.8.0.3. Example 1-56. 使用 re 模块搜索子字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">"Example 3: There is 1 date 10/25/95 in here!"</span></span><br><span class="line"></span><br><span class="line">m = re.search(<span class="string">"(\d&#123;1,2&#125;)/(\d&#123;1,2&#125;)/(\d&#123;2,4&#125;)"</span>, text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> m.group(<span class="number">1</span>), m.group(<span class="number">2</span>), m.group(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">month, day, year = m.group(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> month, day, year</span><br><span class="line"></span><br><span class="line">date = m.group(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">print</span> date</span><br><span class="line"></span><br><span class="line"><span class="number">10</span> <span class="number">25</span> <span class="number">95</span></span><br><span class="line"><span class="number">10</span> <span class="number">25</span> <span class="number">95</span></span><br><span class="line"><span class="number">10</span>/<span class="number">25</span>/<span class="number">95</span></span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-57" target="_blank" rel="noopener">Example 1-57</a> 中展示了 <code>sub</code> 函数, 它可以使用另个字符串替代匹配模式.</p>
<h4 id="1-8-0-4-Example-1-57-使用-re-模块替换子字符串"><a href="#1-8-0-4-Example-1-57-使用-re-模块替换子字符串" class="headerlink" title="1.8.0.4. Example 1-57. 使用 re 模块替换子字符串"></a>1.8.0.4. Example 1-57. 使用 re 模块替换子字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-4.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">"you're no fun anymore..."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># literal replace (string.replace is faster)</span></span><br><span class="line"><span class="comment"># 文字替换 (string.replace 速度更快)</span></span><br><span class="line"><span class="keyword">print</span> re.sub(<span class="string">"fun"</span>, <span class="string">"entertaining"</span>, text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># collapse all non-letter sequences to a single dash </span></span><br><span class="line"><span class="comment"># 将所有非字母序列转换为一个"-"(dansh,破折号)</span></span><br><span class="line"><span class="keyword">print</span> re.sub(<span class="string">"[^\w]+"</span>, <span class="string">"-"</span>, text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert all words to beeps </span></span><br><span class="line"><span class="comment"># 将所有单词替换为 BEEP</span></span><br><span class="line"><span class="keyword">print</span> re.sub(<span class="string">"\S+"</span>, <span class="string">"-BEEP-"</span>, text)</span><br><span class="line"></span><br><span class="line">yo<span class="string">u're no entertaining anymore...</span></span><br><span class="line"><span class="string">you-re-no-fun-anymore-</span></span><br><span class="line"><span class="string">-BEEP- -BEEP- -BEEP- -BEEP-</span></span><br></pre></td></tr></table></figure>

<p>  你也可以通过回调 (callback) 函数使用 <code>sub</code> 来替换指定模式. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-58" target="_blank" rel="noopener">Example 1-58</a> 展示了如何预编译模式.</p>
<h4 id="1-8-0-5-Example-1-58-使用-re-模块替换字符串-通过回调函数"><a href="#1-8-0-5-Example-1-58-使用-re-模块替换字符串-通过回调函数" class="headerlink" title="1.8.0.5. Example 1-58. 使用 re 模块替换字符串(通过回调函数)"></a>1.8.0.5. Example 1-58. 使用 re 模块替换字符串(通过回调函数)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-5.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">text = <span class="string">"a line of text\\012another line of text\\012etc..."</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">octal</span><span class="params">(match)</span>:</span></span><br><span class="line">    <span class="comment"># replace octal code with corresponding ASCII character</span></span><br><span class="line">    <span class="comment"># 使用对应 ASCII 字符替换八进制代码</span></span><br><span class="line">    <span class="keyword">return</span> chr(string.atoi(match.group(<span class="number">1</span>), <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">octal_pattern = re.compile(<span class="string">r"\\(\d\d\d)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> text</span><br><span class="line"><span class="keyword">print</span> octal_pattern.sub(octal, text)</span><br><span class="line"></span><br><span class="line">a line of text\<span class="number">012</span>another line of text\<span class="number">012</span>etc...</span><br><span class="line">a line of text</span><br><span class="line">another line of text</span><br><span class="line">etc...</span><br></pre></td></tr></table></figure>

<p>  如果你不编译, <code>re</code> 模块会为你缓存一个编译后版本, 所有的小脚本中, 通常不需要编译正则表达式. Python1.5.2 中, 缓存中可以容纳 20 个匹配模式, 而在 2.0 中, 缓存则可以容纳 100 个匹配模式.</p>
<p>  最后, <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-59" target="_blank" rel="noopener">Example 1-59</a> 用一个模式列表匹配一个字符串. 这些模式将会组合为一个模式, 并预编译以节省时间.</p>
<h4 id="1-8-0-6-Example-1-59-使用-re-模块匹配多个模式中的一个"><a href="#1-8-0-6-Example-1-59-使用-re-模块匹配多个模式中的一个" class="headerlink" title="1.8.0.6. Example 1-59. 使用 re 模块匹配多个模式中的一个"></a>1.8.0.6. Example 1-59. 使用 re 模块匹配多个模式中的一个</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">File: re-example<span class="number">-6.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re, string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">combined_pattern</span><span class="params">(patterns)</span>:</span></span><br><span class="line">    p = re.compile(</span><br><span class="line">        string.join(map(<span class="keyword">lambda</span> x: <span class="string">"("</span>+x+<span class="string">")"</span>, patterns), <span class="string">"|"</span>)</span><br><span class="line">        )</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fixup</span><span class="params">(v, m=p.match, r=range<span class="params">(<span class="number">0</span>,len<span class="params">(patterns)</span>)</span>)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            regs = m(v).regs</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> <span class="comment"># no match, so m.regs will fail</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">                <span class="keyword">if</span> regs[i+<span class="number">1</span>] != (<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                    <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> fixup</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># try it out!</span></span><br><span class="line"></span><br><span class="line">patterns = [</span><br><span class="line">    <span class="string">r"\d+"</span>,</span><br><span class="line">    <span class="string">r"abc\d&#123;2,4&#125;"</span>,</span><br><span class="line">    <span class="string">r"p\w+"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">p = combined_pattern(patterns)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"129391"</span>)</span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"abc800"</span>)</span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"abc1600"</span>)</span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"python"</span>)</span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"perl"</span>)</span><br><span class="line"><span class="keyword">print</span> p(<span class="string">"tcl"</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-9-math-模块"><a href="#1-9-math-模块" class="headerlink" title="1.9. math 模块"></a>1.9. math 模块</h2><p>  <code>math</code> 模块实现了许多对浮点数的数学运算函数. 这些函数一般是对平台 C 库中同名函数的简单封装, 所以一般情况下, 不同平台下计算的结果可能稍微地有所不同, 有时候甚至有很大出入. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-60" target="_blank" rel="noopener">Example 1-60</a> 展示了如何使用 <code>math</code> 模块.</p>
<h4 id="1-9-0-1-Example-1-60-使用-math-模块"><a href="#1-9-0-1-Example-1-60-使用-math-模块" class="headerlink" title="1.9.0.1. Example 1-60. 使用 math 模块"></a>1.9.0.1. Example 1-60. 使用 math 模块</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File: math-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"e"</span>, <span class="string">"=&gt;"</span>, math.e</span><br><span class="line"><span class="keyword">print</span> <span class="string">"pi"</span>, <span class="string">"=&gt;"</span>, math.pi</span><br><span class="line"><span class="keyword">print</span> <span class="string">"hypot"</span>, <span class="string">"=&gt;"</span>, math.hypot(<span class="number">3.0</span>, <span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># and many others...</span></span><br><span class="line"></span><br><span class="line">e =&gt; 2.71828182846</span><br><span class="line">pi =&gt; 3.14159265359</span><br><span class="line">hypot =&gt; 5.0</span><br></pre></td></tr></table></figure>

<p>  完整函数列表请参阅 <em>Python Library Reference</em> .</p>
<hr>
<h2 id="1-10-cmath-模块"><a href="#1-10-cmath-模块" class="headerlink" title="1.10. cmath 模块"></a>1.10. cmath 模块</h2><p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-61" target="_blank" rel="noopener">Example 1-61</a> 所展示的 <code>cmath</code> 模块包含了一些用于复数运算的函数.</p>
<h4 id="1-10-0-1-Example-1-61-使用-cmath-模块"><a href="#1-10-0-1-Example-1-61-使用-cmath-模块" class="headerlink" title="1.10.0.1. Example 1-61. 使用 cmath 模块"></a>1.10.0.1. Example 1-61. 使用 cmath 模块</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File: cmath-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cmath</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"pi"</span>, <span class="string">"=&gt;"</span>, cmath.pi</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sqrt(-1)"</span>, <span class="string">"=&gt;"</span>, cmath.sqrt(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">pi =&gt; 3.14159265359</span><br><span class="line">sqrt(-1) =&gt; 1j</span><br></pre></td></tr></table></figure>

<p>  完整函数列表请参阅 <em>Python Library Reference</em> .</p>
<hr>
<h2 id="1-11-operator-模块"><a href="#1-11-operator-模块" class="headerlink" title="1.11. operator 模块"></a>1.11. operator 模块</h2><p>  <code>operator</code> 模块为 Python 提供了一个 “功能性” 的标准操作符接口. 当使用 <code>map</code> 以及 <code>filter</code> 一类的函数的时候, <code>operator</code> 模块中的函数可以替换一些 <code>lambda</code> 函式. 而且这些函数在一些喜欢写晦涩代码的程序员中很流行. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-62" target="_blank" rel="noopener">Example 1-62</a> 展示了 <code>operator</code> 模块的一般用法.</p>
<h4 id="1-11-0-1-Example-1-62-使用-operator-模块"><a href="#1-11-0-1-Example-1-62-使用-operator-模块" class="headerlink" title="1.11.0.1. Example 1-62. 使用 operator 模块"></a>1.11.0.1. Example 1-62. 使用 operator 模块</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">File: operator-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line">sequence = <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"add"</span>, <span class="string">"=&gt;"</span>, reduce(operator.add, sequence)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sub"</span>, <span class="string">"=&gt;"</span>, reduce(operator.sub, sequence)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"mul"</span>, <span class="string">"=&gt;"</span>, reduce(operator.mul, sequence)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"concat"</span>, <span class="string">"=&gt;"</span>, operator.concat(<span class="string">"spam"</span>, <span class="string">"egg"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"repeat"</span>, <span class="string">"=&gt;"</span>, operator.repeat(<span class="string">"spam"</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"getitem"</span>, <span class="string">"=&gt;"</span>, operator.getitem(sequence, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"indexOf"</span>, <span class="string">"=&gt;"</span>, operator.indexOf(sequence, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sequenceIncludes"</span>, <span class="string">"=&gt;"</span>, operator.sequenceIncludes(sequence, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add =&gt; 7</span><br><span class="line">sub =&gt; -5</span><br><span class="line">mul =&gt; 8</span><br><span class="line">concat =&gt; spamegg</span><br><span class="line">repeat =&gt; spamspamspamspamspam</span><br><span class="line"></span><br><span class="line">getitem =&gt; 4</span><br><span class="line">indexOf =&gt; 1</span><br><span class="line">sequenceIncludes =&gt; 0</span><br></pre></td></tr></table></figure>

<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-63" target="_blank" rel="noopener">Example 1-63</a> 展示了一些可以用于检查对象类型的 <code>operator</code> 函数.</p>
<h4 id="1-11-0-2-Example-1-63-使用-operator-模块检查类型"><a href="#1-11-0-2-Example-1-63-使用-operator-模块检查类型" class="headerlink" title="1.11.0.2. Example 1-63. 使用 operator 模块检查类型"></a>1.11.0.2. Example 1-63. 使用 operator 模块检查类型</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">File: operator-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> UserList</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> type(data), <span class="string">"=&gt;"</span>,</span><br><span class="line">    <span class="keyword">if</span> operator.isCallable(data):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CALLABLE"</span>,</span><br><span class="line">    <span class="keyword">if</span> operator.isMappingType(data):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"MAPPING"</span>,</span><br><span class="line">    <span class="keyword">if</span> operator.isNumberType(data):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"NUMBER"</span>,</span><br><span class="line">    <span class="keyword">if</span> operator.isSequenceType(data):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"SEQUENCE"</span>,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line">        </span><br><span class="line">dump(<span class="number">0</span>)</span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line">dump(<span class="string">"string"</span>[<span class="number">0</span>])</span><br><span class="line">dump([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">dump((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">dump(&#123;<span class="string">"a"</span>: <span class="number">1</span>&#125;)</span><br><span class="line">dump(len) <span class="comment"># function 函数</span></span><br><span class="line">dump(UserList) <span class="comment"># module 模块</span></span><br><span class="line">dump(UserList.UserList) <span class="comment"># class 类</span></span><br><span class="line">dump(UserList.UserList()) <span class="comment"># instance 实例</span></span><br><span class="line"></span><br><span class="line">&lt;type 'int'&gt; =&gt; NUMBER</span><br><span class="line">&lt;type 'string'&gt; =&gt; SEQUENCE</span><br><span class="line">&lt;type 'string'&gt; =&gt; SEQUENCE</span><br><span class="line">&lt;type 'list'&gt; =&gt; SEQUENCE</span><br><span class="line">&lt;type 'tuple'&gt; =&gt; SEQUENCE</span><br><span class="line">&lt;type 'dictionary'&gt; =&gt; MAPPING</span><br><span class="line">&lt;type 'builtin_function_or_method'&gt; =&gt; CALLABLE</span><br><span class="line">&lt;type 'module'&gt; =&gt;</span><br><span class="line">&lt;type 'class'&gt; =&gt; CALLABLE</span><br><span class="line">&lt;type 'instance'&gt; =&gt; MAPPING NUMBER SEQUENCE</span><br></pre></td></tr></table></figure>

<p>  这里需要注意 <code>operator</code> 模块使用非常规的方法处理对象实例. 所以使用 <code>isNumberType</code> , <code>isMappingType</code> , 以及 <code>isSequenceType</code> 函数的时候要小心, 这很容易降低代码的扩展性.</p>
<p>  同样需要注意的是一个字符串序列成员 (单个字符) 也是序列. 所以当在递归函数使用 isSequenceType 来截断对象树的时候, 别把普通字符串作为参数(或者是任何包含字符串的序列对象).</p>
<hr>
<h2 id="1-12-copy-模块"><a href="#1-12-copy-模块" class="headerlink" title="1.12. copy 模块"></a>1.12. copy 模块</h2><p>  <code>copy</code> 模块包含两个函数, 用来拷贝对象, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-64" target="_blank" rel="noopener">Example 1-64</a> 所示.</p>
<p>  <code>copy(object) =&gt; object</code> 创建给定对象的 “浅/浅层(shallow)” 拷贝(copy). 这里 “浅/浅层(shallow)” 的意思是复制对象本身, 但当对象是一个容器 (container) 时, 它的成员仍然指向原来的成员对象.</p>
<h4 id="1-12-0-1-Example-1-64-使用-copy-模块复制对象"><a href="#1-12-0-1-Example-1-64-使用-copy-模块复制对象" class="headerlink" title="1.12.0.1. Example 1-64. 使用 copy 模块复制对象"></a>1.12.0.1. Example 1-64. 使用 copy 模块复制对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">File: copy-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">a = [[<span class="number">1</span>],[<span class="number">2</span>],[<span class="number">3</span>]]</span><br><span class="line">b = copy.copy(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"before"</span>, <span class="string">"=&gt;"</span></span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"><span class="keyword">print</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify original</span></span><br><span class="line">a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"after"</span>, <span class="string">"=&gt;"</span></span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"><span class="keyword">print</span> b</span><br><span class="line"></span><br><span class="line">before =&gt;</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line">after =&gt;</span><br><span class="line">[[<span class="number">0</span>], <span class="literal">None</span>, [<span class="number">3</span>]]</span><br><span class="line">[[<span class="number">0</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br></pre></td></tr></table></figure>

<p>  你也可以使用[:]语句 (完整切片) 来对列表进行浅层复制, 也可以使用 <code>copy</code> 方法复制字典.</p>
<p>  相反地, <code>deepcopy(object) =&gt; object</code> 创建一个对象的深层拷贝(deepcopy), 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-65" target="_blank" rel="noopener">Example 1-65</a> 所示, 当对象为一个容器时, 所有的成员都被递归地复制了。</p>
<h4 id="1-12-0-2-Example-1-65-使用-copy-模块复制集合-Collections"><a href="#1-12-0-2-Example-1-65-使用-copy-模块复制集合-Collections" class="headerlink" title="1.12.0.2. Example 1-65. 使用 copy 模块复制集合(Collections)"></a>1.12.0.2. Example 1-65. 使用 copy 模块复制集合(Collections)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">File: copy-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">a = [[<span class="number">1</span>],[<span class="number">2</span>],[<span class="number">3</span>]]</span><br><span class="line">b = copy.deepcopy(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"before"</span>, <span class="string">"=&gt;"</span></span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"><span class="keyword">print</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify original</span></span><br><span class="line">a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"after"</span>, <span class="string">"=&gt;"</span></span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"><span class="keyword">print</span> b</span><br><span class="line"></span><br><span class="line">before =&gt;</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line">after =&gt;</span><br><span class="line">[[<span class="number">0</span>], <span class="literal">None</span>, [<span class="number">3</span>]]</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-13-sys-模块"><a href="#1-13-sys-模块" class="headerlink" title="1.13. sys 模块"></a>1.13. sys 模块</h2><p>  <code>sys</code> 模块提供了许多函数和变量来处理 Python 运行时环境的不同部分.</p>
<h3 id="1-13-1-处理命令行参数"><a href="#1-13-1-处理命令行参数" class="headerlink" title="1.13.1. 处理命令行参数"></a>1.13.1. 处理命令行参数</h3><p>  在解释器启动后, <code>argv</code> 列表包含了传递给脚本的所有参数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-66" target="_blank" rel="noopener">Example 1-66</a> 所示. 列表的第一个元素为脚本自身的名称.</p>
<h4 id="1-13-1-1-Example-1-66-使用sys模块获得脚本的参数"><a href="#1-13-1-1-Example-1-66-使用sys模块获得脚本的参数" class="headerlink" title="1.13.1.1. Example 1-66. 使用sys模块获得脚本的参数"></a>1.13.1.1. Example 1-66. 使用sys模块获得脚本的参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: sys-argv-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"script name is"</span>, sys.argv[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"there are"</span>, len(sys.argv)<span class="number">-1</span>, <span class="string">"arguments:"</span></span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">        <span class="keyword">print</span> arg</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"there are no arguments!"</span></span><br><span class="line"></span><br><span class="line">script name <span class="keyword">is</span> sys-argv-example<span class="number">-1.</span>py</span><br><span class="line">there are no arguments!</span><br></pre></td></tr></table></figure>

<p>  如果是从标准输入读入脚本 (比如 “<code>python &lt; sys-argv-example-1.py</code>“), 脚本的名称将被设置为空串. 如果把脚本作为字符串传递给python (使用 <code>-c</code> 选项), 脚本名会被设置为 “-c”.</p>
<h3 id="1-13-2-处理模块"><a href="#1-13-2-处理模块" class="headerlink" title="1.13.2. 处理模块"></a>1.13.2. 处理模块</h3><p>  <code>path</code> 列表是一个由目录名构成的列表, Python 从中查找扩展模块( Python 源模块, 编译模块,或者二进制扩展). 启动 Python 时,这个列表从根据内建规则, PYTHONPATH 环境变量的内容, 以及注册表( Windows 系统)等进行初始化. 由于它只是一个普通的列表, 你可以在程序中对它进行操作, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-67" target="_blank" rel="noopener">Example 1-67</a> 所示.</p>
<h4 id="1-13-2-1-Example-1-67-使用sys模块操作模块搜索路径"><a href="#1-13-2-1-Example-1-67-使用sys模块操作模块搜索路径" class="headerlink" title="1.13.2.1. Example 1-67. 使用sys模块操作模块搜索路径"></a>1.13.2.1. Example 1-67. 使用sys模块操作模块搜索路径</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">File: sys-path-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"path has"</span>, len(sys.path), <span class="string">"members"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add the sample directory to the path</span></span><br><span class="line">sys.path.insert(<span class="number">0</span>, <span class="string">"samples"</span>)</span><br><span class="line"><span class="keyword">import</span> sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># nuke the path</span></span><br><span class="line">sys.path = []</span><br><span class="line"><span class="keyword">import</span> random <span class="comment"># oops!</span></span><br><span class="line"></span><br><span class="line">path has <span class="number">7</span> members</span><br><span class="line">this <span class="keyword">is</span> the sample module!</span><br><span class="line">Traceback (innermost last):</span><br><span class="line">  File "sys-path-example-1.py", line 11, in ?</span><br><span class="line">    <span class="keyword">import</span> random <span class="comment"># oops!</span></span><br><span class="line">ImportError: No module named random</span><br></pre></td></tr></table></figure>

<p>  <code>builtin_module_names</code> 列表包含 Python 解释器中所有内建模块的名称, <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-68" target="_blank" rel="noopener">Example 1-68</a></p>
<ul>
<li>给出了它的样例代码.</li>
</ul>
<h4 id="1-13-2-2-Example-1-68-使用sys模块查找内建模块"><a href="#1-13-2-2-Example-1-68-使用sys模块查找内建模块" class="headerlink" title="1.13.2.2. Example 1-68. 使用sys模块查找内建模块"></a>1.13.2.2. Example 1-68. 使用sys模块查找内建模块</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">File: sys-builtin-module-names-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(module)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> module, <span class="string">"=&gt;"</span>,</span><br><span class="line">    <span class="keyword">if</span> module <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"&lt;BUILTIN&gt;"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        module = _ _import_ _(module)</span><br><span class="line">        <span class="keyword">print</span> module._ _file_ _</span><br><span class="line"></span><br><span class="line">dump(<span class="string">"os"</span>)</span><br><span class="line">dump(<span class="string">"sys"</span>)</span><br><span class="line">dump(<span class="string">"string"</span>)</span><br><span class="line">dump(<span class="string">"strop"</span>)</span><br><span class="line">dump(<span class="string">"zlib"</span>)</span><br><span class="line"></span><br><span class="line">os =&gt; C:\python\lib\os.pyc</span><br><span class="line">sys =&gt; &lt;BUILTIN&gt;</span><br><span class="line">string =&gt; C:\python\lib\string.pyc</span><br><span class="line">strop =&gt; &lt;BUILTIN&gt;</span><br><span class="line">zlib =&gt; C:\python\zlib.pyd</span><br></pre></td></tr></table></figure>

<p>  <code>modules</code> 字典包含所有加载的模块. <code>import</code> 语句在从磁盘导入内容之前会先检查这个字典.</p>
<p>  正如你在 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-69" target="_blank" rel="noopener">Example 1-69</a> 中所见到的, Python 在处理你的脚本之前就已经导入了很多模块.</p>
<h4 id="1-13-2-3-Example-1-69-使用sys模块查找已导入的模块"><a href="#1-13-2-3-Example-1-69-使用sys模块查找已导入的模块" class="headerlink" title="1.13.2.3. Example 1-69. 使用sys模块查找已导入的模块"></a>1.13.2.3. Example 1-69. 使用sys模块查找已导入的模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">File: sys-modules-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> sys.modules.keys()</span><br><span class="line"></span><br><span class="line">[<span class="string">'os.path'</span>, <span class="string">'os'</span>, <span class="string">'exceptions'</span>, <span class="string">'_ _main_ _'</span>, <span class="string">'ntpath'</span>, <span class="string">'strop'</span>, <span class="string">'nt'</span>,</span><br><span class="line"><span class="string">'sys'</span>, <span class="string">'_ _builtin_ _'</span>, <span class="string">'site'</span>, <span class="string">'signal'</span>, <span class="string">'UserDict'</span>, <span class="string">'string'</span>, <span class="string">'stat'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="1-13-3-处理引用记数"><a href="#1-13-3-处理引用记数" class="headerlink" title="1.13.3. 处理引用记数"></a>1.13.3. 处理引用记数</h3><p>  <code>getrefcount</code> 函数 (如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-70" target="_blank" rel="noopener">Example 1-70</a> 所示) 返回给定对象的引用记数 - 也就是这个对象使用次数. Python 会跟踪这个值, 当它减少为0的时候, 就销毁这个对象.</p>
<h4 id="1-13-3-1-Example-1-70-使用sys模块获得引用记数"><a href="#1-13-3-1-Example-1-70-使用sys模块获得引用记数" class="headerlink" title="1.13.3.1. Example 1-70. 使用sys模块获得引用记数"></a>1.13.3.1. Example 1-70. 使用sys模块获得引用记数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File: sys-getrefcount-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">variable = <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> sys.getrefcount(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">print</span> sys.getrefcount(variable)</span><br><span class="line"><span class="keyword">print</span> sys.getrefcount(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">50</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">192</span></span><br></pre></td></tr></table></figure>

<p>  注意这个值总是比实际的数量大, 因为该函数本身在确定这个值的时候依赖这个对象.</p>
<p>  == 检查主机平台===</p>
<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-71" target="_blank" rel="noopener">Example 1-71</a> 展示了 <code>platform</code> 变量, 它包含主机平台的名称.</p>
<h4 id="1-13-3-2-Example-1-71-使用sys模块获得当前平台"><a href="#1-13-3-2-Example-1-71-使用sys模块获得当前平台" class="headerlink" title="1.13.3.2. Example 1-71. 使用sys模块获得当前平台"></a>1.13.3.2. Example 1-71. 使用sys模块获得当前平台</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: sys-platform-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># emulate "import os.path" (sort of)...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.platform == <span class="string">"win32"</span>:</span><br><span class="line">    <span class="keyword">import</span> ntpath</span><br><span class="line">    pathmodule = ntpath</span><br><span class="line"><span class="keyword">elif</span> sys.platform == <span class="string">"mac"</span>:</span><br><span class="line">    <span class="keyword">import</span> macpath</span><br><span class="line">    pathmodule = macpath</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># assume it's a posix platform</span></span><br><span class="line">    <span class="keyword">import</span> posixpath</span><br><span class="line">    pathmodule = posixpath</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> pathmodule</span><br></pre></td></tr></table></figure>

<p>  典型的平台有Windows 9X/NT(显示为 <code>win32</code> ), 以及 Macintosh(显示为 <code>mac</code> ) . 对于 Unix 系统而言, platform 通常来自 “<code>uname -r</code>“ 命令的输出, 例如 <code>irix6</code> , <code>linux2</code> , 或者 <code>sunos5</code>(Solaris).</p>
<h3 id="1-13-4-跟踪程序"><a href="#1-13-4-跟踪程序" class="headerlink" title="1.13.4. 跟踪程序"></a>1.13.4. 跟踪程序</h3><p>  <code>setprofiler</code> 函数允许你配置一个分析函数(profiling function). 这个函数会在每次调用某个函数或方法时被调用(明确或隐含的), 或是遇到异常的时候被调用. 让我们看看 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-72" target="_blank" rel="noopener">Example 1-72</a> 的代码.</p>
<h4 id="1-13-4-1-Example-1-72-使用sys模块配置分析函数"><a href="#1-13-4-1-Example-1-72-使用sys模块配置分析函数" class="headerlink" title="1.13.4.1. Example 1-72. 使用sys模块配置分析函数"></a>1.13.4.1. Example 1-72. 使用sys模块配置分析函数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">File: sys-setprofiler-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(n)</span>:</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        j = j + i</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">profiler</span><span class="params">(frame, event, arg)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> event, frame.f_code.co_name, frame.f_lineno, <span class="string">"-&gt;"</span>, arg</span><br><span class="line"></span><br><span class="line"><span class="comment"># profiler is activated on the next call, return, or exception</span></span><br><span class="line"><span class="comment"># 分析函数将在下次函数调用, 返回, 或异常时激活</span></span><br><span class="line">sys.setprofile(profiler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># profile this function call</span></span><br><span class="line"><span class="comment"># 分析这次函数调用</span></span><br><span class="line">test(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable profiler</span></span><br><span class="line"><span class="comment"># 禁用分析函数</span></span><br><span class="line">sys.setprofile(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># don't profile this call</span></span><br><span class="line"><span class="comment"># 不会分析这次函数调用</span></span><br><span class="line">test(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">call test 3 -&gt; None</span><br><span class="line">return test 7 -&gt; 1</span><br></pre></td></tr></table></figure>

<p>  基于该函数, <code>profile</code> 模块提供了一个完整的分析器框架.</p>
<p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-73" target="_blank" rel="noopener">Example 1-73</a> 中的 <code>settrace</code> 函数与此类似, 但是 <code>trace</code> 函数会在解释器每执行到新的一行时被调用.</p>
<h4 id="1-13-4-2-Example-1-73-使用sys模块配置单步跟踪函数"><a href="#1-13-4-2-Example-1-73-使用sys模块配置单步跟踪函数" class="headerlink" title="1.13.4.2. Example 1-73. 使用sys模块配置单步跟踪函数"></a>1.13.4.2. Example 1-73. 使用sys模块配置单步跟踪函数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">File: sys-settrace-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(n)</span>:</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        j = j + i</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tracer</span><span class="params">(frame, event, arg)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> event, frame.f_code.co_name, frame.f_lineno, <span class="string">"-&gt;"</span>, arg</span><br><span class="line">    <span class="keyword">return</span> tracer</span><br><span class="line"></span><br><span class="line"><span class="comment"># tracer is activated on the next call, return, or exception</span></span><br><span class="line"><span class="comment"># 跟踪器将在下次函数调用, 返回, 或异常时激活</span></span><br><span class="line">sys.settrace(tracer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># trace this function call</span></span><br><span class="line"><span class="comment"># 跟踪这次函数调用</span></span><br><span class="line">test(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable tracing</span></span><br><span class="line"><span class="comment"># 禁用跟踪器</span></span><br><span class="line">sys.settrace(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># don't trace this call</span></span><br><span class="line"><span class="comment"># 不会跟踪这次函数调用</span></span><br><span class="line">test(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">call test 3 -&gt; None</span><br><span class="line">line test 3 -&gt; None</span><br><span class="line">line test 4 -&gt; None</span><br><span class="line">line test 5 -&gt; None</span><br><span class="line">line test 5 -&gt; None</span><br><span class="line">line test 6 -&gt; None</span><br><span class="line">line test 5 -&gt; None</span><br><span class="line">line test 7 -&gt; None</span><br><span class="line">return test 7 -&gt; 1</span><br></pre></td></tr></table></figure>

<p>  基于该函数提供的跟踪功能, <code>pdb</code> 模块提供了完整的调试( debug )框架.</p>
<h3 id="1-13-5-处理标准输出-输入"><a href="#1-13-5-处理标准输出-输入" class="headerlink" title="1.13.5. 处理标准输出/输入"></a>1.13.5. 处理标准输出/输入</h3><p>  <code>stdin</code> , <code>stdout</code> , 以及 <code>stderr</code> 变量包含与标准 I/O 流对应的流对象. 如果需要更好地控制输出,而 <code>print</code> 不能满足你的要求, 它们就是你所需要的. 你也可以 <em>替换</em> 它们, 这时候你就可以重定向输出和输入到其它设备( device ), 或者以非标准的方式处理它们. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-74" target="_blank" rel="noopener">Example 1-74</a> 所示.</p>
<h4 id="1-13-5-1-Example-1-74-使用sys重定向输出"><a href="#1-13-5-1-Example-1-74-使用sys重定向输出" class="headerlink" title="1.13.5.1. Example 1-74. 使用sys重定向输出"></a>1.13.5.1. Example 1-74. 使用sys重定向输出</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">File: sys-stdout-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redirect</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, stdout)</span>:</span></span><br><span class="line">        self.stdout = stdout</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        self.stdout.write(string.lower(s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect standard output (including the print statement)</span></span><br><span class="line"><span class="comment"># 重定向标准输出(包括print语句)</span></span><br><span class="line">old_stdout = sys.stdout</span><br><span class="line">sys.stdout = Redirect(sys.stdout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"HEJA SVERIGE"</span>,</span><br><span class="line"><span class="keyword">print</span> <span class="string">"FRISKT HUM\303\226R"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># restore standard output</span></span><br><span class="line"><span class="comment"># 恢复标准输出</span></span><br><span class="line">sys.stdout = old_stdout</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"M\303\205\303\205\303\205\303\205L!"</span></span><br><span class="line"></span><br><span class="line">heja sverige friskt hum\<span class="number">303</span>\<span class="number">266</span>r</span><br><span class="line">M\<span class="number">303</span>\<span class="number">205</span>\<span class="number">303</span>\<span class="number">205</span>\<span class="number">303</span>\<span class="number">205</span>\<span class="number">303</span>\<span class="number">205L</span>!</span><br></pre></td></tr></table></figure>

<p>  要重定向输出只要创建一个对象, 并实现它的 <code>write</code> 方法.</p>
<p>  (除非 C 类型的实例外：Python 使用一个叫做 <code>softspace</code> 的整数属性来控制输出中的空白. 如果没有这个属性, Python 将把这个属性附加到这个对象上. 你不需要在使用 Python 对象时担心, 但是在重定向到一个 C 类型时, 你应该确保该类型支持 <code>softspace</code> 属性.)</p>
<h3 id="1-13-6-退出程序"><a href="#1-13-6-退出程序" class="headerlink" title="1.13.6. 退出程序"></a>1.13.6. 退出程序</h3><p>  执行至主程序的末尾时,解释器会自动退出. 但是如果需要中途退出程序, 你可以调用 <code>sys.exit</code> 函数, 它带有一个可选的整数参数返回给调用它的程序. <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-75" target="_blank" rel="noopener">Example 1-75</a> 给出了范例.</p>
<h4 id="1-13-6-1-Example-1-75-使用sys模块退出程序"><a href="#1-13-6-1-Example-1-75-使用sys模块退出程序" class="headerlink" title="1.13.6.1. Example 1-75. 使用sys模块退出程序"></a>1.13.6.1. Example 1-75. 使用sys模块退出程序</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File: sys-exit-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line">sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"there"</span></span><br><span class="line"></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>  注意 <code>sys.exit</code> 并不是立即退出. 而是引发一个 <em>SystemExit</em> 异常. 这意味着你可以在主程序中捕获对 <code>sys.exit</code> 的调用, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-76" target="_blank" rel="noopener">Example 1-76</a> 所示.</p>
<h4 id="1-13-6-2-Example-1-76-捕获sys-exit调用"><a href="#1-13-6-2-Example-1-76-捕获sys-exit调用" class="headerlink" title="1.13.6.2. Example 1-76. 捕获sys.exit调用"></a>1.13.6.2. Example 1-76. 捕获sys.exit调用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: sys-exit-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> SystemExit:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"there"</span></span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">there</span><br></pre></td></tr></table></figure>

<p>  如果准备在退出前自己清理一些东西(比如删除临时文件), 你可以配置一个 “退出处理函数”(exit handler), 它将在程序退出的时候自动被调用. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-77" target="_blank" rel="noopener">Example 1-77</a> 所示.</p>
<h4 id="1-13-6-3-Example-1-77-另一种捕获sys-exit调用的方法"><a href="#1-13-6-3-Example-1-77-另一种捕获sys-exit调用的方法" class="headerlink" title="1.13.6.3. Example 1-77. 另一种捕获sys.exit调用的方法"></a>1.13.6.3. Example 1-77. 另一种捕获sys.exit调用的方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: sys-exitfunc-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exitfunc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"world"</span></span><br><span class="line"></span><br><span class="line">sys.exitfunc = exitfunc</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"hello"</span></span><br><span class="line">sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"there"</span> <span class="comment"># never printed # 不会被 print</span></span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">world</span><br></pre></td></tr></table></figure>

<p>  在 Python 2.0 以后, 你可以使用 <code>atexit</code> 模块来注册多个退出处理函数.</p>
<hr>
<h2 id="1-14-atexit-模块"><a href="#1-14-atexit-模块" class="headerlink" title="1.14. atexit 模块"></a>1.14. atexit 模块</h2><p>  (用于2.0版本及以上) <code>atexit</code> 模块允许你注册一个或多个终止函数(暂且这么叫), 这些函数将在解释器终止前被自动调用.</p>
<p>  调用 <code>register</code> 函数, 便可以将函数注册为终止函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-78" target="_blank" rel="noopener">Example 1-78</a> 所示. 你也可以添加更多的参数, 这些将作为 <code>exit</code> 函数的参数传递.</p>
<h4 id="1-14-0-1-Example-1-78-使用-atexit-模块"><a href="#1-14-0-1-Example-1-78-使用-atexit-模块" class="headerlink" title="1.14.0.1. Example 1-78. 使用 atexit 模块"></a>1.14.0.1. Example 1-78. 使用 atexit 模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: atexit-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> atexit</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"exit"</span>, args</span><br><span class="line"></span><br><span class="line"><span class="comment"># register two exit handler</span></span><br><span class="line">atexit.register(exit)</span><br><span class="line">atexit.register(exit, <span class="number">1</span>)</span><br><span class="line">atexit.register(exit, <span class="string">"hello"</span>, <span class="string">"world"</span>)</span><br><span class="line"></span><br><span class="line">exit (<span class="string">'hello'</span>, <span class="string">'world'</span>)</span><br><span class="line">exit (<span class="number">1</span>,)</span><br><span class="line">exit ()</span><br></pre></td></tr></table></figure>

<p>  该模块其实是一个对 <code>sys.exitfunc</code> 钩子( hook )的简单封装.</p>
<hr>
<h2 id="1-15-time-模块"><a href="#1-15-time-模块" class="headerlink" title="1.15. time 模块"></a>1.15. time 模块</h2><p>  <code>time</code> 模块提供了一些处理日期和一天内时间的函数. 它是建立在 C 运行时库的简单封装.</p>
<p>  给定的日期和时间可以被表示为浮点型(从参考时间, 通常是 1970.1.1 到现在经过的秒数. 即 Unix 格式), 或者一个表示时间的 struct (类元组).</p>
<h3 id="1-15-1-获得当前时间"><a href="#1-15-1-获得当前时间" class="headerlink" title="1.15.1. 获得当前时间"></a>1.15.1. 获得当前时间</h3><p>  <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-79" target="_blank" rel="noopener">Example 1-79</a> 展示了如何使用 <code>time</code> 模块获取当前时间.</p>
<h4 id="1-15-1-1-Example-1-79-使用-time-模块获取当前时间"><a href="#1-15-1-1-Example-1-79-使用-time-模块获取当前时间" class="headerlink" title="1.15.1.1. Example 1-79. 使用 time 模块获取当前时间"></a>1.15.1.1. Example 1-79. 使用 time 模块获取当前时间</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">now = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> now, <span class="string">"seconds since"</span>, time.gmtime(<span class="number">0</span>)[:<span class="number">6</span>]</span><br><span class="line"><span class="keyword">print</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"or in other words:"</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"- local time:"</span>, time.localtime(now)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"- utc:"</span>, time.gmtime(now)</span><br><span class="line"></span><br><span class="line"><span class="number">937758359.77</span> seconds since (<span class="number">1970</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span> <span class="keyword">in</span> other words:</span><br><span class="line">- local time: (<span class="number">1999</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">18</span>, <span class="number">25</span>, <span class="number">59</span>, <span class="number">6</span>, <span class="number">262</span>, <span class="number">1</span>)</span><br><span class="line">- utc: (<span class="number">1999</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">59</span>, <span class="number">6</span>, <span class="number">262</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>  <code>localtime</code> 和 <code>gmtime</code> 返回的类元组包括年, 月, 日, 时, 分, 秒, 星期, 一年的第几天, 日光标志. 其中年是一个四位数(在有千年虫问题的平台上另有规定, 但还是四位数), 星期从星期一(数字 0 代表)开始, 1月1日是一年的第一天.</p>
<h3 id="1-15-2-将时间值转换为字符串"><a href="#1-15-2-将时间值转换为字符串" class="headerlink" title="1.15.2. 将时间值转换为字符串"></a>1.15.2. 将时间值转换为字符串</h3><p>  你可以使用标准的格式化字符串把时间对象转换为字符串, 不过 <code>time</code> 模块已经提供了许多标准转换函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-80" target="_blank" rel="noopener">Example 1-80</a> 所示.</p>
<h4 id="1-15-2-1-Example-1-80-使用-time-模块格式化时间输出"><a href="#1-15-2-1-Example-1-80-使用-time-模块格式化时间输出" class="headerlink" title="1.15.2.1. Example 1-80. 使用 time 模块格式化时间输出"></a>1.15.2.1. Example 1-80. 使用 time 模块格式化时间输出</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-2.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">now = time.localtime(time.time())</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> time.asctime(now)</span><br><span class="line"><span class="keyword">print</span> time.strftime(<span class="string">"%y/%m/%d %H:%M"</span>, now)</span><br><span class="line"><span class="keyword">print</span> time.strftime(<span class="string">"%a %b %d"</span>, now)</span><br><span class="line"><span class="keyword">print</span> time.strftime(<span class="string">"%c"</span>, now)</span><br><span class="line"><span class="keyword">print</span> time.strftime(<span class="string">"%I %p"</span>, now)</span><br><span class="line"><span class="keyword">print</span> time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S %Z"</span>, now)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do it by hand...</span></span><br><span class="line">year, month, day, hour, minute, second, weekday, yearday, daylight = now</span><br><span class="line"><span class="keyword">print</span> <span class="string">"%04d-%02d-%02d"</span> % (year, month, day)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"%02d:%02d:%02d"</span> % (hour, minute, second)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"MON"</span>, <span class="string">"TUE"</span>, <span class="string">"WED"</span>, <span class="string">"THU"</span>, <span class="string">"FRI"</span>, <span class="string">"SAT"</span>, <span class="string">"SUN"</span>)[weekday], yearday</span><br><span class="line"></span><br><span class="line">Sun Oct <span class="number">10</span> <span class="number">21</span>:<span class="number">39</span>:<span class="number">24</span> <span class="number">1999</span></span><br><span class="line"><span class="number">99</span>/<span class="number">10</span>/<span class="number">10</span> <span class="number">21</span>:<span class="number">39</span></span><br><span class="line">Sun Oct <span class="number">10</span></span><br><span class="line">Sun Oct <span class="number">10</span> <span class="number">21</span>:<span class="number">39</span>:<span class="number">24</span> <span class="number">1999</span></span><br><span class="line"><span class="number">09</span> PM</span><br><span class="line"><span class="number">1999</span><span class="number">-10</span><span class="number">-10</span> <span class="number">21</span>:<span class="number">39</span>:<span class="number">24</span> CEST</span><br><span class="line"><span class="number">1999</span><span class="number">-10</span><span class="number">-10</span></span><br><span class="line"><span class="number">21</span>:<span class="number">39</span>:<span class="number">24</span></span><br><span class="line">SUN <span class="number">283</span></span><br></pre></td></tr></table></figure>

<h3 id="1-15-3-将字符串转换为时间对象"><a href="#1-15-3-将字符串转换为时间对象" class="headerlink" title="1.15.3. 将字符串转换为时间对象"></a>1.15.3. 将字符串转换为时间对象</h3><p>  在一些平台上, <code>time</code> 模块包含了 <code>strptime</code> 函数, 它的作用与 <code>strftime</code> 相反. 给定一个字符串和模式, 它返回相应的时间对象, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-81" target="_blank" rel="noopener">Example 1-81</a> 所示.</p>
<h4 id="1-15-3-1-Example-1-81-使用-time-strptime-函数解析时间"><a href="#1-15-3-1-Example-1-81-使用-time-strptime-函数解析时间" class="headerlink" title="1.15.3.1. Example 1-81. 使用 time.strptime 函数解析时间"></a>1.15.3.1. Example 1-81. 使用 time.strptime 函数解析时间</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-6.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure we have a strptime function!</span></span><br><span class="line"><span class="comment"># 确认有函数 strptime</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    strptime = time.strptime</span><br><span class="line"><span class="keyword">except</span> AttributeError:</span><br><span class="line">    <span class="keyword">from</span> strptime <span class="keyword">import</span> strptime</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> strptime(<span class="string">"31 Nov 00"</span>, <span class="string">"%d %b %y"</span>)</span><br><span class="line"><span class="keyword">print</span> strptime(<span class="string">"1 Jan 70 1:30pm"</span>, <span class="string">"%d %b %y %I:%M%p"</span>)</span><br></pre></td></tr></table></figure>

<p>  只有在系统的 C 库提供了相应的函数的时候, <code>time.strptime</code> 函数才可以使用. 对于没有提供标准实现的平台, <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-82" target="_blank" rel="noopener">Example 1-82</a> 提供了一个不完全的实现.</p>
<h4 id="1-15-3-2-Example-1-82-strptime-实现"><a href="#1-15-3-2-Example-1-82-strptime-实现" class="headerlink" title="1.15.3.2. Example 1-82. strptime 实现"></a>1.15.3.2. Example 1-82. strptime 实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">File: strptime.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">MONTHS = [<span class="string">"Jan"</span>, <span class="string">"Feb"</span>, <span class="string">"Mar"</span>, <span class="string">"Apr"</span>, <span class="string">"May"</span>, <span class="string">"Jun"</span>, <span class="string">"Jul"</span>, <span class="string">"Aug"</span>,</span><br><span class="line">          <span class="string">"Sep"</span>, <span class="string">"Oct"</span>, <span class="string">"Nov"</span>, <span class="string">"Dec"</span>]</span><br><span class="line"></span><br><span class="line">SPEC = &#123;</span><br><span class="line">    <span class="comment"># map formatting code to a regular expression fragment</span></span><br><span class="line">    <span class="string">"%a"</span>: <span class="string">"(?P&lt;weekday&gt;[a-z]+)"</span>,</span><br><span class="line">    <span class="string">"%A"</span>: <span class="string">"(?P&lt;weekday&gt;[a-z]+)"</span>,</span><br><span class="line">    <span class="string">"%b"</span>: <span class="string">"(?P&lt;month&gt;[a-z]+)"</span>,</span><br><span class="line">    <span class="string">"%B"</span>: <span class="string">"(?P&lt;month&gt;[a-z]+)"</span>,</span><br><span class="line">    <span class="string">"%C"</span>: <span class="string">"(?P&lt;century&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%d"</span>: <span class="string">"(?P&lt;day&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%D"</span>: <span class="string">"(?P&lt;month&gt;\d\d?)/(?P&lt;day&gt;\d\d?)/(?P&lt;year&gt;\d\d)"</span>,</span><br><span class="line">    <span class="string">"%e"</span>: <span class="string">"(?P&lt;day&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%h"</span>: <span class="string">"(?P&lt;month&gt;[a-z]+)"</span>,</span><br><span class="line">    <span class="string">"%H"</span>: <span class="string">"(?P&lt;hour&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%I"</span>: <span class="string">"(?P&lt;hour12&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%j"</span>: <span class="string">"(?P&lt;yearday&gt;\d\d?\d?)"</span>,</span><br><span class="line">    <span class="string">"%m"</span>: <span class="string">"(?P&lt;month&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%M"</span>: <span class="string">"(?P&lt;minute&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%p"</span>: <span class="string">"(?P&lt;ampm12&gt;am|pm)"</span>,</span><br><span class="line">    <span class="string">"%R"</span>: <span class="string">"(?P&lt;hour&gt;\d\d?):(?P&lt;minute&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%S"</span>: <span class="string">"(?P&lt;second&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%T"</span>: <span class="string">"(?P&lt;hour&gt;\d\d?):(?P&lt;minute&gt;\d\d?):(?P&lt;second&gt;\d\d?)"</span>,</span><br><span class="line">    <span class="string">"%U"</span>: <span class="string">"(?P&lt;week&gt;\d\d)"</span>,</span><br><span class="line">    <span class="string">"%w"</span>: <span class="string">"(?P&lt;weekday&gt;\d)"</span>,</span><br><span class="line">    <span class="string">"%W"</span>: <span class="string">"(?P&lt;weekday&gt;\d\d)"</span>,</span><br><span class="line">    <span class="string">"%y"</span>: <span class="string">"(?P&lt;year&gt;\d\d)"</span>,</span><br><span class="line">    <span class="string">"%Y"</span>: <span class="string">"(?P&lt;year&gt;\d\d\d\d)"</span>,</span><br><span class="line">    <span class="string">"%%"</span>: <span class="string">"%"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeParser</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, format)</span>:</span></span><br><span class="line">        <span class="comment"># convert strptime format string to regular expression</span></span><br><span class="line">        format = string.join(re.split(<span class="string">"(?:\s|%t|%n)+"</span>, format))</span><br><span class="line">        pattern = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> spec <span class="keyword">in</span> re.findall(<span class="string">"%\w|%%|."</span>, format):</span><br><span class="line">                <span class="keyword">if</span> spec[<span class="number">0</span>] == <span class="string">"%"</span>:</span><br><span class="line">                    spec = SPEC[spec]</span><br><span class="line">                pattern.append(spec)</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> ValueError, <span class="string">"unknown specificer: %s"</span> % spec</span><br><span class="line">        self.pattern = re.compile(<span class="string">"(?i)"</span> + string.join(pattern, <span class="string">""</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">match</span><span class="params">(self, daytime)</span>:</span></span><br><span class="line">        <span class="comment"># match time string</span></span><br><span class="line">        match = self.pattern.match(daytime)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> match:</span><br><span class="line">            <span class="keyword">raise</span> ValueError, <span class="string">"format mismatch"</span></span><br><span class="line">        get = match.groupdict().get</span><br><span class="line">        tm = [<span class="number">0</span>] * <span class="number">9</span></span><br><span class="line">        <span class="comment"># extract date elements</span></span><br><span class="line">        y = get(<span class="string">"year"</span>)</span><br><span class="line">        <span class="keyword">if</span> y:</span><br><span class="line">            y = int(y)</span><br><span class="line">            <span class="keyword">if</span> y &lt; <span class="number">68</span>:</span><br><span class="line">                y = <span class="number">2000</span> + y</span><br><span class="line">            <span class="keyword">elif</span> y &lt; <span class="number">100</span>:</span><br><span class="line">                y = <span class="number">1900</span> + y</span><br><span class="line">            tm[<span class="number">0</span>] = y</span><br><span class="line">        m = get(<span class="string">"month"</span>)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">if</span> m <span class="keyword">in</span> MONTHS:</span><br><span class="line">                m = MONTHS.index(m) + <span class="number">1</span></span><br><span class="line">            tm[<span class="number">1</span>] = int(m)</span><br><span class="line">        d = get(<span class="string">"day"</span>)</span><br><span class="line">        <span class="keyword">if</span> d: tm[<span class="number">2</span>] = int(d)</span><br><span class="line">        <span class="comment"># extract time elements</span></span><br><span class="line">        h = get(<span class="string">"hour"</span>)</span><br><span class="line">        <span class="keyword">if</span> h:</span><br><span class="line">            tm[<span class="number">3</span>] = int(h)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            h = get(<span class="string">"hour12"</span>)</span><br><span class="line">            <span class="keyword">if</span> h:</span><br><span class="line">                h = int(h)</span><br><span class="line">                <span class="keyword">if</span> string.lower(get(<span class="string">"ampm12"</span>, <span class="string">""</span>)) == <span class="string">"pm"</span>:</span><br><span class="line">                    h = h + <span class="number">12</span></span><br><span class="line">                tm[<span class="number">3</span>] = h</span><br><span class="line">        m = get(<span class="string">"minute"</span>)</span><br><span class="line">        <span class="keyword">if</span> m: tm[<span class="number">4</span>] = int(m)</span><br><span class="line">        s = get(<span class="string">"second"</span>)</span><br><span class="line">        <span class="keyword">if</span> s: tm[<span class="number">5</span>] = int(s)</span><br><span class="line">        <span class="comment"># ignore weekday/yearday for now</span></span><br><span class="line">        <span class="keyword">return</span> tuple(tm)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strptime</span><span class="params">(string, format=<span class="string">"%a %b %d %H:%M:%S %Y"</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> TimeParser(format).match(string)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _ _name_ _ == <span class="string">"_ _main_ _"</span>:</span><br><span class="line">    <span class="comment"># try it out</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    <span class="keyword">print</span> strptime(<span class="string">"2000-12-20 01:02:03"</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">    <span class="keyword">print</span> strptime(time.ctime(time.time()))</span><br><span class="line"></span><br><span class="line">(<span class="number">2000</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">2000</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">30</span>, <span class="number">45</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-15-4-转换时间值"><a href="#1-15-4-转换时间值" class="headerlink" title="1.15.4. 转换时间值"></a>1.15.4. 转换时间值</h3><p>  将时间元组转换回时间值非常简单, 至少我们谈论的当地时间 (local time) 如此. 只要把时间元组传递给 <code>mktime</code> 函数, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-83" target="_blank" rel="noopener">Example 1-83</a> 所示.</p>
<h4 id="1-15-4-1-Example-1-83-使用-time-模块将本地时间元组转换为时间值-整数"><a href="#1-15-4-1-Example-1-83-使用-time-模块将本地时间元组转换为时间值-整数" class="headerlink" title="1.15.4.1. Example 1-83. 使用 time 模块将本地时间元组转换为时间值(整数)"></a>1.15.4.1. Example 1-83. 使用 time 模块将本地时间元组转换为时间值(整数)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-3.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">t0 = time.time()</span><br><span class="line">tm = time.localtime(t0)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> tm</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> t0</span><br><span class="line"><span class="keyword">print</span> time.mktime(tm)</span><br><span class="line"></span><br><span class="line">(<span class="number">1999</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">252</span>, <span class="number">1</span>)</span><br><span class="line"><span class="number">936828668.16</span></span><br><span class="line"><span class="number">936828668.0</span></span><br></pre></td></tr></table></figure>

<p>  但是, 1.5.2 版本的标准库没有提供能将 UTC 时间 (Universal Time, Coordinated: 特林威治标准时间)转换为时间值的函数 ( Python 和对应底层 C 库都没有提供). <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-84" target="_blank" rel="noopener">Example 1-84</a> 提供了该函数的一个 Python 实现, 称为 <code>timegm</code> .</p>
<h4 id="1-15-4-2-Example-1-84-将-UTC-时间元组转换为时间值-整数"><a href="#1-15-4-2-Example-1-84-将-UTC-时间元组转换为时间值-整数" class="headerlink" title="1.15.4.2. Example 1-84. 将 UTC 时间元组转换为时间值(整数)"></a>1.15.4.2. Example 1-84. 将 UTC 时间元组转换为时间值(整数)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-4.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_d</span><span class="params">(y, m, d, days=<span class="params">(<span class="number">0</span>,<span class="number">31</span>,<span class="number">59</span>,<span class="number">90</span>,<span class="number">120</span>,<span class="number">151</span>,<span class="number">181</span>,<span class="number">212</span>,<span class="number">243</span>,<span class="number">273</span>,<span class="number">304</span>,<span class="number">334</span>,<span class="number">365</span>)</span>)</span>:</span></span><br><span class="line">    <span class="comment"># map a date to the number of days from a reference point</span></span><br><span class="line">    <span class="keyword">return</span> (((y - <span class="number">1901</span>)*<span class="number">1461</span>)/<span class="number">4</span> + days[m<span class="number">-1</span>] + d +</span><br><span class="line">        ((m &gt; <span class="number">2</span> <span class="keyword">and</span> <span class="keyword">not</span> y % <span class="number">4</span> <span class="keyword">and</span> (y % <span class="number">100</span> <span class="keyword">or</span> <span class="keyword">not</span> y % <span class="number">400</span>)) <span class="keyword">and</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timegm</span><span class="params">(tm, epoch=_d<span class="params">(<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>)</span>)</span>:</span></span><br><span class="line">    year, month, day, h, m, s = tm[:<span class="number">6</span>]</span><br><span class="line">    <span class="keyword">assert</span> year &gt;= <span class="number">1970</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> &lt;= month &lt;= <span class="number">12</span></span><br><span class="line">    <span class="keyword">return</span> (_d(year, month, day) - epoch)*<span class="number">86400</span> + h*<span class="number">3600</span> + m*<span class="number">60</span> + s</span><br><span class="line"></span><br><span class="line">t0 = time.time()</span><br><span class="line">tm = time.gmtime(t0)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> tm</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> t0</span><br><span class="line"><span class="keyword">print</span> timegm(tm)</span><br><span class="line"></span><br><span class="line">(<span class="number">1999</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">251</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">936828732.48</span></span><br><span class="line"><span class="number">936828732</span></span><br></pre></td></tr></table></figure>

<p>  从 1.6 版本开始, <code>calendar</code> 模块提供了一个类似的函数 <code>calendar.timegm</code> .</p>
<h3 id="1-15-5-Timing-相关"><a href="#1-15-5-Timing-相关" class="headerlink" title="1.15.5. Timing 相关"></a>1.15.5. Timing 相关</h3><p>  <code>time</code> 模块可以计算 Python 程序的执行时间, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-85" target="_blank" rel="noopener">Example 1-85</a> 所示. 你可以测量 “wall time” (real world time), 或是”进程时间” (消耗的 CPU 时间).</p>
<h4 id="1-15-5-1-Example-1-85-使用-time-模块评价算法"><a href="#1-15-5-1-Example-1-85-使用-time-模块评价算法" class="headerlink" title="1.15.5.1. Example 1-85. 使用 time 模块评价算法"></a>1.15.5.1. Example 1-85. 使用 time 模块评价算法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File: time-example<span class="number">-5.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">procedure</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># measure process time</span></span><br><span class="line">t0 = time.clock()</span><br><span class="line">procedure()</span><br><span class="line"><span class="keyword">print</span> time.clock() - t0, <span class="string">"seconds process time"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># measure wall time</span></span><br><span class="line">t0 = time.time()</span><br><span class="line">procedure()</span><br><span class="line"><span class="keyword">print</span> time.time() - t0, <span class="string">"seconds wall time"</span></span><br><span class="line"></span><br><span class="line"><span class="number">0.0</span> seconds process time</span><br><span class="line"><span class="number">2.50903499126</span> seconds wall time</span><br></pre></td></tr></table></figure>

<p>  并不是所有的系统都能测量真实的进程时间. 一些系统中(包括 Windows ), <code>clock</code> 函数通常测量从程序启动到测量时的 wall time.</p>
<p>  进程时间的精度受限制. 在一些系统中, 它超过 30 分钟后进程会被清理. (原文: On many systems, it wraps around after just over 30 minutes.)</p>
<p>  另参见 <code>timing</code> 模块( Windows 下的朋友不用忙活了,没有地~), 它可以测量两个事件之间的 wall time.</p>
<hr>
<h2 id="1-16-types-模块"><a href="#1-16-types-模块" class="headerlink" title="1.16. types 模块"></a>1.16. types 模块</h2><p>  <code>types</code> 模块包含了标准解释器定义的所有类型的类型对象, 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-86" target="_blank" rel="noopener">Example 1-86</a> 所示. 同一类型的所有对象共享一个类型对象. 你可以使用 <code>is</code> 来检查一个对象是不是属于某个给定类型.</p>
<h4 id="1-16-0-1-Example-1-86-使用-types-模块"><a href="#1-16-0-1-Example-1-86-使用-types-模块" class="headerlink" title="1.16.0.1. Example 1-86. 使用 types 模块"></a>1.16.0.1. Example 1-86. 使用 types 模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">File: types-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> object,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> type(object) <span class="keyword">is</span> types.IntType:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"INTEGER"</span>,</span><br><span class="line">    <span class="keyword">if</span> type(object) <span class="keyword">is</span> types.FloatType:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"FLOAT"</span>,</span><br><span class="line">    <span class="keyword">if</span> type(object) <span class="keyword">is</span> types.StringType:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"STRING"</span>,</span><br><span class="line">    <span class="keyword">if</span> type(object) <span class="keyword">is</span> types.ClassType:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CLASS"</span>,</span><br><span class="line">    <span class="keyword">if</span> type(object) <span class="keyword">is</span> types.InstanceType:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"INSTANCE"</span>,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">check(<span class="number">0</span>)</span><br><span class="line">check(<span class="number">0.0</span>)</span><br><span class="line">check(<span class="string">"0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">check(A)</span><br><span class="line">check(B)</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line"></span><br><span class="line">check(a)</span><br><span class="line">check(b)</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> INTEGER</span><br><span class="line"><span class="number">0.0</span> FLOAT</span><br><span class="line"><span class="number">0</span> STRING</span><br><span class="line">A CLASS</span><br><span class="line">B CLASS</span><br><span class="line">&lt;A instance at <span class="number">796960</span>&gt; INSTANCE</span><br><span class="line">&lt;B instance at <span class="number">796990</span>&gt; INSTANCE</span><br></pre></td></tr></table></figure>

<p>  注意所有的类都具有相同的类型, 所有的实例也是一样. 要测试一个类或者实例所属的类, 可以使用内建的 <code>issubclass</code> 和 <code>isinstance</code> 函数.</p>
<p>  <code>types</code> 模块在第一次引入的时候会破坏当前的异常状态. 也就是说, 不要在异常处理语句块中导入该模块 (<em>或其他会导入它的模块</em>) .</p>
<hr>
<h2 id="1-17-gc-模块"><a href="#1-17-gc-模块" class="headerlink" title="1.17. gc 模块"></a>1.17. gc 模块</h2><p>  (可选, 2.0 及以后版本) <code>gc</code> 模块提供了到内建循环垃圾收集器的接口.</p>
<p>  Python 使用引用记数来跟踪什么时候销毁一个对象; 一个对象的最后一个引用一旦消失, 这个对象就会被销毁.</p>
<p>  从 2.0 版开始, Python 还提供了一个循环垃圾收集器, 它每隔一段时间执行. 这个收集器查找指向自身的数据结构, 并尝试破坏循环. 如 <a href="http://wiki.woodpecker.org.cn/moin/PythonStandardLib/chpt1#eg-1-87" target="_blank" rel="noopener">Example 1-87</a> 所示.</p>
<p>  你可以使用 <code>gc.collect</code> 函数来强制完整收集. 这个函数将返回收集器销毁的对象的数量.</p>
<h4 id="1-17-0-1-Example-1-87-使用-gc-模块收集循环引用垃圾"><a href="#1-17-0-1-Example-1-87-使用-gc-模块收集循环引用垃圾" class="headerlink" title="1.17.0.1. Example 1-87. 使用 gc 模块收集循环引用垃圾"></a>1.17.0.1. Example 1-87. 使用 gc 模块收集循环引用垃圾</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">File: gc-example<span class="number">-1.</span>py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a simple object that links to itself</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_init_</span> <span class="title">_</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.parent = <span class="literal">None</span></span><br><span class="line">        self.children = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addchild</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        node.parent = self</span><br><span class="line">        self.children.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span> <span class="title">_repr_</span> <span class="title">_</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Node %s at %x&gt;"</span> % (repr(self.name), id(self))</span><br><span class="line"></span><br><span class="line"><span class="comment"># set up a self-referencing structure</span></span><br><span class="line">root = Node(<span class="string">"monty"</span>)</span><br><span class="line"></span><br><span class="line">root.addchild(Node(<span class="string">"eric"</span>))</span><br><span class="line">root.addchild(Node(<span class="string">"john"</span>))</span><br><span class="line">root.addchild(Node(<span class="string">"michael"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove our only reference</span></span><br><span class="line"><span class="keyword">del</span> root</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> gc.collect(), <span class="string">"unreachable objects"</span></span><br><span class="line"><span class="keyword">print</span> gc.collect(), <span class="string">"unreachable objects"</span></span><br><span class="line"></span><br><span class="line"><span class="number">12</span> unreachable objects</span><br><span class="line"><span class="number">0</span> unreachable objects</span><br></pre></td></tr></table></figure>

<p>  如果你确定你的程序不会创建自引用的数据结构, 你可以使用 <code>gc.disable</code> 函数禁用垃圾收集, 调用这个函数以后, Python 的工作方式将与 1.5.2 或更早的版本相同.</p>
<hr>
<p>  ​</p>

        
      </div>
      
      
      
    </div>
    

    
    
    
  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://github.com/aprz512/pic4aprz512/blob/master/Blog/avatar/avatar.jpeg?raw=true"
      alt="aprz512">
  <p class="site-author-name" itemprop="name">aprz512</p>
  <div class="site-description motion-element" itemprop="description">博客建于2017年02月05日21:39:56</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">204</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/aprz512" title="GitHub &rarr; https://github.com/aprz512" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>




        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-核心模块"><span class="nav-number">1.</span> <span class="nav-text">1. 核心模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-介绍"><span class="nav-number">1.1.</span> <span class="nav-text">1.1. 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-内建函数和异常"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1.1. 内建函数和异常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-操作系统接口模块"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.1.2. 操作系统接口模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-类型支持模块"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.1.3. 类型支持模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-4-正则表达式"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.1.4. 正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-5-语言支持模块"><span class="nav-number">1.1.5.</span> <span class="nav-text">1.1.5. 语言支持模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-builtin-模块"><span class="nav-number">1.2.</span> <span class="nav-text">1.2. _ builtin _ 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-使用元组或字典中的参数调用函数"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.2.1. 使用元组或字典中的参数调用函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-1-Example-1-1-使用-apply-函数"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">1.2.1.1. Example 1-1. 使用 apply 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-2-Example-1-2-使用-apply-函数传递关键字参数"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">1.2.1.2. Example 1-2. 使用 apply 函数传递关键字参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-3-Example-1-3-使用-apply-函数调用基类的构造函数"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">1.2.1.3. Example 1-3. 使用 apply 函数调用基类的构造函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-加载和重载模块"><span class="nav-number">1.2.2.</span> <span class="nav-text">1.2.2. 加载和重载模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-1-Example-1-4-使用-import-函数加载模块"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">1.2.2.1. Example 1-4. 使用 __import__函数加载模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-2-Example-1-5-Plug-in-例子"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">1.2.2.2. Example 1-5. Plug-in 例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-3-Example-1-6-使用-import-函数获得特定函数"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">1.2.2.3. Example 1-6. 使用 __import__ 函数获得特定函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-4-Example-1-7-使用-import-函数实现-延迟导入"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">1.2.2.4. Example 1-7. 使用 __import__ 函数实现 延迟导入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-5-Example-1-8-使用-reload-函数"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">1.2.2.5. Example 1-8. 使用 reload 函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-关于名称空间"><span class="nav-number">1.2.3.</span> <span class="nav-text">1.2.3. 关于名称空间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-1-Example-1-9-使用-dir-函数"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">1.2.3.1. Example 1-9. 使用 dir 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-2-Example-1-10-使用-dir-函数查找类的所有成员"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">1.2.3.2. Example 1-10. 使用 dir 函数查找类的所有成员</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-3-Example-1-11-使用-vars-函数"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">1.2.3.3. Example 1-11. 使用 vars 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-1-Example-1-12-使用-type-函数"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">1.2.4.1. Example 1-12. 使用 type 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-2-Example-1-13-对文件名和文件对象使用-type-函数"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">1.2.4.2. Example 1-13. 对文件名和文件对象使用 type 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-3-Example-1-14-使用-callable-函数"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">1.2.4.3. Example 1-14. 使用 callable 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-4-Example-1-15-使用-isinstance-函数"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">1.2.4.4. Example 1-15. 使用 isinstance 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-5-Example-1-16-使用-issubclass-函数"><span class="nav-number">1.2.3.8.</span> <span class="nav-text">1.2.4.5. Example 1-16. 使用 issubclass 函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-5-计算-Python-表达式"><span class="nav-number">1.2.4.</span> <span class="nav-text">1.2.5. 计算 Python 表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-1-Example-1-17-使用-eval-函数"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">1.2.5.1. Example 1-17. 使用 eval 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-2-Example-1-18-使用-eval-函数执行任意命令"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">1.2.5.2. Example 1-18. 使用 eval 函数执行任意命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-3-Example-1-19-安全地使用-eval-函数求值"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">1.2.5.3. Example 1-19. 安全地使用 eval 函数求值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-6-编译和执行代码"><span class="nav-number">1.2.5.</span> <span class="nav-text">1.2.6. 编译和执行代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-1-Example-1-20-使用-compile-函数检查语法"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">1.2.6.1. Example 1-20. 使用 compile 函数检查语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-2-Example-1-21-执行已编译的代码"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">1.2.6.2. Example 1-21. 执行已编译的代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-3-Example-1-22-简单的代码生成工具"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">1.2.6.3. Example 1-22. 简单的代码生成工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-4-Example-1-23-使用-execfile-函数"><span class="nav-number">1.2.5.4.</span> <span class="nav-text">1.2.6.4. Example 1-23. 使用 execfile 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-5-Example-1-24-hello-py-脚本"><span class="nav-number">1.2.5.5.</span> <span class="nav-text">1.2.6.5. Example 1-24. hello.py 脚本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-7-从-builtin-模块重载函数"><span class="nav-number">1.2.6.</span> <span class="nav-text">1.2.7. 从 _ builtin _ 模块重载函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-7-1-Example-1-25-显式地访问-builtin-模块中的函数"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">1.2.7.1. Example 1-25. 显式地访问 _ builtin _ 模块中的函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-exceptions-模块"><span class="nav-number">1.3.</span> <span class="nav-text">1.3. exceptions 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-0-1-Example-1-26-使用-exceptions-模块"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">1.3.0.1. Example 1-26. 使用 exceptions 模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-os-模块"><span class="nav-number">1.4.</span> <span class="nav-text">1.4. os 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-处理文件"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.4.1. 处理文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-1-Example-1-27-使用-os-模块重命名和删除文件"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">1.4.1.1. Example 1-27. 使用 os 模块重命名和删除文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-处理目录"><span class="nav-number">1.4.2.</span> <span class="nav-text">1.4.2. 处理目录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-1-Example-1-28-使用-os-列出目录下的文件"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">1.4.2.1. Example 1-28. 使用 os 列出目录下的文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-2-Example-1-29-使用-os-模块改变当前工作目录"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">1.4.2.2. Example 1-29. 使用 os 模块改变当前工作目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-3-Example-1-30-使用-os-模块创建-删除多个目录级"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">1.4.2.3. Example 1-30. 使用 os 模块创建/删除多个目录级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-4-Example-1-31-使用-os-模块创建-删除目录"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">1.4.2.4. Example 1-31. 使用 os 模块创建/删除目录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-3-处理文件属性"><span class="nav-number">1.4.3.</span> <span class="nav-text">1.4.3. 处理文件属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-3-1-Example-1-32-使用-os-模块获取文件属性"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">1.4.3.1. Example 1-32. 使用 os 模块获取文件属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-3-2-Example-1-33-使用-os-模块修改文件的权限和时间戳"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">1.4.3.2. Example 1-33. 使用 os 模块修改文件的权限和时间戳</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-4-处理进程"><span class="nav-number">1.4.4.</span> <span class="nav-text">1.4.4. 处理进程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-1-Example-1-34-使用-os-执行操作系统命令"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">1.4.4.1. Example 1-34. 使用 os 执行操作系统命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-2-Example-1-35-使用-os-模块启动新进程"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">1.4.4.2. Example 1-35. 使用 os 模块启动新进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-3-Example-1-36-使用-os-模块调用其他程序-Unix"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">1.4.4.3. Example 1-36. 使用 os 模块调用其他程序 (Unix)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-4-Example-1-37-使用-os-模块调用其他程序-Windows"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">1.4.4.4. Example 1-37. 使用 os 模块调用其他程序 (Windows)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-5-Example-1-38-使用-os-模块在后台执行程序-Windows"><span class="nav-number">1.4.4.5.</span> <span class="nav-text">1.4.4.5. Example 1-38. 使用 os 模块在后台执行程序 (Windows)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-6-Example-1-39-使用-spawn-或-fork-exec-调用其他程序"><span class="nav-number">1.4.4.6.</span> <span class="nav-text">1.4.4.6. Example 1-39. 使用 spawn 或 fork/exec 调用其他程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-5-处理守护进程-Daemon-Processes"><span class="nav-number">1.4.5.</span> <span class="nav-text">1.4.5. 处理守护进程(Daemon Processes)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-5-1-Example-1-40-使用-os-模块使脚本作为守护执行-Unix"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">1.4.5.1. Example 1-40. 使用 os 模块使脚本作为守护执行 (Unix)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-5-2-Example-1-41-使用-os-模块终止当前进程"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">1.4.5.2. Example 1-41. 使用 os 模块终止当前进程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-os-path-模块"><span class="nav-number">1.5.</span> <span class="nav-text">1.5. os.path 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-1-处理文件名"><span class="nav-number">1.5.1.</span> <span class="nav-text">1.5.1. 处理文件名</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-1-1-Example-1-42-使用-os-path-模块处理文件名"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">1.5.1.1. Example 1-42. 使用 os.path 模块处理文件名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-1-2-Example-1-43-使用-os-path-模块检查文件名的特征"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">1.5.1.2. Example 1-43. 使用 os.path 模块检查文件名的特征</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-1-3-Example-1-44-使用-os-path-模块将用户名插入到文件名"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">1.5.1.3. Example 1-44. 使用 os.path 模块将用户名插入到文件名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-1-4-Example-1-45-使用-os-path-替换文件名中的环境变量"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">1.5.1.4. Example 1-45. 使用 os.path 替换文件名中的环境变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-2-搜索文件系统"><span class="nav-number">1.5.2.</span> <span class="nav-text">1.5.2. 搜索文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-2-1-Example-1-46-使用-os-path-搜索文件系统"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">1.5.2.1. Example 1-46. 使用 os.path 搜索文件系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-2-2-Example-1-47-使用-os-listdir-搜索文件系统"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">1.5.2.2. Example 1-47. 使用 os.listdir 搜索文件系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-2-3-Example-1-48-使用-DirectoryWalker-搜索文件系统"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">1.5.2.3. Example 1-48. 使用 DirectoryWalker 搜索文件系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-2-4-Example-1-49-使用-DirectoryStatWalker-搜索文件系统"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">1.5.2.4. Example 1-49. 使用 DirectoryStatWalker 搜索文件系统</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-stat-模块"><span class="nav-number">1.6.</span> <span class="nav-text">1.6. stat 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-0-1-Example-1-50-Using-the-stat-Module"><span class="nav-number">1.6.0.1.</span> <span class="nav-text">1.6.0.1. Example 1-50. Using the stat Module</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-7-string-模块"><span class="nav-number">1.7.</span> <span class="nav-text">1.7. string 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-0-1-Example-1-51-使用-string-模块"><span class="nav-number">1.7.0.1.</span> <span class="nav-text">1.7.0.1. Example 1-51. 使用 string 模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-0-2-Example-1-52-使用字符串方法替代-string-模块函数"><span class="nav-number">1.7.0.2.</span> <span class="nav-text">1.7.0.2. Example 1-52. 使用字符串方法替代 string 模块函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-0-3-Example-1-53-使用-string-模块将字符串转为数字"><span class="nav-number">1.7.0.3.</span> <span class="nav-text">1.7.0.3. Example 1-53. 使用 string 模块将字符串转为数字</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-8-re-模块"><span class="nav-number">1.8.</span> <span class="nav-text">1.8. re 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-1-Example-1-54-使用-re-模块来匹配字符串"><span class="nav-number">1.8.0.1.</span> <span class="nav-text">1.8.0.1. Example 1-54. 使用 re 模块来匹配字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-2-Example-1-55-使用-re-模块抽出匹配的子字符串"><span class="nav-number">1.8.0.2.</span> <span class="nav-text">1.8.0.2. Example 1-55. 使用 re 模块抽出匹配的子字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-3-Example-1-56-使用-re-模块搜索子字符串"><span class="nav-number">1.8.0.3.</span> <span class="nav-text">1.8.0.3. Example 1-56. 使用 re 模块搜索子字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-4-Example-1-57-使用-re-模块替换子字符串"><span class="nav-number">1.8.0.4.</span> <span class="nav-text">1.8.0.4. Example 1-57. 使用 re 模块替换子字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-5-Example-1-58-使用-re-模块替换字符串-通过回调函数"><span class="nav-number">1.8.0.5.</span> <span class="nav-text">1.8.0.5. Example 1-58. 使用 re 模块替换字符串(通过回调函数)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-0-6-Example-1-59-使用-re-模块匹配多个模式中的一个"><span class="nav-number">1.8.0.6.</span> <span class="nav-text">1.8.0.6. Example 1-59. 使用 re 模块匹配多个模式中的一个</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-9-math-模块"><span class="nav-number">1.9.</span> <span class="nav-text">1.9. math 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-9-0-1-Example-1-60-使用-math-模块"><span class="nav-number">1.9.0.1.</span> <span class="nav-text">1.9.0.1. Example 1-60. 使用 math 模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-10-cmath-模块"><span class="nav-number">1.10.</span> <span class="nav-text">1.10. cmath 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-10-0-1-Example-1-61-使用-cmath-模块"><span class="nav-number">1.10.0.1.</span> <span class="nav-text">1.10.0.1. Example 1-61. 使用 cmath 模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-11-operator-模块"><span class="nav-number">1.11.</span> <span class="nav-text">1.11. operator 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-11-0-1-Example-1-62-使用-operator-模块"><span class="nav-number">1.11.0.1.</span> <span class="nav-text">1.11.0.1. Example 1-62. 使用 operator 模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-11-0-2-Example-1-63-使用-operator-模块检查类型"><span class="nav-number">1.11.0.2.</span> <span class="nav-text">1.11.0.2. Example 1-63. 使用 operator 模块检查类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-12-copy-模块"><span class="nav-number">1.12.</span> <span class="nav-text">1.12. copy 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-12-0-1-Example-1-64-使用-copy-模块复制对象"><span class="nav-number">1.12.0.1.</span> <span class="nav-text">1.12.0.1. Example 1-64. 使用 copy 模块复制对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-12-0-2-Example-1-65-使用-copy-模块复制集合-Collections"><span class="nav-number">1.12.0.2.</span> <span class="nav-text">1.12.0.2. Example 1-65. 使用 copy 模块复制集合(Collections)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-13-sys-模块"><span class="nav-number">1.13.</span> <span class="nav-text">1.13. sys 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-1-处理命令行参数"><span class="nav-number">1.13.1.</span> <span class="nav-text">1.13.1. 处理命令行参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-1-1-Example-1-66-使用sys模块获得脚本的参数"><span class="nav-number">1.13.1.1.</span> <span class="nav-text">1.13.1.1. Example 1-66. 使用sys模块获得脚本的参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-2-处理模块"><span class="nav-number">1.13.2.</span> <span class="nav-text">1.13.2. 处理模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-2-1-Example-1-67-使用sys模块操作模块搜索路径"><span class="nav-number">1.13.2.1.</span> <span class="nav-text">1.13.2.1. Example 1-67. 使用sys模块操作模块搜索路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-2-2-Example-1-68-使用sys模块查找内建模块"><span class="nav-number">1.13.2.2.</span> <span class="nav-text">1.13.2.2. Example 1-68. 使用sys模块查找内建模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-2-3-Example-1-69-使用sys模块查找已导入的模块"><span class="nav-number">1.13.2.3.</span> <span class="nav-text">1.13.2.3. Example 1-69. 使用sys模块查找已导入的模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-3-处理引用记数"><span class="nav-number">1.13.3.</span> <span class="nav-text">1.13.3. 处理引用记数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-3-1-Example-1-70-使用sys模块获得引用记数"><span class="nav-number">1.13.3.1.</span> <span class="nav-text">1.13.3.1. Example 1-70. 使用sys模块获得引用记数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-3-2-Example-1-71-使用sys模块获得当前平台"><span class="nav-number">1.13.3.2.</span> <span class="nav-text">1.13.3.2. Example 1-71. 使用sys模块获得当前平台</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-4-跟踪程序"><span class="nav-number">1.13.4.</span> <span class="nav-text">1.13.4. 跟踪程序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-4-1-Example-1-72-使用sys模块配置分析函数"><span class="nav-number">1.13.4.1.</span> <span class="nav-text">1.13.4.1. Example 1-72. 使用sys模块配置分析函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-4-2-Example-1-73-使用sys模块配置单步跟踪函数"><span class="nav-number">1.13.4.2.</span> <span class="nav-text">1.13.4.2. Example 1-73. 使用sys模块配置单步跟踪函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-5-处理标准输出-输入"><span class="nav-number">1.13.5.</span> <span class="nav-text">1.13.5. 处理标准输出/输入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-5-1-Example-1-74-使用sys重定向输出"><span class="nav-number">1.13.5.1.</span> <span class="nav-text">1.13.5.1. Example 1-74. 使用sys重定向输出</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-6-退出程序"><span class="nav-number">1.13.6.</span> <span class="nav-text">1.13.6. 退出程序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-6-1-Example-1-75-使用sys模块退出程序"><span class="nav-number">1.13.6.1.</span> <span class="nav-text">1.13.6.1. Example 1-75. 使用sys模块退出程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-6-2-Example-1-76-捕获sys-exit调用"><span class="nav-number">1.13.6.2.</span> <span class="nav-text">1.13.6.2. Example 1-76. 捕获sys.exit调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13-6-3-Example-1-77-另一种捕获sys-exit调用的方法"><span class="nav-number">1.13.6.3.</span> <span class="nav-text">1.13.6.3. Example 1-77. 另一种捕获sys.exit调用的方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-14-atexit-模块"><span class="nav-number">1.14.</span> <span class="nav-text">1.14. atexit 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-14-0-1-Example-1-78-使用-atexit-模块"><span class="nav-number">1.14.0.1.</span> <span class="nav-text">1.14.0.1. Example 1-78. 使用 atexit 模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-15-time-模块"><span class="nav-number">1.15.</span> <span class="nav-text">1.15. time 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-1-获得当前时间"><span class="nav-number">1.15.1.</span> <span class="nav-text">1.15.1. 获得当前时间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-1-1-Example-1-79-使用-time-模块获取当前时间"><span class="nav-number">1.15.1.1.</span> <span class="nav-text">1.15.1.1. Example 1-79. 使用 time 模块获取当前时间</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-2-将时间值转换为字符串"><span class="nav-number">1.15.2.</span> <span class="nav-text">1.15.2. 将时间值转换为字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-2-1-Example-1-80-使用-time-模块格式化时间输出"><span class="nav-number">1.15.2.1.</span> <span class="nav-text">1.15.2.1. Example 1-80. 使用 time 模块格式化时间输出</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-3-将字符串转换为时间对象"><span class="nav-number">1.15.3.</span> <span class="nav-text">1.15.3. 将字符串转换为时间对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-3-1-Example-1-81-使用-time-strptime-函数解析时间"><span class="nav-number">1.15.3.1.</span> <span class="nav-text">1.15.3.1. Example 1-81. 使用 time.strptime 函数解析时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-3-2-Example-1-82-strptime-实现"><span class="nav-number">1.15.3.2.</span> <span class="nav-text">1.15.3.2. Example 1-82. strptime 实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-4-转换时间值"><span class="nav-number">1.15.4.</span> <span class="nav-text">1.15.4. 转换时间值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-4-1-Example-1-83-使用-time-模块将本地时间元组转换为时间值-整数"><span class="nav-number">1.15.4.1.</span> <span class="nav-text">1.15.4.1. Example 1-83. 使用 time 模块将本地时间元组转换为时间值(整数)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-4-2-Example-1-84-将-UTC-时间元组转换为时间值-整数"><span class="nav-number">1.15.4.2.</span> <span class="nav-text">1.15.4.2. Example 1-84. 将 UTC 时间元组转换为时间值(整数)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-5-Timing-相关"><span class="nav-number">1.15.5.</span> <span class="nav-text">1.15.5. Timing 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15-5-1-Example-1-85-使用-time-模块评价算法"><span class="nav-number">1.15.5.1.</span> <span class="nav-text">1.15.5.1. Example 1-85. 使用 time 模块评价算法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-16-types-模块"><span class="nav-number">1.16.</span> <span class="nav-text">1.16. types 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-16-0-1-Example-1-86-使用-types-模块"><span class="nav-number">1.16.0.1.</span> <span class="nav-text">1.16.0.1. Example 1-86. 使用 types 模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-17-gc-模块"><span class="nav-number">1.17.</span> <span class="nav-text">1.17. gc 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-17-0-1-Example-1-87-使用-gc-模块收集循环引用垃圾"><span class="nav-number">1.17.0.1.</span> <span class="nav-text">1.17.0.1. Example 1-87. 使用 gc 模块收集循环引用垃圾</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">873k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">13:14</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>
      <div class="reading-progress-bar"></div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>

<script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  

  


  
    <script src="/js/scrollspy.js?v=7.3.0"></script><script src="/js/post-details.js?v=7.3.0"></script>

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'g48OrtSq4q4MWp6EAEWbkAsT-gzGzoHsz',
    appKey: 'CXW8M63QPXbQ9qKMgHDy9Be2',
    placeholder: '说点什么吧',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
