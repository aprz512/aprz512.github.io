<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: true,
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="原文地址 ContentProvider 的原理轮廓我们知道，在Android系统上，每一个应用程序都有一个独立的用户ID。为什么要给每一个应用程序分配一个独立的用户ID呢？这是为了保护各个应用程序的数据不被其它应用程序恶意破坏而设计的。Android系统是基于Linux内核来开发的，而在Linux系统中，每一个文件除了文件本身的数据之外，还具有一定的属性，其中最重要的就是文件权限了。所谓的文件权">
<meta property="og:type" content="website">
<meta property="og:title" content="ContentProvider篇01">
<meta property="og:url" content="http://aprz512.github.io/hide/old/ContentProvider篇01.html">
<meta property="og:site_name" content="二手程序员">
<meta property="og:description" content="原文地址 ContentProvider 的原理轮廓我们知道，在Android系统上，每一个应用程序都有一个独立的用户ID。为什么要给每一个应用程序分配一个独立的用户ID呢？这是为了保护各个应用程序的数据不被其它应用程序恶意破坏而设计的。Android系统是基于Linux内核来开发的，而在Linux系统中，每一个文件除了文件本身的数据之外，还具有一定的属性，其中最重要的就是文件权限了。所谓的文件权">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-21T02:00:40.738Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ContentProvider篇01">
<meta name="twitter:description" content="原文地址 ContentProvider 的原理轮廓我们知道，在Android系统上，每一个应用程序都有一个独立的用户ID。为什么要给每一个应用程序分配一个独立的用户ID呢？这是为了保护各个应用程序的数据不被其它应用程序恶意破坏而设计的。Android系统是基于Linux内核来开发的，而在Linux系统中，每一个文件除了文件本身的数据之外，还具有一定的属性，其中最重要的就是文件权限了。所谓的文件权">
  <link rel="canonical" href="http://aprz512.github.io/hide/old/ContentProvider篇01">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>
<link href="https://fonts.loli.net/css?family=EB+Garamond:400,400i,700,700i|Noto+Serif+SC:400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet">

  <title>ContentProvider篇01 | 二手程序员</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-right">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">二手程序员</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">吹灭读书灯，一身都是月。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">19</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">9</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">128</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  

</nav>
  <div class="site-search">
    
  <div class="popup search-popup">
  <div class="search-header">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <div class="search-input-wrapper">
      <input autocomplete="off" autocorrect="off" autocapitalize="none"
             placeholder="搜索..." spellcheck="false"
             type="text" id="search-input">
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
  <div id="search-result"></div>
</div>


  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">ContentProvider篇01

</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
      
      
        
          
            
          
          
            <li><a href="/hide/">HIDE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/hide/old/">OLD</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li>CONTENTPROVIDER篇01</li>
          
        
      
    
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
        
          <p><a href="http://blog.csdn.net/luoshengyang/article/details/6946067" target="_blank" rel="noopener">原文地址</a></p>
<h2 id="ContentProvider-的原理轮廓"><a href="#ContentProvider-的原理轮廓" class="headerlink" title="ContentProvider 的原理轮廓"></a>ContentProvider 的原理轮廓</h2><p>我们知道，在Android系统上，每一个应用程序都有一个独立的用户ID。为什么要给每一个应用程序分配一个独立的用户ID呢？这是为了保护各个应用程序的数据不被其它应用程序恶意破坏而设计的。Android系统是基于Linux内核来开发的，而在Linux系统中，每一个文件除了文件本身的数据之外，还具有一定的属性，其中最重要的就是文件权限了。所谓的文件权限，就是指对文件的读、写和执行权限。此外，Linux还是一个多用户的操作系统，因此，Linux将系统中的每一个文件都与一个用户以及用户组关联起来，基于不同的用户而赋予不同的文件权限。只有当一个用户对某个文件拥有相应的权限时，才能执行相应的操作，例如，只有当一个用户对某个文件拥有读权限时，这个用户才可以调用read系统调用来读取这个文件的内容。Android系统继承了Linux系统管理文件的方法，为每一个应用程序分配一个独立的用户ID和用户组ID，而由这个应用程序创建出来的数据文件就赋予相应的用户以及用户组读写的权限，其余用户则无权对该文件进行读写。</p>
<a id="more"></a>

<p>如果我们通过adb shell命令连上模拟器，切换到/data/data目录下，就可以看到很多以应用程序包（package）命名的文件夹，这些文件夹里面存放的就是各个应用程序的数据文件，例如，如果我们进入到Android系统日历应用程序数据目录com.android.providers.calendar下的databases文件中，会看到一个用来保存日历数据的数据库文件calendar.db，它的权限设置如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@android:/data/data/com.android.providers.calendar/databases # ls -l  </span><br><span class="line">-rw-rw---- app_17   app_17      33792 2011-11-07 15:50 calendar.db</span><br></pre></td></tr></table></figure>

<p>在前面的十个字符   <strong>-rw-rw—-</strong>   中，最前面的符号 <strong>-</strong> 表示这是一个普通文件，接下来的三个字符 <strong>rw-</strong> 表示这个文件的所有者对这个文件可读可写不可执行，再接下来的三个字符 <strong>rw-</strong> 表示这个文件的所有者所在的用户组的用户对这个文件可读可写不可执行，而最后的三个字符 <strong>—</strong> 表示其它的用户对这个文件不可读写也不可执行，因为这是一个数据文件，所认所有用户都不可以执行它是正确的。在接下来的两个 <strong>app_17</strong> 字符串表示这个文件的所有者和这个所有者所在的用户组的名称均为 <strong>app_17</strong> ，这是应用程序在安装的时候系统分配的，在不同的系统上，这个字符串可能是不一样，不过它所表示的意义是一样的。这意味着只有用户 I D为 app_17 或者用户组 ID 为 app_17 的那些进程才可以对这个 calendar.db 文件进行读写操作。我们通过执行终端上执行ps命令来查看一下哪个进程的用户 ID 为 app_17：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@android:/ # ps  </span><br><span class="line">USER     PID   PPID  VSIZE  RSS     WCHAN    PC         NAME  </span><br><span class="line">root      1     0     272    184   c009f230 0000875c S /init  </span><br><span class="line">...      ...   ...    ...    ...      ...    ...         ...  </span><br><span class="line">app_17   295   35    107468 21492 ffffffff afd0c38c  S com.android.providers.calendar  </span><br><span class="line">..       ...   ...    ...    ...      ...    ...         ...  </span><br><span class="line">root     556   527   892    332   00000000 afd0b24c  R ps</span><br></pre></td></tr></table></figure>

<p>这里我们看到，正是这个日历应用程序com.android.providers.calendar进程的用户ID为app_17。这样，就验证了我们前面的分析了：只有这个日历应用程序com.android.providers.calendar才可以对这个calendar.db文件进行读写操作。这个日历应用程序com.android.providers.calendar其实是由一个Content Provider组件来实现的。</p>
<p>ndroid系统对应用程序的数据文件作如此严格的保护会不会有点过头了呢？如果一个应用程序想要读写另外一个应用程序的数据文件时，应该怎么办呢？举一个典型的应用场景，我们在开发自己的应用程序时，有时候会希望读取通讯录里面某个联系人的手机号码或者电子邮件，以便可以对这个联系人打电话或者发送电子邮件，这时候就需要读取通讯录里面的联系人数据文件了。</p>
<p>现在在互联网里面，都流行平台的概念，各大公司都打着开放平台的口号，来吸引第三方来为自己的平台做应用，例如，国外最流行的Fackbook开放平台和Google+开放平台等，国内的有腾讯的Q+开放平台，还有新浪微博开放平台、360的开放平台等。这些开放平台的核心就是要开放用户数据给第三方来使使用，就像前面我们说的Android系统的通讯录，它需要把自己联系人数据开放出来给其它应用程序使用。但是，这些数据都是各个平台自己的核心数据和核心竞争力，它们需要有保护地进行开放。Android系统中的Content Provider应用程序组件正是结合上面分析的这种文件权限机制来秉承这种有保护地开放自己的数据给其它应用程序使用的理念。</p>
<p>从另外一个观点来看，即使我们不是在做平台，而只是在做一个应用程序软件，是不是就不需要这么使用到Content Provider机制了呢？非也，现在的应用程序软件，越着公司业务的成长，越来越庞大，越来越复杂。软件工程告诉我们，我们在设计这种大型的复杂的软件的时候，需要分模块和分层次来实现各个子功能组件，使得各个模块功能以松耦合的方式组织在一起完成整个应用程序功能。这样做的好处当然就是便于我们维护和扩展应用程序的代码和功能了，以及适应复杂的业务环境。在一个大型的应用程序软件架构中，从垂直的方向来看，一般都会划分为数据层、数据访问接口层以及上面的业务层。数据层用来保存数据，这些数据可以用文件的方式来组织，也可以用数据库的方式来组织，甚至可以保存在网络中；数据访问层负责向上面的业务层提供数据，而向下管理好数据层的数据；最后业务层通过数据访问层来获取一些业务相关的数据来实现自己的业务逻辑。</p>
<p>基于这种开放平台建设或者复杂软件架构的理念，我们得出一个Android应用程序设计的一般方法，如下图所示：</p>


<p>在这个架构中， 数据层采用数据库、文件或者网络来保存数据，数据访问层使用Content Provider来实现，而业务层就通过一些APP来实现。为了降低各个功能模块间耦合性，我们可以把业务层的各个APP和数据访问层中的Content Provider，放在不同的应用程序进程中来实现，而数据库中的数据统一由Content Provider来管理，即Content Provider拥有对这些文件直接进行读写的权限，同时，它又根据需要来有保护地把这些数据开放出来给上层的APP来使用。</p>
<p>那么，Content Provider又是如何把数据开放给上面的APP使用呢？一方面是这些APP没有权限读取这些数据文件，另一外面是Content Provider和这些APP是在不同的进程空间里面。回忆一下，Android系统中Binder进程间通信机制，不同的应用程序之间可以通过Binder进程间调用来传输数据。因此，前面关于一个应用程序应该如何来读写另外一个应用程序的数据的问题的答案就是使用Binder进程间通信机制，虽然一个应用程序不能直接读取另一个应用程序的数据，但是它却可以通过进程间通信方式来请求另一个这个应用程序给它传输数据。这样我们就解决了文件权限限制所带来的问题了。</p>
<p>然而，事情还不是那么简单，一般Content  Provider管理的都是大量的数据，如果在进程间传输大量的数据，效率是不是会很低下呢？这时候，匿名共享内存（Anonymous Shared Memory）就派上用场了。把需要在进程间传输的数据都写到共享内存中去，然后只通过Binder进程间通信机制来传输一个共享内存的打开文件描述符给对方就好了，是不是很简单呢。在Android系统中，Binder进程间通信机制和匿名共享内存机制结合在一起使用，真是太完美了。</p>
<h2 id="自己实现一个-ContentProvider"><a href="#自己实现一个-ContentProvider" class="headerlink" title="自己实现一个 ContentProvider"></a>自己实现一个 ContentProvider</h2><p>我们知道，在Android系统中，内置了一款轻型的数据库SQLite。SQLite是专门为嵌入式产品而设计的，它具有占用资源低的特点，而且是开源的，非常适合在Android平台中使用，关于SQLite的更多信息可以访问官方网站<a href="http://www.sqlite.org" target="_blank" rel="noopener">http://www.sqlite.org</a>。</p>
<p> ArticlesProvider应用程序就是使用SQLite来作为数据库保存文章信息的，数据库文件命名为Articles.db，它里面只有一张表ArticlesTable，表的结构如下所示：</p>


<p>它由四个字段表示，第一个字段_id表示文章的ID，类型为自动递增的integer，它作为表的key值；<br>第二个字段_title表示文章的题目，类型为text；<br>第三个字段_abstract表示文章的摘要，类型为text；<br>第四个字段_url表示文章的URL，类型为text。<br><strong>注意，当我们打算将数据库表的某一列的数据作为一个数据行的ID时，就约定它的列名为_id。这是因为我们经常需要从数据库中获取一批数据，这些数据以Cursor的形式返回，对这些返回来的数据我们一般用一个ListView来显示，而这个ListView需要一个数据适配器Adapter来作为数据源，这时候就我们就可以以这个Cursor来构造一个Adapter。有些Adapter，例如android.widget.CursorAdapter，它们在实现自己的getItemId成员函数来获取指定数据行的ID时，就必须要从这个Cursor中相应的行里面取出列名为_id的字段的内容出来作为这个数据行的ID返回给调用者。当然，我们不在数据库表中定义这个_id列名也是可以的，不过这样从数据库中查询数据后得到的Cursor适合性就变差了，因此，建议我们在设计数据库表时，尽量设置其中一个列名字_id，并且保证这一列的内容是在数据库表中是唯一的。</strong></p>
<p>下面我们就开始介绍这个应用程序的实现了。这个应用程序只有两个源文件，分别是Articles.Java和ArticlesProvider，都是放在shy.luo.providers.articles这个package下面。在Articles.java文件里面，主要是定义了一些常量，例如用来访问文章信息数据的URI、MIME（Multipurpose Internet Mail Extensions）类型以及格式等，这些常量是第三方应用程序访问这些文章信息数据时要使用到的，因此，我们把它定义在一个单独的文件中，稍后我们会介绍如果把这个Articles.java文件打包成一个jar文件，然后第三方应用程序就可以引用这个常量了，这样也避免了直接把这个源代码文件暴露给第三方应用程序。</p>
<p>Article.java内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Articles</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Data Field*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ID = <span class="string">"_id"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TITLE = <span class="string">"_title"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ABSTRACT = <span class="string">"_abstract"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = <span class="string">"_url"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Default sort order*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SORT_ORDER = <span class="string">"_id asc"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Call Method*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_GET_ITEM_COUNT = <span class="string">"METHOD_GET_ITEM_COUNT"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_ITEM_COUNT = <span class="string">"KEY_ITEM_COUNT"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Authority*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTHORITY = <span class="string">"shy.luo.providers.articles"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Match Code*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_ID = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_POS = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*MIME*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_TYPE = <span class="string">"vnd.android.cursor.dir/vnd.shy.luo.article"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_ITEM_TYPE = <span class="string">"vnd.android.cursor.item/vnd.shy.luo.article"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Content URI*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Uri CONTENT_URI = Uri.parse(<span class="string">"content://"</span> + AUTHORITY + <span class="string">"/item"</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Uri CONTENT_POS_URI = Uri.parse(<span class="string">"content://"</span> + AUTHORITY + <span class="string">"/pos"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ID、TITLE、ABSTRACT和URL四个常量前面已经解释过了，它是我们用来保存文章信息的数据表的四个列名；<br>DEFAULT_SORT_ORDER常量是调用ContentProvider接口的query函数来查询数据时用的，它表示对查询结果按照_id列的值从小到大排列；METHOD_GET_ITEM_COUNT和KEY_ITEM_COUNT两个常量是调用ContentProvider接口的一个未公开函数call来查询数据时用的，它类似于微软COM中的IDispatch接口的Invoke函数，使用这个call函数时，传入参数METHOD_GET_ITEM_COUNT表示我们要调用我们自定义的ContentProvider子类中的getItemCount函数来获取数据库中的文章信息条目的数量，结果放在一个Bundle中以KEY_ITEM_COUNT为关键字的域中。</p>
<p>剩下的常量都是跟数据URI相关的，这个需要详细解释一下。<br><strong>URI的全称是Universal Resource Identifier，即通用资源标志符，通过它用来唯一标志某个资源在网络中的位置，它的结构和我们常见的HTTP形式URL是一样的，其实我们可以把常见的HTTP形式的URL看成是URI结构的一个实例，URI是在更高一个层次上的抽象。</strong>在Android系统中，它也定义了自己的用来定义某个特定的Content Provider的URI结构，它通常由四个组件来组成，如下所示：</p>


<p>ps：不要问我这个图从哪来的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A组件称为Scheme，它固定为content://，表示它后面的路径所表示的资源是由Content Provider来提供的。</span><br><span class="line"></span><br><span class="line">B组件称为Authority，它唯一地标识了一个特定的Content Provider，因此，这部分内容一般使用Content Provider所在的package来命名，使得它是唯一的。</span><br><span class="line"></span><br><span class="line">C组件称为资源路径，它表示所请求的资源的类型，这部分内容是可选的。如果我们自己所实现的Content Provider只提供一种类型的资源访问，那么这部分内部就可以忽略；如果我们自己实现的Content Provider同时提供了多种类型的资源访问，那么这部分内容就不可以忽略了。例如，我们有两种电脑资源可以提供给用户访问，一种是笔记本电脑，一种是平板电脑，我们就把分别它们定义为notebook和pad；如果我们想进一步按照系统类型来进一步细分这两种电脑资源，对笔记本电脑来说，一种是安装了windows系统的，一种是安装了Linux系统的，我们就分别把它们定义为notebook/windows和notebook/linux；对平板电脑来说，一种是安装了iOS系统的，一种是安装了android系统的，我们就分别把它们定义为pad/ios和pad/android。</span><br><span class="line"></span><br><span class="line">D组件称为资源ID，它表示所请求的是一个特定的资源，它通常是一个数字，对应前面我们所介绍的数据库表中的_id字段的内容，它唯一地标志了某一种资源下的一个特定的实例。继续以前面的电脑资源为例，如果我们请求的是编号为123的装了android系统的平板电脑，我们就把它定义为pad/android/123。当忽略这部分内容时，它有可能是表示请求某一种资源下的所有实例，取决于我们的URI匹配规则，后面我们将会进一步解释如何设置URI匹配规则。</span><br></pre></td></tr></table></figure>

<p>回到上面的Articles.java源文件中，我们定义了两个URI，分别用COTENT_URI和CONTENT_POS_URI两个常量来表示，它们的Authority组件均指定为com.aprz.contentprovider。其中，COTENT_URI常量表示的URI表示是通过ID来访问文章信息的，而CONTENT_POS_URI常量表示的URI表示是通过位置来访问文章信息的。<br>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">content://com.aprz.contentprovider/item，表示访问所有的文章信息条目；</span><br><span class="line">content://com.aprz.contentprovider/item/123，表示只访问ID值为123的文章信息条目；</span><br><span class="line">content://com.aprz.contentprovider/pos/1，表示访问数据库表中的第1条文章信息条目，这条文章信息条目的ID值不一定为1。</span><br></pre></td></tr></table></figure>

<p>通过常量CONTENT_POS_URI来访问文章信息条目时，必须要指定位置，这也是我们设置的URI匹配规则来指定的，后面我们将会看到。</p>
<p>此外，我们还需要定义与URI对应的资源的MIME类型。<strong>每个MIME类型由两部分组成，前面是数据的大类别，后面定义具体的种类。</strong><br>在Content Provider中，URI所对应的资源的MIME类型的大类别根据同时访问的资源的数量分为两种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">对于访问单个资源的URI，它的大类别就为vnd.android.cursor.item。</span><br><span class="line">而对于同时访问多个资源的URI，它的大类别就为vnd.android.cursor.dir。</span><br></pre></td></tr></table></figure>

<p>Content Provider的URI所对应的资源的MIME类型的具体类别就需要由Content Provider的提供者来设置了，它的格式一般为vnd.[company name].[resource type]的形式。<br>例如，在我们的例子中，CONTENT_TYPE和COTENT_ITEM_TYPE两个常量分别定义了两种MIME类型，它们的大类别分别为vnd.android.cursor.dir和vnd.android.cursor.item，而具体类别均为vdn.com.aprz.article，其中com.aprz就是表示公司名了，而article表示资源的类型为文章。这两个MIME类型常量主要是在实现ContentProvider的getType函数时用到的，后面我们将会看到。</p>
<p>最后，ITEM、ITEM_ID和POS_ID三个常量分别定了三个URI匹配规则的匹配码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果URI的形式为content://com.aprz.contentprovider/item，则匹配规则返回的匹配码为ITEM；</span><br><span class="line">如果URI的形式为content://com.aprz.contentprovider/item/#，其中#表示任意一个数字，则匹配规则返回的匹配码为ITEM_ID；</span><br><span class="line">如果URI的形式为content://com.aprz.contentprovider/pos/#，其中#也是表示任意一个数字，则匹配规则返回的匹配码为ITEM_POS。</span><br></pre></td></tr></table></figure>

<p>这三个常量的用法我们在后面也将会看到。</p>
<p>这样，Articles.java文件的内容就介绍完了。下面我们再接着介绍位于src/shy/luo/providers/articles目录下的ArticlesProvider.java文件，它的内容如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticlesProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"com.aprz.contentprovider"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"Articles.db"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_TABLE = <span class="string">"ArticlesTable"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DB_VERSION = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_CREATE = <span class="string">"create table "</span> + DB_TABLE +</span><br><span class="line">            <span class="string">" ("</span> + Articles.ID + <span class="string">" integer primary key autoincrement, "</span> +</span><br><span class="line">            Articles.TITLE + <span class="string">" text not null, "</span> +</span><br><span class="line">            Articles.ABSTRACT + <span class="string">" text not null, "</span> +</span><br><span class="line">            Articles.URL + <span class="string">" text not null);"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UriMatcher uriMatcher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        uriMatcher = <span class="keyword">new</span> UriMatcher(UriMatcher.NO_MATCH);</span><br><span class="line">        <span class="comment">// 根据 _id 返回多个</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"item"</span>, Articles.ITEM);</span><br><span class="line">        <span class="comment">// 根据 _id 返回一个</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"item/#"</span>, Articles.ITEM_ID);</span><br><span class="line">        <span class="comment">// 根据 位置 pos 返回一个，第几条的意思</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"pos/#"</span>, Articles.ITEM_POS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, String&gt; articleProjectionMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        articleProjectionMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        articleProjectionMap.put(Articles.ID, Articles.ID);</span><br><span class="line">        articleProjectionMap.put(Articles.TITLE, Articles.TITLE);</span><br><span class="line">        articleProjectionMap.put(Articles.ABSTRACT, Articles.ABSTRACT);</span><br><span class="line">        articleProjectionMap.put(Articles.URL, Articles.URL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DBHelper dbHelper = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> ContentResolver resolver = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Context context = getContext();</span><br><span class="line">        <span class="keyword">assert</span> context != <span class="keyword">null</span>;</span><br><span class="line">        resolver = context.getContentResolver();</span><br><span class="line">        dbHelper = <span class="keyword">new</span> DBHelper(context, DB_NAME, <span class="keyword">null</span>, DB_VERSION);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Log.i(LOG_TAG, "Articles Provider Create");</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(@NonNull Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM:</span><br><span class="line">                <span class="keyword">return</span> Articles.CONTENT_TYPE;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_ID:</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_POS:</span><br><span class="line">                <span class="keyword">return</span> Articles.CONTENT_ITEM_TYPE;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error Uri: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(@NonNull Uri uri, ContentValues values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (uriMatcher.match(uri) != Articles.ITEM) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error Uri: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> id = db.insert(DB_TABLE, Articles.ID, values);</span><br><span class="line">        <span class="keyword">if</span> (id &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLiteException(<span class="string">"Unable to insert "</span> + values + <span class="string">" for "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Uri newUri = ContentUris.withAppendedId(uri, id);</span><br><span class="line">        resolver.notifyChange(newUri, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> newUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(@NonNull Uri uri, ContentValues values, String selection, String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM: &#123;</span><br><span class="line">                count = db.update(DB_TABLE, values, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_ID: &#123;</span><br><span class="line">                String id = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                count = db.update(DB_TABLE, values, Articles.ID + <span class="string">"="</span> + id</span><br><span class="line">                        + (!TextUtils.isEmpty(selection) ? <span class="string">" and ("</span> + selection + <span class="string">')'</span> : <span class="string">""</span>), selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error Uri: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resolver.notifyChange(uri, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(@NonNull Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM: &#123;</span><br><span class="line">                count = db.delete(DB_TABLE, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_ID: &#123;</span><br><span class="line">                String id = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                count = db.delete(DB_TABLE, Articles.ID + <span class="string">"="</span> + id</span><br><span class="line">                        + (!TextUtils.isEmpty(selection) ? <span class="string">" and ("</span> + selection + <span class="string">')'</span> : <span class="string">""</span>), selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error Uri: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resolver.notifyChange(uri, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(@NonNull Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Log.i(LOG_TAG, "ArticlesProvider.query: " + uri);</span></span><br><span class="line"></span><br><span class="line">        SQLiteDatabase db = dbHelper.getReadableDatabase();</span><br><span class="line"></span><br><span class="line">        SQLiteQueryBuilder sqlBuilder = <span class="keyword">new</span> SQLiteQueryBuilder();</span><br><span class="line">        String limit = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM: &#123;</span><br><span class="line">                sqlBuilder.setTables(DB_TABLE);</span><br><span class="line">                sqlBuilder.setProjectionMap(articleProjectionMap);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_ID: &#123;</span><br><span class="line">                String id = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                sqlBuilder.setTables(DB_TABLE);</span><br><span class="line">                sqlBuilder.setProjectionMap(articleProjectionMap);</span><br><span class="line">                sqlBuilder.appendWhere(Articles.ID + <span class="string">"="</span> + id);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> Articles.ITEM_POS: &#123;</span><br><span class="line">                String pos = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                sqlBuilder.setTables(DB_TABLE);</span><br><span class="line">                sqlBuilder.setProjectionMap(articleProjectionMap);</span><br><span class="line">                limit = pos + <span class="string">", 1"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error Uri: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cursor cursor = sqlBuilder.query(db, projection, selection, selectionArgs, <span class="keyword">null</span>, <span class="keyword">null</span>, TextUtils.isEmpty(sortOrder) ? Articles.DEFAULT_SORT_ORDER : sortOrder, limit);</span><br><span class="line">        cursor.setNotificationUri(resolver, uri);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cursor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bundle <span class="title">call</span><span class="params">(@NonNull String method, String request, Bundle args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Log.i(LOG_TAG, "ArticlesProvider.call: " + method);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method.equals(Articles.METHOD_GET_ITEM_COUNT)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error method call: "</span> + method);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Bundle <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Log.i(LOG_TAG, "ArticlesProvider.getItemCount");</span></span><br><span class="line"></span><br><span class="line">        SQLiteDatabase db = dbHelper.getReadableDatabase();</span><br><span class="line">        Cursor cursor = db.rawQuery(<span class="string">"select count(*) from "</span> + DB_TABLE, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">            count = cursor.getInt(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">        bundle.putInt(Articles.KEY_ITEM_COUNT, count);</span><br><span class="line"></span><br><span class="line">        cursor.close();</span><br><span class="line">        db.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bundle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DBHelper</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(context, name, factory, version);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">            db.execSQL(DB_CREATE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line">            db.execSQL(<span class="string">"DROP TABLE IF EXISTS "</span> + DB_TABLE);</span><br><span class="line">            onCreate(db);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在实现自己的Content Provider时，必须继承于ContentProvider类，并且实现以下六个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- onCreate()，用来执行一些初始化的工作。</span><br><span class="line"></span><br><span class="line">-- query(Uri, String[], String, String[], String)，用来返回数据给调用者。</span><br><span class="line"></span><br><span class="line">-- insert(Uri, ContentValues)，用来插入新的数据。</span><br><span class="line"></span><br><span class="line">-- update(Uri, ContentValues, String, String[])，用来更新已有的数据。</span><br><span class="line"></span><br><span class="line">-- delete(Uri, String, String[])，用来删除数据。</span><br><span class="line"></span><br><span class="line">-- getType(Uri)，用来返回数据的MIME类型。</span><br></pre></td></tr></table></figure>

<p>这些函数的实现都比较简单，这里我们就不详细介绍了，主要解释五个要点。</p>
<p>第一点是我们在ArticlesProvider类的内部中定义了一个DBHelper类，它继承于SQLiteOpenHelper类，它用是用辅助我们操作数据库的。使用这个DBHelper类来辅助操作数据库的好处是只有当我们第一次对数据库时行操作时，系统才会执行打开数据库文件的操作。拿我们这个例子来说，只有第三方应用程序第一次调用query、insert、update或者delete函数来操作数据库时，我们才会真正去打开相应的数据库文件。这样在onCreate函数里，就不用执行打开数据库的操作，因为这是一个耗时的操作，而在onCreate函数中，要避免执行这些耗时的操作。</p>
<p>第二点是设置URI匹配规则。因为我们是根据URI来操作数据库的，不同的URI对应不同的操作，所以我们首先要定义好URI匹配规则，这样，当我们获得一个URI时，就能快速地判断出要如何去操作数据库。设置URI匹配规则的代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">        uriMatcher = <span class="keyword">new</span> UriMatcher(UriMatcher.NO_MATCH);</span><br><span class="line">        <span class="comment">// 根据 _id 返回多个</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"item"</span>, Articles.ITEM);</span><br><span class="line">        <span class="comment">// 根据 _id 返回一个</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"item/#"</span>, Articles.ITEM_ID);</span><br><span class="line">        <span class="comment">// 根据 位置 pos 返回一个，第几条的意思</span></span><br><span class="line">        uriMatcher.addURI(Articles.AUTHORITY, <span class="string">"pos/#"</span>, Articles.ITEM_POS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在创建UriMatcher对象uriMatcher时，我们传给构造函数的参数为UriMatcher.NO_MATCH，它表示当uriMatcher不能匹配指定的URI时，就返回代码UriMatcher.NO_MATCH。接下来增加了三个匹配规则，分别是content://com.aprz.contentprovider/item、content://com.aprz.contentprovider/item/#和content://com.aprz.contentprovider/pos/#，它们的匹配码分别是Articles.ITEM、Articles.ITEM_ID和Articles.ITEM_POS，其中，符号#表示匹配任何数字。</p>
<p>第三点是SQLiteQueryBuilder的使用。在query函数中，我们使用SQLiteQueryBuilder来辅助数据库查询操作，使用这个类的好处是我们可以不把数据库表的字段暴露出来，而是提供别名给第三方应用程序使用，这样就可以把数据库表内部设计隐藏起来，方便后续扩展和维护。列别名到真实列名的映射是由下面这个HashMap成员变量来实现的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, String&gt; articleProjectionMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    articleProjectionMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    articleProjectionMap.put(Articles.ID, Articles.ID);</span><br><span class="line">    articleProjectionMap.put(Articles.TITLE, Articles.TITLE);</span><br><span class="line">    articleProjectionMap.put(Articles.ABSTRACT, Articles.ABSTRACT);</span><br><span class="line">    articleProjectionMap.put(Articles.URL, Articles.URL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的put函数中，第一个参数表示列的别名，第二个参数表示列的真实名称。在这个例子中，我们把列的别名和和真实名称都设置成一样的。</p>
<p>第四点是数据更新机制的使用。执行insert、update和delete三个函数时，都会导致数据库中的数据发生变化，所以这时候要通过调用ContentResolver接口的notifyChange函数来通知那些注册了监控特定URI的ContentObserver对象，使得它们可以相应地执行一些处理，例如更新数据在界面上的显示。在query函数中，最终返回给调用者的是一个Cursor，调用者获得这个Cursor以后，可以通过它的deleteRow或者commitUpdates来执行一些更新数据库的操作，这时候也要通知那些注册了相应的URI的ContentObserver来作相应的处理，因此，这里在返回Cursor之前，要通过Cursor类的setNotificationUri函数来把当前上下文的ContentResolver对象保存到Curosr里面去，以便当通过这个Cursor来改变数据库中的数据时，可以通知相应的ContentObserver来处理。<strong>不过这种用法已经过时了，即不建议通过这个Cursor来改变数据库的数据，要把Cursor中的数据看作是只读数据。</strong>这里调用Cursor类的setNotificationUri函数还有另外一个作用，我们注意到它的第二个参数uri，对应的是Cursor中的内容，当把这个uri传给Cursor时，Cursor就会注册自己的ContentObserver来监控这个uri对应的数据的变化。一旦这个uri对应的数据发生变化，这个Cursor对应的数据就不是再新的了，这时候就需要采取一些操作来更新内容了。</p>
<p>第五点我们实现了ContentProvider的call函数。<strong>这个函数是一个未公开的函数，第三方应用程序只有Android源代码环境下开发，才能使用这个函数。</strong>设计这个函数的目的是什么呢？我们知道，当我们需要从Content Provider中获得数据时，一般都是要通过调用它的query函数来获得的，而这个函数将数据放在Cursor中来返回给调用者。以前面一篇文章Android应用程序组件Content Provider简要介绍和学习计划中，我们提到，Content Provider传给第三方应用程序的数据，是通过匿名共享内存来传输的。当要传输的数据量大的时候，使用匿名共享内存来传输数据是有好处的，它可以减入数据的拷贝，提高传输效率。但是，当要传输的数据量小时，使用匿名共享内存来作为媒介就有点用牛刀来杀鸡的味道了，因为匿名共享内存并不是免费的午餐，系统创建和匿名共享内存也是有开销的。因此，Content Provider提供了call函数来让第三方应用程序来获取一些自定义数据，这些数据一般都比较小，例如，只是传输一个整数，这样就可以用较小的代价来达到相同的数据传输的目的。</p>
<p>至此，ArticlesProvider的源代码就分析完了，下面我们还要在AndroidManifest.xml文件中配置这个ArticlesProvider类才能正常使用。AndroidManifest.xml文件的内容如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">package</span>=<span class="string">"com.aprz.contentprovider"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".cp.ArticlesProvider"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:authorities</span>=<span class="string">"com.aprz.contentprovider"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">"cpdemo"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:multiprocess</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在配置Content Provider的时候，最重要的就是要指定它的authorities属性了，只有配置了这个属性，第三方应用程序才能通过它来找到这个Content Provider。<strong>这要需要注意的，这里配置的authorities属性的值是和我们前面在Articles.java文件中定义的AUTHORITY常量的值是一致的。</strong>另外一个属性multiprocess是一个布尔值，它表示这个Content Provider是否可以在每个客户进程中创建一个实例，这样做的目的是为了减少进程间通信的开销。这里我们为了减少不必要的内存开销，把属性multiprocess的值设置为false，使得系统只能有一个Content Provider实例存在，它运行在自己的进程中。在这个配置文件里面，我们还可以设置这个Content Provider的访问权限，这里我们为了简单起见，就不设置权限了。有关Content Provider的访问权限的设置，可以参考官方文档<a href="http://developer.android.com/guide/topics/manifest/provider-element.html" target="_blank" rel="noopener">http://developer.android.com/guide/topics/manifest/provider-element.html</a>。</p>
<p>前面说过，在Articles.java文件中定义的常量是要给第三方应用程序使用的，那么我们是不是直接把这个源文件交给第三方呢？这样就显得太不专业了，第三方拿到这个文件后，还必须要放在shy/luo/providers/articles目录下或者要把这个Articles类所在的package改掉才能正常使用。正确的做法是把编译好的Articles.java文件打包成一个jar文件交给第三方使用。</p>
<h2 id="Article应用程序的实现"><a href="#Article应用程序的实现" class="headerlink" title="Article应用程序的实现"></a>Article应用程序的实现</h2><p>这个应用程序的作用是用来管理ArticlesProvider应用程序中保存的文章信息的，因此，它需要获得相应的Content Provider接口来访问ArticlesProvider中的数据。我们首先在工程目录Article下面创建一个libs目录，把上面得到的ArticlesProvider.jar放在libs目录下，后面我们在编译脚本的时候，再把它引用到工程上来。下面我们就开始分析这个应用程序的实现。</p>
<p>这个应用程序的主界面MainActivity包含了一个ListView控件，用来显示从ArticlesProvider中得到的文章信息条目，在这个主界面上，可以浏览、增加、删除和更新文章信息。当需要增加、删除或者更新文章信息时，就会跳到另外一个界面ArticleActivity中去执行具体的操作。为了方便开发，我们把每一个文章信息条目封装成了一个Article类，并且把与ArticlesProvider进交互的操作都通过ArticlesAdapter类来实现。下面介绍每一个类的具本实现。</p>
<p> 下面是Article类的实现：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String abs;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Article</span><span class="params">(<span class="keyword">int</span> id, String title, String abs, String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.abs = abs;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAbstract</span><span class="params">(String abs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.abs = abs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAbstract</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.abs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 下面是ArticlesAdapter类的实现:</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticlesAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"ArticlesAdapter"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ContentResolver resolver = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArticlesAdapter</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        resolver = context.getContentResolver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">insertArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">        values.put(Articles.TITLE, article.getTitle());</span><br><span class="line">        values.put(Articles.ABSTRACT, article.getAbstract());</span><br><span class="line">        values.put(Articles.URL, article.getUrl());</span><br><span class="line"></span><br><span class="line">        Uri uri = resolver.insert(Articles.CONTENT_URI, values);</span><br><span class="line">        String itemId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(itemId).longValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        Uri uri = ContentUris.withAppendedId(Articles.CONTENT_URI, article.getId());</span><br><span class="line"></span><br><span class="line">        ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">        values.put(Articles.TITLE, article.getTitle());</span><br><span class="line">        values.put(Articles.ABSTRACT, article.getAbstract());</span><br><span class="line">        values.put(Articles.URL, article.getUrl());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> count = resolver.update(uri, values, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeArticle</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Uri uri = ContentUris.withAppendedId(Articles.CONTENT_URI, id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> count = resolver.delete(uri, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedList&lt;Article&gt; <span class="title">getAllArticles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LinkedList&lt;Article&gt; articles = <span class="keyword">new</span> LinkedList&lt;Article&gt;();</span><br><span class="line"></span><br><span class="line">        String[] projection = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                Articles.ID,</span><br><span class="line">                Articles.TITLE,</span><br><span class="line">                Articles.ABSTRACT,</span><br><span class="line">                Articles.URL</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Cursor cursor = resolver.query(Articles.CONTENT_URI, projection, <span class="keyword">null</span>, <span class="keyword">null</span>, Articles.DEFAULT_SORT_ORDER);</span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> id = cursor.getInt(<span class="number">0</span>);</span><br><span class="line">                String title = cursor.getString(<span class="number">1</span>);</span><br><span class="line">                String abs = cursor.getString(<span class="number">2</span>);</span><br><span class="line">                String url = cursor.getString(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">                Article article = <span class="keyword">new</span> Article(id, title, abs, url);</span><br><span class="line">                articles.add(article);</span><br><span class="line">            &#125; <span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> articles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public int getArticleCount() &#123;</span></span><br><span class="line"><span class="comment">//        int count = 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line"><span class="comment">//            IContentProvider provider = resolver.acquireProvider(Articles.CONTENT_URI);</span></span><br><span class="line"><span class="comment">//            Bundle bundle = provider.call(Articles.METHOD_GET_ITEM_COUNT, null, null);</span></span><br><span class="line"><span class="comment">//            count = bundle.getInt(Articles.KEY_ITEM_COUNT, 0);</span></span><br><span class="line"><span class="comment">//        &#125; catch (RemoteException e) &#123;</span></span><br><span class="line"><span class="comment">//            e.printStackTrace();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        return count;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">getArticleById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Uri uri = ContentUris.withAppendedId(Articles.CONTENT_URI, id);</span><br><span class="line"></span><br><span class="line">        String[] projection = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                Articles.ID,</span><br><span class="line">                Articles.TITLE,</span><br><span class="line">                Articles.ABSTRACT,</span><br><span class="line">                Articles.URL</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Cursor cursor = resolver.query(uri, projection, <span class="keyword">null</span>, <span class="keyword">null</span>, Articles.DEFAULT_SORT_ORDER);</span><br><span class="line"></span><br><span class="line">        Log.i(LOG_TAG, <span class="string">"cursor.moveToFirst"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cursor == <span class="keyword">null</span> || !cursor.moveToFirst()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String title = cursor.getString(<span class="number">1</span>);</span><br><span class="line">        String abs = cursor.getString(<span class="number">2</span>);</span><br><span class="line">        String url = cursor.getString(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        cursor.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Article(id, title, abs, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">getArticleByPos</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        Uri uri = ContentUris.withAppendedId(Articles.CONTENT_POS_URI, pos);</span><br><span class="line"></span><br><span class="line">        String[] projection = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                Articles.ID,</span><br><span class="line">                Articles.TITLE,</span><br><span class="line">                Articles.ABSTRACT,</span><br><span class="line">                Articles.URL</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Cursor cursor = resolver.query(uri, projection, <span class="keyword">null</span>, <span class="keyword">null</span>, Articles.DEFAULT_SORT_ORDER);</span><br><span class="line">        <span class="keyword">if</span> (!cursor.moveToFirst()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> id = cursor.getInt(<span class="number">0</span>);</span><br><span class="line">        String title = cursor.getString(<span class="number">1</span>);</span><br><span class="line">        String abs = cursor.getString(<span class="number">2</span>);</span><br><span class="line">        String url = cursor.getString(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Article(id, title, abs, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个类首先在构造函数里面获得应用程序上下文的ContentResolver接口，然后通过就可以通过这个接口来访问ArticlesProvider中的文章信息了。成员函数insertArticle、updateArticle和removeArticle分别用来新增、更新和删除一个文章信息条目；成员函数getAllArticlese用来获取所有的文章信息；成员函数getArticleById和getArticleByPos分别根据文章的ID和位置来获得具体文章信息条目；<strong>成员函数getArticleCount直接使用ContentProvider的未公开接口call来获得文章信息条目的数量，注意，这个函数要源代码环境下编译才能通过。</strong></p>
<p>下面是程序主界面MainActivity类的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span>, <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String LOG_TAG = <span class="string">"MainActivity"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ADD_ARTICAL_ACTIVITY = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> EDIT_ARTICAL_ACTIVITY = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArticleDataHelper mHelper = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> ArticleAdapter adapter = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> ArticleObserver observer = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ListView articleList = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Button addButton = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StatusLayoutManager mLayoutManager;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Article&gt; allArticles;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">            <span class="keyword">if</span> (msg.what == <span class="number">0</span>) &#123;</span><br><span class="line">                stopLoading();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        LinearLayout root = (LinearLayout) findViewById(R.id.root);</span><br><span class="line">        mLayoutManager = <span class="keyword">new</span> StatusLayoutManager.Builder(<span class="keyword">this</span>)</span><br><span class="line">                .setLoadingViewLayoutId(R.layout.loading)</span><br><span class="line">                .setContentViewLayoutId(R.layout.main)</span><br><span class="line">                .build();</span><br><span class="line">        root.addView(mLayoutManager.getStatusLayout());</span><br><span class="line"></span><br><span class="line">        initView();</span><br><span class="line">        initData();</span><br><span class="line"></span><br><span class="line">        startLoading();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        getContentResolver().unregisterContentObserver(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (v.equals(addButton)) &#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ArticleActivity.class);</span><br><span class="line">            startActivityForResult(intent, ADD_ARTICAL_ACTIVITY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> pos, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ArticleActivity.class);</span><br><span class="line"></span><br><span class="line">        Article article = mHelper.getArticleByPos(pos);</span><br><span class="line">        intent.putExtra(Articles.ID, article.getId());</span><br><span class="line">        intent.putExtra(Articles.TITLE, article.getTitle());</span><br><span class="line">        intent.putExtra(Articles.ABSTRACT, article.getAbstract());</span><br><span class="line">        intent.putExtra(Articles.URL, article.getUrl());</span><br><span class="line"></span><br><span class="line">        startActivityForResult(intent, EDIT_ARTICAL_ACTIVITY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (requestCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> ADD_ARTICAL_ACTIVITY: &#123;</span><br><span class="line">                <span class="keyword">if</span> (resultCode == Activity.RESULT_OK) &#123;</span><br><span class="line">                    String title = data.getStringExtra(Articles.TITLE);</span><br><span class="line">                    String abs = data.getStringExtra(Articles.ABSTRACT);</span><br><span class="line">                    String url = data.getStringExtra(Articles.URL);</span><br><span class="line"></span><br><span class="line">                    Article article = <span class="keyword">new</span> Article(-<span class="number">1</span>, title, abs, url);</span><br><span class="line">                    mHelper.insertArticle(article);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> EDIT_ARTICAL_ACTIVITY: &#123;</span><br><span class="line">                <span class="keyword">if</span> (resultCode == Activity.RESULT_OK) &#123;</span><br><span class="line">                    <span class="keyword">int</span> action = data.getIntExtra(ArticleActivity.EDIT_ARTICLE_ACTION, -<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (action == ArticleActivity.MODIFY_ARTICLE) &#123;</span><br><span class="line">                        <span class="keyword">int</span> id = data.getIntExtra(Articles.ID, -<span class="number">1</span>);</span><br><span class="line">                        String title = data.getStringExtra(Articles.TITLE);</span><br><span class="line">                        String abs = data.getStringExtra(Articles.ABSTRACT);</span><br><span class="line">                        String url = data.getStringExtra(Articles.URL);</span><br><span class="line"></span><br><span class="line">                        Article article = <span class="keyword">new</span> Article(id, title, abs, url);</span><br><span class="line">                        mHelper.updateArticle(article);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action == ArticleActivity.DELETE_ARTICLE) &#123;</span><br><span class="line">                        <span class="keyword">int</span> id = data.getIntExtra(Articles.ID, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                        mHelper.removeArticle(id);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mHelper = <span class="keyword">new</span> ArticleDataHelper(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        observer = <span class="keyword">new</span> ArticleObserver(<span class="keyword">new</span> Handler());</span><br><span class="line">        getContentResolver().registerContentObserver(Articles.CONTENT_URI, <span class="keyword">true</span>, observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        articleList = (ListView) findViewById(R.id.listview_article);</span><br><span class="line">        adapter = <span class="keyword">new</span> ArticleAdapter(<span class="keyword">this</span>);</span><br><span class="line">        articleList.setOnItemClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        addButton = (Button) findViewById(R.id.button_add);</span><br><span class="line">        addButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mLayoutManager.showLoadingView();</span><br><span class="line">        Executors.newSingleThreadExecutor().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                allArticles = mHelper.getAllArticles();</span><br><span class="line">                mHandler.sendEmptyMessage(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mLayoutManager.showContentView();</span><br><span class="line">        articleList.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleObserver</span> <span class="keyword">extends</span> <span class="title">ContentObserver</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ArticleObserver</span><span class="params">(Handler handler)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(handler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChange</span><span class="params">(<span class="keyword">boolean</span> selfChange)</span> </span>&#123;</span><br><span class="line">            adapter.notifyDataSetChanged();</span><br><span class="line">            startLoading();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> LayoutInflater inflater;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ArticleAdapter</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">            inflater = LayoutInflater.from(context);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> allArticles.size();</span><br><span class="line"><span class="comment">//            return mHelper.getArticleCount();</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line"><span class="comment">//            return allArticles.get(pos);</span></span><br><span class="line">            <span class="keyword">return</span> mHelper.getArticleByPos(pos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line"><span class="comment">//            return allArticles.get(pos).getId();</span></span><br><span class="line">            <span class="keyword">return</span> mHelper.getArticleByPos(pos).getId();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">            Article article = (Article) getItem(position);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">                convertView = inflater.inflate(R.layout.item, parent, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            TextView titleView = (TextView) convertView.findViewById(R.id.textview_article_title);</span><br><span class="line">            titleView.setText(<span class="string">"Title: "</span> + article.getTitle());</span><br><span class="line"></span><br><span class="line">            TextView abstractView = (TextView) convertView.findViewById(R.id.textview_article_abstract);</span><br><span class="line">            abstractView.setText(<span class="string">"Abstract: "</span> + article.getAbstract());</span><br><span class="line"></span><br><span class="line">            TextView urlView = (TextView) convertView.findViewById(R.id.textview_article_url);</span><br><span class="line">            urlView.setText(<span class="string">"URL: "</span> + article.getUrl());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> convertView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在应用程序的主界面中，我们使用一个ListView来显示文章信息条目，这个ListView的数据源由ArticleAdapter类来提供，而ArticleAdapter类又是通过ArticlesAdapter类来获得ArticlesProvider中的文章信息的。在MainActivity的onCreate函数，我们还通过应用程序上下文的ContentResolver接口来注册了一个ArticleObserver对象来监控ArticlesProvider中的文章信息。一旦ArticlesProvider中的文章信息发生变化，就会通过ArticleAdapter类来实时更新ListView中的文章信息。</p>
<p>下面是ArticleActivity类的实现:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String LOG_TAG = <span class="string">"ArticleActivity"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String EDIT_ARTICLE_ACTION = <span class="string">"EDIT_ARTICLE_ACTION"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MODIFY_ARTICLE = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DELETE_ARTICLE = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> articleId = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EditText titleEdit = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> EditText abstractEdit = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> EditText urlEdit = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button addButton = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Button modifyButton = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Button deleteButton = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Button cancelButton = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.article);</span><br><span class="line"></span><br><span class="line">        titleEdit = (EditText) findViewById(R.id.edit_article_title);</span><br><span class="line">        abstractEdit = (EditText) findViewById(R.id.edit_article_abstract);</span><br><span class="line">        urlEdit = (EditText) findViewById(R.id.edit_article_url);</span><br><span class="line"></span><br><span class="line">        addButton = (Button) findViewById(R.id.button_add_article);</span><br><span class="line">        addButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        modifyButton = (Button) findViewById(R.id.button_modify);</span><br><span class="line">        modifyButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        deleteButton = (Button) findViewById(R.id.button_delete);</span><br><span class="line">        deleteButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        cancelButton = (Button) findViewById(R.id.button_cancel);</span><br><span class="line">        cancelButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Intent intent = getIntent();</span><br><span class="line">        articleId = intent.getIntExtra(Articles.ID, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (articleId != -<span class="number">1</span>) &#123;</span><br><span class="line">            String title = intent.getStringExtra(Articles.TITLE);</span><br><span class="line">            titleEdit.setText(title);</span><br><span class="line"></span><br><span class="line">            String abs = intent.getStringExtra(Articles.ABSTRACT);</span><br><span class="line">            abstractEdit.setText(abs);</span><br><span class="line"></span><br><span class="line">            String url = intent.getStringExtra(Articles.URL);</span><br><span class="line">            urlEdit.setText(url);</span><br><span class="line"></span><br><span class="line">            addButton.setVisibility(View.GONE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            modifyButton.setVisibility(View.GONE);</span><br><span class="line">            deleteButton.setVisibility(View.GONE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Log.i(LOG_TAG, <span class="string">"ArticleActivity Created"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (v.equals(addButton)) &#123;</span><br><span class="line">            String title = titleEdit.getText().toString();</span><br><span class="line">            String abs = abstractEdit.getText().toString();</span><br><span class="line">            String url = urlEdit.getText().toString();</span><br><span class="line"></span><br><span class="line">            Intent result = <span class="keyword">new</span> Intent();</span><br><span class="line">            result.putExtra(Articles.TITLE, title);</span><br><span class="line">            result.putExtra(Articles.ABSTRACT, abs);</span><br><span class="line">            result.putExtra(Articles.URL, url);</span><br><span class="line"></span><br><span class="line">            setResult(Activity.RESULT_OK, result);</span><br><span class="line">            finish();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v.equals(modifyButton)) &#123;</span><br><span class="line">            String title = titleEdit.getText().toString();</span><br><span class="line">            String abs = abstractEdit.getText().toString();</span><br><span class="line">            String url = urlEdit.getText().toString();</span><br><span class="line"></span><br><span class="line">            Intent result = <span class="keyword">new</span> Intent();</span><br><span class="line">            result.putExtra(Articles.ID, articleId);</span><br><span class="line">            result.putExtra(Articles.TITLE, title);</span><br><span class="line">            result.putExtra(Articles.ABSTRACT, abs);</span><br><span class="line">            result.putExtra(Articles.URL, url);</span><br><span class="line">            result.putExtra(EDIT_ARTICLE_ACTION, MODIFY_ARTICLE);</span><br><span class="line"></span><br><span class="line">            setResult(Activity.RESULT_OK, result);</span><br><span class="line">            finish();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v.equals(deleteButton)) &#123;</span><br><span class="line">            Intent result = <span class="keyword">new</span> Intent();</span><br><span class="line">            result.putExtra(Articles.ID, articleId);</span><br><span class="line">            result.putExtra(EDIT_ARTICLE_ACTION, DELETE_ARTICLE);</span><br><span class="line"></span><br><span class="line">            setResult(Activity.RESULT_OK, result);</span><br><span class="line">            finish();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v.equals(cancelButton)) &#123;</span><br><span class="line">            setResult(Activity.RESULT_CANCELED, <span class="keyword">null</span>);</span><br><span class="line">            finish();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在ArticleActivity窗口中，我们可以执行新增、更新和删除文章信息的操作。如果启动ArticleActivity时，没有把文章ID传进来，就说明要执行操作是新增文章信息；如果启动ArticleActivity时，把文章ID和其它信自都传进来了，就说明要执行的操作是更新或者删除文章，根据用户在界面点击的是更新按钮还是删除按钮来确定。</p>
<p>程序使用到的界面文件定义在res/layout目录下，其中，main.xml文件定义MainActivity的界面，它的内容如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:id</span>=<span class="string">"@+id/root"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:gravity</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/listview_article"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:choiceMode</span>=<span class="string">"singleChoice"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/button_add"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingRight</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"add"</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>PS:<br>getWritableDatabase() 取得的实例不是仅仅具有写的功能，而是同时具有读和写的功能。同样的，getReadableDatabase() 取得的实例也是具对数据库进行读和写的功能。</p>
<p>两者的区别在于：<br>getWritableDatabase() 取得的实例是以读写的方式打开数据库，如果打开的数据库磁盘满了，此时只能读不能写，此时调用了getWritableDatabase() 的实例，那么将会发生错误（异常）。<br>getReadableDatabase() 取得的实例是先调用getWritableDatabase() 以读写的方式打开数据库，如果数据库的磁盘满了，此时返回打开失败，继而用getReadableDatabase() 的实例以只读的方式去打开数据库。</p>

        
      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
      
      
        
          
            
          
          
            <li><a href="/hide/">HIDE</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li><a href="/hide/old/">OLD</a></li>
          
        
      
    
      
      
        
          
            
          
          
            <li>CONTENTPROVIDER篇01</li>
          
        
      
    
  </ul>

    
    
    
  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://github.com/aprz512/pic4aprz512/blob/master/Blog/avatar/avatar.jpeg?raw=true"
      alt="aprz512">
  <p class="site-author-name" itemprop="name">aprz512</p>
  <div class="site-description motion-element" itemprop="description">博客建于2017年02月05日21:39:56</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">128</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/aprz512" title="GitHub &rarr; https://github.com/aprz512" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>




        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ContentProvider-的原理轮廓"><span class="nav-number">1.</span> <span class="nav-text">ContentProvider 的原理轮廓</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自己实现一个-ContentProvider"><span class="nav-number">2.</span> <span class="nav-text">自己实现一个 ContentProvider</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Article应用程序的实现"><span class="nav-number">3.</span> <span class="nav-text">Article应用程序的实现</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">525k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">7:57</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>
      <div class="reading-progress-bar"></div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>

<script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  

  


  
    <script src="/js/scrollspy.js?v=7.3.0"></script><script src="/js/post-details.js?v=7.3.0"></script>

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'g48OrtSq4q4MWp6EAEWbkAsT-gzGzoHsz',
    appKey: 'CXW8M63QPXbQ9qKMgHDy9Be2',
    placeholder: '说点什么吧',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
