<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: true,
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="原文链接 1. Using reactive programming with RxJava 2.01.1. What is RxJava and reactive programming在响应式编程中，消费者会对产生的数据做出反应。这也是异步编程被叫做响应式编程的原因。响应式编程允许传递事件变化给注册过的观察者。 Reactivex工程为多种不同的编程语言提供了上面概念的实现方式。它对自己的描述">
<meta property="og:type" content="website">
<meta property="og:title" content="RxJava 入门02">
<meta property="og:url" content="http://aprz512.github.io/hide/RxJava-入门02.html">
<meta property="og:site_name" content="六根不净堂">
<meta property="og:description" content="原文链接 1. Using reactive programming with RxJava 2.01.1. What is RxJava and reactive programming在响应式编程中，消费者会对产生的数据做出反应。这也是异步编程被叫做响应式编程的原因。响应式编程允许传递事件变化给注册过的观察者。 Reactivex工程为多种不同的编程语言提供了上面概念的实现方式。它对自己的描述">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-10-09T03:31:30.773Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxJava 入门02">
<meta name="twitter:description" content="原文链接 1. Using reactive programming with RxJava 2.01.1. What is RxJava and reactive programming在响应式编程中，消费者会对产生的数据做出反应。这也是异步编程被叫做响应式编程的原因。响应式编程允许传递事件变化给注册过的观察者。 Reactivex工程为多种不同的编程语言提供了上面概念的实现方式。它对自己的描述">
  <link rel="canonical" href="http://aprz512.github.io/hide/RxJava-入门02">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: true,
    isArchive: false
  };
</script>
<link href="https://fonts.loli.net/css?family=EB+Garamond:400,400i,700,700i|Noto+Serif+SC:400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet">

  <title>RxJava 入门02 | 六根不净堂</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-right">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">六根不净堂</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">吹灭读书灯，一身都是月。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">15</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">5</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">108</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  

</nav>
  <div class="site-search">
    
  <div class="popup search-popup">
  <div class="search-header">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <div class="search-input-wrapper">
      <input autocomplete="off" autocorrect="off" autocapitalize="none"
             placeholder="搜索..." spellcheck="false"
             type="text" id="search-input">
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
  <div id="search-result"></div>
</div>


  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">RxJava 入门02

</h1>

<div class="post-meta">
  

</div>

</header>

      
      
      
      <div class="post-body">
        
          <p><a href="http://www.vogella.com/tutorials/RxJava/article.html" target="_blank" rel="noopener">原文链接</a></p>
<h2 id="1-Using-reactive-programming-with-RxJava-2-0"><a href="#1-Using-reactive-programming-with-RxJava-2-0" class="headerlink" title="1. Using reactive programming with RxJava 2.0"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#using-reactive-programming-with-rxjava-2-0" target="_blank" rel="noopener">1. Using reactive programming with RxJava 2.0</a></h2><h3 id="1-1-What-is-RxJava-and-reactive-programming"><a href="#1-1-What-is-RxJava-and-reactive-programming" class="headerlink" title="1.1. What is RxJava and reactive programming"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#what-is-rxjava-and-reactive-programming" target="_blank" rel="noopener">1.1. What is RxJava and reactive programming</a></h3><p>在响应式编程中，消费者会对产生的数据做出反应。这也是异步编程被叫做响应式编程的原因。响应式编程允许传递事件变化给注册过的观察者。</p>
<p><a href="http://reactivex.io/" target="_blank" rel="noopener">Reactivex</a>工程为多种不同的编程语言提供了上面概念的实现方式。它对自己的描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Observer pattern done right. ReactiveX is a combination of the best ideas from the Observer pattern, the Iterator pattern, and functional programming.</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="noopener">RxJava</a>是这种概念的Java语言的实现。RxJava is published under the Apache 2.0 license. RxJava provides Java API for asynchronous programming with observable streams.</p>
<a id="more"></a>

<h2 id="2-Build-blocks-for-RxJava"><a href="#2-Build-blocks-for-RxJava" class="headerlink" title="2. Build blocks for RxJava"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#build-blocks-for-rxjava" target="_blank" rel="noopener">2. Build blocks for RxJava</a></h2><p>RxJava 代码主要由下面几个块组成：</p>
<ul>
<li><strong>observables</strong> 代表数据源</li>
<li><strong>subscribers (or observers)</strong> 监听数据源</li>
<li>一系列修改与合成数据的方法</li>
</ul>
<p>一个 <code>observable</code>对象发射数据，一个<code>subscriber</code>对象消费这些数据。</p>
<h3 id="2-1-Observables"><a href="#2-1-Observables" class="headerlink" title="2.1. Observables"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#observables" target="_blank" rel="noopener">2.1. Observables</a></h3><p><code>Observables</code>是数据源。通常一旦有<code>subscriber</code>开始监听，就开始提供数据。一个<code>observable</code>可以发射任意多个数据（包括0个）。无论是数据发射完成还是遇到错误，都会终结自己。也有不会终结的数据源，举个例子：一个按钮点击事件的<code>observable</code>就可以潜在的提供无限的事件流。</p>
<h3 id="2-2-Subscribers"><a href="#2-2-Subscribers" class="headerlink" title="2.2. Subscribers"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#subscribers" target="_blank" rel="noopener">2.2. Subscribers</a></h3><p>一个<code>observable</code>能有任意数量的<code>subscribers</code>。如果<code>observable</code>发射了一个新的数据，<code>subscriber</code>的<code>onNext()</code>方法就会被调用。如果<code>observable</code>发射出了所有数据而没有出现错误，<code>subscriber</code>的<code>onComplete()</code>会被调用，反之，<code>onError()</code>会被调用。</p>
<h2 id="3-RxJava-example"><a href="#3-RxJava-example" class="headerlink" title="3. RxJava example"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#rxjava-example" target="_blank" rel="noopener">3. RxJava example</a></h2><p>一个简单的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> junit.framework.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxJavaUnitTest</span> </span>&#123;</span><br><span class="line">    String result=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Simple subscription to a fix value</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnAValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        result = <span class="string">""</span>;</span><br><span class="line">        Observable&lt;String&gt; observer = Observable.just(<span class="string">"Hello"</span>); <span class="comment">// provides datea</span></span><br><span class="line">        observer.subscribe(s -&gt; result=s); <span class="comment">// Callable as subscriber</span></span><br><span class="line">        assertTrue(result.equals(<span class="string">"Hello"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-Why-doing-asynchronous-programming"><a href="#3-1-Why-doing-asynchronous-programming" class="headerlink" title="3.1. Why doing asynchronous programming"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#why-doing-asynchronous-programming" target="_blank" rel="noopener">3.1. Why doing asynchronous programming</a></h3><p><code>Reactive programming</code>以下简称<code>RP</code>。</p>
<p>RP简化了异步编程。This allows to simplify the asynchronously processing of potential long running operations. 它提供了定义好的方法用来处理多事件，错误和事件流的终结。RP也提供了更简便的方式用来处理在不同的线程中运行不同的任务。举个例子：Android中的控件更新必须要在UI线程，RP就支持让<code>observables</code>和<code>subscribers</code>在不同的线程中运行。</p>
<p>It is also possible to convert the stream before its received by the observers. And you can chain operations, e.g., if a API call depends on the call of another API Last but not least, reactive programming reduces the need for state variables, which can be the source of errors.</p>
<h3 id="3-2-Adding-RxJava-2-to-a-Java-project"><a href="#3-2-Adding-RxJava-2-to-a-Java-project" class="headerlink" title="3.2. Adding RxJava 2 to a Java project"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#adding-rxjava-2-to-a-java-project" target="_blank" rel="noopener">3.2. Adding RxJava 2 to a Java project</a></h3><p>写这个玩意的时候，最新的发布版是2.1.1，替换你想要的版本。</p>
<p>在 <code>Gradle</code> 中使用：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">group:</span> <span class="string">'io.reactivex.rxjava2'</span>, <span class="string">name:</span> <span class="string">'rxjava'</span>, <span class="string">version:</span> <span class="string">'2.1.1'</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Creating-Observables-subscribing-to-them-and-disposing-them"><a href="#4-Creating-Observables-subscribing-to-them-and-disposing-them" class="headerlink" title="4. Creating Observables, subscribing to them and disposing them"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#creating-observables-subscribing-to-them-and-disposing-them" target="_blank" rel="noopener">4. Creating Observables, subscribing to them and disposing them</a></h2><h3 id="4-1-Creating-observables"><a href="#4-1-Creating-observables" class="headerlink" title="4.1. Creating observables"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#creating-observables" target="_blank" rel="noopener">4.1. Creating observables</a></h3><p>你可以创建许多不同类型的<code>observables</code>。</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Flowable&lt;T&gt;</code></td>
<td>Emits 0 or n items and terminates with an success or an error event. Supports backpressure, which allows to control how fast a source emits items.</td>
</tr>
<tr>
<td><code>Observable&lt;T&gt;</code></td>
<td>Emits 0 or n items and terminates with an success or an error event.</td>
</tr>
<tr>
<td><code>Single&lt;T&gt;</code></td>
<td>Emits either a single item or an error event. The reactive version of a method call.</td>
</tr>
<tr>
<td><code>Maybe&lt;T&gt;</code></td>
<td>Succeeds with an item, or no item, or errors. The reactive version of an <code>Optional</code>.</td>
</tr>
<tr>
<td><code>Completable</code></td>
<td>Either completes with an success or with an error event. It never emits items. The reactive version of a <code>Runnable</code>.</td>
</tr>
</tbody></table>
<p>一个使用<code>Flowable</code>的例子：</p>
<p>当你处理触摸事件的时候，你无法控制正在触发这些触摸事件的用户，但是你可以控制数据源让它以一个较慢的速率来发送数据，以防你无法处理以用户的触摸频率产生的所有事件。</p>
<p>下面的代码展示了怎样创建一个<code>observable</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;Todo&gt; todoObservable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Todo&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Todo&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    List&lt;Todo&gt; todos = RxJavaUnitTest.<span class="keyword">this</span>.getTodos();</span><br><span class="line">                    <span class="keyword">for</span> (Todo todo : todos) &#123;</span><br><span class="line">                        emitter.onNext(todo);</span><br><span class="line">                    &#125;</span><br><span class="line">                    emitter.onComplete();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    emitter.onError(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>如果使用lambdas表达式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;Todo&gt; todoObservable = Observable.create(emitter -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;Todo&gt; todos = getTodos();</span><br><span class="line">        <span class="keyword">for</span> (Todo todo : todos) &#123;</span><br><span class="line">            emitter.onNext(todo);</span><br><span class="line">        &#125;</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        emitter.onError(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>下面是一个<code>Maybe</code>的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Maybe&lt;List&lt;Todo&gt;&gt; todoMaybe = Maybe.create(emitter -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;Todo&gt; todos = getTodos();</span><br><span class="line">      	<span class="comment">// ①</span></span><br><span class="line">        <span class="keyword">if</span>(todos != <span class="keyword">null</span> &amp;&amp; !todos.isEmpty()) &#123;</span><br><span class="line">            emitter.onSuccess(todos); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          	<span class="comment">// ②</span></span><br><span class="line">            emitter.onComplete(); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      	<span class="comment">// ③</span></span><br><span class="line">        emitter.onError(e); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>① <code>java.util.Optional</code> has a value</p>
<p>② <code>java.util.Optional</code> contains no value → null</p>
<p>③ An error occurred</p>
<h3 id="4-2-Convenience-methods-to-create-observables"><a href="#4-2-Convenience-methods-to-create-observables" class="headerlink" title="4.2. Convenience methods to create observables"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#convenience-methods-to-create-observables" target="_blank" rel="noopener">4.2. Convenience methods to create observables</a></h3><p>RxJava还提供了很多方法来创建<code>observables</code>。</p>
<ul>
<li><code>Observable.just(&quot;Hello&quot;)</code> - Allows to create an observable as wrapper around other data types</li>
<li><code>Observable.fromIterable()</code> - takes an <code>java.lang.Iterable&lt;T&gt;</code> and emits their values in their order in the data structure</li>
<li><code>Observable.fromArray()</code> - takes an array and emits their values in their order in the data structure</li>
<li><code>Observable.fromCallable()</code> - Allows to create an observable for a <code>java.util.concurrent.Callable&lt;V&gt;</code></li>
<li><code>Observable.fromFuture()</code> - Allows to create an observable for a <code>java.util.concurrent.Future</code></li>
<li><code>Observable.interval()</code> - An observable that emits <code>Long</code> objects in a given interval</li>
</ul>
<p>其他类型也有类似的方法， <code>Flowable.just()</code>, <code>Maybe.just()</code> and <code>Single.just</code>.</p>
<h3 id="4-3-Subscribing-in-RxJava"><a href="#4-3-Subscribing-in-RxJava" class="headerlink" title="4.3. Subscribing in RxJava"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#subscribing-in-rxjava" target="_blank" rel="noopener">4.3. Subscribing in RxJava</a></h3><p>为了能够接收<code>observable</code>发射出来的数据，你需要订阅它。<code>observables</code>提供了各式各样的订阅方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;Todo&gt; todoObservable = Observable.create(emitter -&gt; &#123; ... &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simply subscribe with a io.reactivex.functions.Consumer&lt;T&gt;, which will be informed onNext()</span></span><br><span class="line">Disposable disposable = todoObservable.subscribe(t -&gt; System.out.print(t));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dispose the subscription when not interested in the emitted data any more</span></span><br><span class="line">disposable.dispose();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Also handle the error case with a second io.reactivex.functions.Consumer&lt;T&gt;</span></span><br><span class="line">Disposable subscribe = todoObservable.subscribe(t -&gt; System.out.print(t), e -&gt; e.printStackTrace());</span><br></pre></td></tr></table></figure>

<p><code>observable</code>实例对象还有一个<code>subscribeWith</code>方法，使用如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DisposableObserver&lt;Todo&gt; disposableObserver =</span><br><span class="line">        todoObservable.subscribeWith(<span class="keyword">new</span>  DisposableObserver&lt;Todo&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Todo t)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-4-Disposing-subscriptions-and-using-CompositeDisposable"><a href="#4-4-Disposing-subscriptions-and-using-CompositeDisposable" class="headerlink" title="4.4. Disposing subscriptions and using CompositeDisposable"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#disposing-subscriptions-and-using-compositedisposable" target="_blank" rel="noopener">4.4. Disposing subscriptions and using CompositeDisposable</a></h3><p>When listers or subscribers are attached they usually are not supposed to listen eternally.</p>
<p>所以会出现这样的情况，由于状态的变化，<code>observable</code>发射的数据可能不再会被关心。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.reactivex.Single;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.observers.DisposableSingleObserver;</span><br><span class="line"></span><br><span class="line">Single&lt;List&lt;Todo&gt;&gt; todosSingle = getTodos();</span><br><span class="line"></span><br><span class="line">Disposable disposable = todosSingle.subscribeWith(<span class="keyword">new</span> DisposableSingleObserver&lt;List&lt;Todo&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;Todo&gt; todos)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// work with the resulting todos</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// handle the error case</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// continue working and dispose when value of the Single is not interesting any more</span></span><br><span class="line">disposable.dispose();</span><br></pre></td></tr></table></figure>

<p> <code>Single</code> 类与其他的 <code>observable</code> 类不一样，它提供了不同的订阅方法，返回一个 <code>Disposable</code> 对象.</p>
<p>When working with multiple subscriptions, which may become obsolete due to the same state change using a <code>CompositeDisposable</code> is pretty handy to dispose a collection of subscriptions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.reactivex.Single;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.observers.DisposableSingleObserver;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.CompositeDisposable;</span><br><span class="line"></span><br><span class="line">CompositeDisposable compositeDisposable = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line"></span><br><span class="line">Single&lt;List&lt;Todo&gt;&gt; todosSingle = getTodos();</span><br><span class="line"></span><br><span class="line">Single&lt;Happiness&gt; happiness = getHappiness();</span><br><span class="line"></span><br><span class="line">compositeDisposable.add(todosSingle.subscribeWith(<span class="keyword">new</span> DisposableSingleObserver&lt;List&lt;Todo&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;Todo&gt; todos)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// work with the resulting todos</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// handle the error case</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">compositeDisposable.add(happiness.subscribeWith(<span class="keyword">new</span> DisposableSingleObserver&lt;Happiness&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Happiness happiness)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// celebrate the happiness :-D</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"Don't worry, be happy! :-P"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// continue working and dispose all subscriptions when the values from the Single objects are not interesting any more</span></span><br><span class="line">compositeDisposable.dispose();</span><br></pre></td></tr></table></figure>

<p>关于<code>CompositeDisposable</code>更详细的用法请看：</p>
<p><a href="https://stackoverflow.com/questions/39203791/how-to-use-compositedisposable-of-rxjava-2" target="_blank" rel="noopener">https://stackoverflow.com/questions/39203791/how-to-use-compositedisposable-of-rxjava-2</a></p>
<h2 id="5-Caching-values-of-completed-observables"><a href="#5-Caching-values-of-completed-observables" class="headerlink" title="5. Caching values of completed observables"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#caching-values-of-completed-observables" target="_blank" rel="noopener">5. Caching values of completed observables</a></h2><p>When working with observables doing async calls on every subscription on an observable is often not necessary.</p>
<p>It likely happens that observables are passed around in the application, without the need to do an such an expensive call all the time a subscription is added.</p>
<p>下面的代码做了4次昂贵的网络请求，实际上却只需要请求一次，因为每次显示的都是同一个<code>Todo</code>对象，只是显示的方式不一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Single&lt;List&lt;Todo&gt;&gt; todosSingle = Single.create(emitter -&gt; &#123;</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Todo&gt; todosFromWeb = <span class="comment">// query a webservice</span></span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"Called 4 times!"</span>);</span><br><span class="line"></span><br><span class="line">            emitter.onSuccess(todosFromWeb);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            emitter.onError(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">todosSingle.subscribe(... <span class="string">" Show todos times in a bar chart "</span> ...);</span><br><span class="line"></span><br><span class="line">showTodosInATable(todosSingle);</span><br><span class="line"></span><br><span class="line">todosSingle.subscribe(... <span class="string">" Show todos in gant diagram "</span> ...);</span><br><span class="line"></span><br><span class="line">anotherMethodThatsSupposedToSubscribeTheSameSingle(todosSingle);</span><br></pre></td></tr></table></figure>

<p>接下来的代码使用了<code>cache</code>，一旦第一次请求成功，就将<code>single</code>对象保存起来：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Single&lt;List&lt;Todo&gt;&gt; todosSingle = Single.create(emitter -&gt; &#123;</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Todo&gt; todosFromWeb = <span class="comment">// query a webservice</span></span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"I am only called once!"</span>);</span><br><span class="line"></span><br><span class="line">            emitter.onSuccess(todosFromWeb);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            emitter.onError(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cache the result of the single, so that the web query is only done once</span></span><br><span class="line">Single&lt;List&lt;Todo&gt;&gt; cachedSingle = todosSingle.cache();</span><br><span class="line"></span><br><span class="line">cachedSingle.subscribe(... <span class="string">" Show todos times in a bar chart "</span> ...);</span><br><span class="line"></span><br><span class="line">showTodosInATable(cachedSingle);</span><br><span class="line"></span><br><span class="line">cachedSingle.subscribe(... <span class="string">" Show todos in gant diagram "</span> ...);</span><br><span class="line"></span><br><span class="line">anotherMethodThatsSupposedToSubscribeTheSameSingle(cachedSingle);</span><br></pre></td></tr></table></figure>

<h2 id="6-Conversion-between-types"><a href="#6-Conversion-between-types" class="headerlink" title="6. Conversion between types"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#conversion-between-types" target="_blank" rel="noopener">6. Conversion between types</a></h2><p>不同的RxJava类型很容易转换。</p>
<table>
<thead>
<tr>
<th>From / To</th>
<th>Flowable</th>
<th>Observable</th>
<th>Maybe</th>
<th>Single</th>
<th>Completable</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Flowable</strong></td>
<td></td>
<td>toObservable()</td>
<td>reduce()elementAt()firstElement()lastElement()singleElement()</td>
<td>scan()elementAt()first()/firstOrError()last()/lastOrError()single()/singleOrError()all()/any()/count()(and more…)</td>
<td>ignoreElements()</td>
</tr>
<tr>
<td><strong>Observable</strong></td>
<td>toFlowable()</td>
<td></td>
<td>reduce()elementAt()firstElement()lastElement()singleElement()</td>
<td>scan()elementAt()first()/firstOrError()last()/lastOrError()single()/singleOrError()all()/any()/count()(and more…)</td>
<td>ignoreElements()</td>
</tr>
<tr>
<td><strong>Maybe</strong></td>
<td>toFlowable()</td>
<td>toObservable()</td>
<td></td>
<td>toSingle()sequenceEqual()</td>
<td>toCompletable()</td>
</tr>
<tr>
<td><strong>Single</strong></td>
<td>toFlowable()</td>
<td>toObservable()</td>
<td>toMaybe()</td>
<td></td>
<td>toCompletable()</td>
</tr>
<tr>
<td><strong>Completable</strong></td>
<td>toFlowable()</td>
<td>toObservable()</td>
<td>toMaybe()</td>
<td>toSingle()toSingleDefault()</td>
<td></td>
</tr>
</tbody></table>
<h2 id="7-RxAndroid"><a href="#7-RxAndroid" class="headerlink" title="7. RxAndroid"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#rxandroid" target="_blank" rel="noopener">7. RxAndroid</a></h2><h3 id="7-1-Using-RxAndroid"><a href="#7-1-Using-RxAndroid" class="headerlink" title="7.1. Using RxAndroid"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#using-rxandroid" target="_blank" rel="noopener">7.1. Using RxAndroid</a></h3><p>RxAndroid是RxJava的扩展。它提供了一个能够将代码放在Android的主线程上运行的调度器。同时也可以创建运行在Handler类上的调度器。有了这个调度器，你就可以定义一个工作在后台线程的<code>observable</code>，然后发送结果到主线程。下面演示了一个使用RxJava代替 <code>AsyncTask</code>的例子：</p>
<p><code>build.gradle</code>文件配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br><span class="line">compile <span class="string">'io.reactivex.rxjava2:rxjava:2.0.8'</span></span><br></pre></td></tr></table></figure>

<p>定义一个耗时操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Observable&lt;Integer&gt; serverDownloadObservable = Observable.create(emitter -&gt; &#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>); <span class="comment">// simulate delay</span></span><br><span class="line">        emitter.onNext(<span class="number">5</span>);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>现在你可以订阅这个<code>observable</code>了。订阅行为将会触发代码的执行。</p>
<p>举个例子，加入你将触发行为放在了一个button上面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">serverDownloadObservable.</span><br><span class="line">  						<span class="comment">// The subscriber observes in the main thread</span></span><br><span class="line">                        observeOn(AndroidSchedulers.mainThread()).</span><br><span class="line">  						<span class="comment">// 	Observable is called outside the main thread</span></span><br><span class="line">                        subscribeOn(Schedulers.io()).  </span><br><span class="line">                        subscribe(integer -&gt; &#123;</span><br><span class="line">                            updateTheUserInterface(integer); <span class="comment">// this methods updates the ui</span></span><br><span class="line">                            view.setEnabled(<span class="keyword">true</span>); <span class="comment">// enables it again</span></span><br><span class="line">                        &#125;);</span><br></pre></td></tr></table></figure>

<p>我们只对最后的结果感兴趣，所以可以使用<code>Single</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Subscription subscription = Single.create(<span class="keyword">new</span> Single.OnSubscribe() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(SingleSubscriber singleSubscriber)</span> </span>&#123;</span><br><span class="line">               String result = doSomeLongRunningStuff();</span><br><span class="line">               singleSubscriber.onSuccess(value);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">       .subscribeOn(Schedulers.io())</span><br><span class="line">       .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">       .subscribe(<span class="keyword">new</span> Action1() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">               <span class="comment">// onSuccess</span></span><br><span class="line">               updateTheUserInterface(); <span class="comment">// this methods updates the ui</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="keyword">new</span> Action1() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">               <span class="comment">// handle onError</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="7-2-Unsubscribe-to-avoid-memory-leaks"><a href="#7-2-Unsubscribe-to-avoid-memory-leaks" class="headerlink" title="7.2. Unsubscribe to avoid memory leaks"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#unsubscribe-to-avoid-memory-leaks" target="_blank" rel="noopener">7.2. Unsubscribe to avoid memory leaks</a></h3><p><code>Observable.subscribe()</code> 返回一个 <code>Subscription</code>对象，如果你使用的是<code>Flowable</code>返回一个 <code>Disposable</code>对象。为了避免可能的内存内存泄露，你需要在activity和fragment的<code>onStop()</code>方法里面接触你订阅的<code>observables</code>。举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onDestroy();</span><br><span class="line">       <span class="keyword">if</span> (bookSubscription != <span class="keyword">null</span> &amp;&amp; !bookSubscription.isDisposed()) &#123;</span><br><span class="line">           bookSubscription.dispose();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-Exercise-First-steps-with-RxJava-and-RxAndroid"><a href="#8-Exercise-First-steps-with-RxJava-and-RxAndroid" class="headerlink" title="8. Exercise: First steps with RxJava and RxAndroid"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#exercise-first-steps-with-rxjava-and-rxandroid" target="_blank" rel="noopener">8. Exercise: First steps with RxJava and RxAndroid</a></h2><p>创建一个新工程，使用<code>com.vogella.android.rxjava.simple</code>作为包名。</p>
<h3 id="8-1-Gradle-dependencies"><a href="#8-1-Gradle-dependencies" class="headerlink" title="8.1. Gradle dependencies"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#gradle-dependencies" target="_blank" rel="noopener">8.1. Gradle dependencies</a></h3><p>添加下面的依赖文件到app/build.gradle文件中：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:recyclerview-v7:23.1.1'</span></span><br><span class="line">compile <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br><span class="line">compile <span class="string">'io.reactivex.rxjava2:rxjava:2.0.8'</span></span><br><span class="line">compile <span class="string">'com.squareup.okhttp:okhttp:2.5.0'</span></span><br><span class="line">testCompile <span class="string">'junit:junit:4.12'</span></span><br></pre></td></tr></table></figure>

<p>使用 java 8：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   <span class="comment">// more stuff</span></span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你想使用 lambdas 表达式，添加如下代码：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">        ......</span><br><span class="line">        jackOptions &#123;</span><br><span class="line">            enabled <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-Create-activities"><a href="#8-2-Create-activities" class="headerlink" title="8.2. Create activities"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#create-activities" target="_blank" rel="noopener">8.2. Create activities</a></h3><p>更改 activity_main.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/first"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"First"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/second"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Second"</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/third"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Third"</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建三个activity：</p>
<ul>
<li>RxJavaSimpleActivity</li>
<li>BooksActivity</li>
<li>ColorsActivity</li>
</ul>
<p>创建 activity_rxjavasimple.xml ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Server"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/toastbutton"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Toast"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/resultView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Result"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>RxJavaSimpleActivity</code> 里面创建一个<code>observable</code>用来模拟一个耗时操作（10s），然后返回一个数字5。通过一个button的点击事件来订阅。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.SystemClock;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.CompositeDisposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.schedulers.Schedulers;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxJavaSimpleActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RecyclerView colorListView;</span><br><span class="line">    SimpleStringAdapter simpleStringAdapter;</span><br><span class="line">    CompositeDisposable disposable = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> value =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Observable&lt;Integer&gt; serverDownloadObservable = Observable.create(emitter -&gt; &#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">10000</span>); <span class="comment">// simulate delay</span></span><br><span class="line">        emitter.onNext(<span class="number">5</span>);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_rxjavasimple);</span><br><span class="line">        View view = findViewById(R.id.button);</span><br><span class="line">        view.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            v.setEnabled(<span class="keyword">false</span>); <span class="comment">// disables the button until execution has finished</span></span><br><span class="line">            Disposable subscribe = serverDownloadObservable.</span><br><span class="line">                    observeOn(AndroidSchedulers.mainThread()).</span><br><span class="line">                    subscribeOn(Schedulers.io()).</span><br><span class="line">                    subscribe(integer -&gt; &#123;</span><br><span class="line">                        updateTheUserInterface(integer); <span class="comment">// this methods updates the ui</span></span><br><span class="line">                        v.setEnabled(<span class="keyword">true</span>); <span class="comment">// enables it again</span></span><br><span class="line">                    &#125;);</span><br><span class="line">            disposable.add(subscribe);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateTheUserInterface</span><span class="params">(<span class="keyword">int</span> integer)</span> </span>&#123;</span><br><span class="line">        TextView view = (TextView) findViewById(R.id.resultView);</span><br><span class="line">        view.setText(String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="keyword">if</span> (disposable!=<span class="keyword">null</span> &amp;&amp; !disposable.isDisposed()) &#123;</span><br><span class="line">            disposable.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"Still active "</span> + value++, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为RecycleView创建一个适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adapter used to map a String to a text view.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleStringAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">SimpleStringAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; mStrings = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleStringAdapter</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrings</span><span class="params">(List&lt;String&gt; newStrings)</span> </span>&#123;</span><br><span class="line">        mStrings.clear();</span><br><span class="line">        mStrings.addAll(newStrings);</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.string_list_item, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        holder.colorTextView.setText(mStrings.get(position));</span><br><span class="line">        holder.itemView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Toast.makeText(mContext, mStrings.get(position), Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mStrings.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> TextView colorTextView;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(view);</span><br><span class="line">            colorTextView = (TextView) view.findViewById(R.id.color_display);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <code>ColorsActivity</code> 使用<code>observable</code>来接收一系列的颜色值。</p>
<p>创建<code>activity_colors.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/color_list"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建<code>ColorsActivity.java</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.LinearLayoutManager;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorsActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    RecyclerView colorListView;</span><br><span class="line">    SimpleStringAdapter simpleStringAdapter;</span><br><span class="line">    <span class="keyword">private</span> Disposable disposable;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        configureLayout();</span><br><span class="line">        createObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Observable&lt;List&lt;String&gt;&gt; listObservable = Observable.just(getColorList());</span><br><span class="line">        disposable = listObservable.subscribe(colors -&gt; simpleStringAdapter.setStrings(colors));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setContentView(R.layout.activity_colors);</span><br><span class="line">        colorListView = (RecyclerView) findViewById(R.id.color_list);</span><br><span class="line">        colorListView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</span><br><span class="line">        simpleStringAdapter = <span class="keyword">new</span> SimpleStringAdapter(<span class="keyword">this</span>);</span><br><span class="line">        colorListView.setAdapter(simpleStringAdapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getColorList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; colors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        colors.add(<span class="string">"red"</span>);</span><br><span class="line">        colors.add(<span class="string">"green"</span>);</span><br><span class="line">        colors.add(<span class="string">"blue"</span>);</span><br><span class="line">        colors.add(<span class="string">"pink"</span>);</span><br><span class="line">        colors.add(<span class="string">"brown"</span>);</span><br><span class="line">        <span class="keyword">return</span> colors;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="keyword">if</span> (disposable!=<span class="keyword">null</span> &amp;&amp; !disposable.isDisposed()) &#123;</span><br><span class="line">            disposable.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现一个假的服务器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">ackage com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.SystemClock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This is a fake REST client.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It simulates making blocking calls to an REST endpoint.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RestClient</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getFavoriteBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">8000</span>);<span class="comment">// "Simulate" the delay of network.</span></span><br><span class="line">        <span class="keyword">return</span> createBooks();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getFavoriteBooksWithException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">8000</span>);<span class="comment">// "Simulate" the delay of network.</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failed to load"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">createBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        books.add(<span class="string">"Lord of the Rings"</span>);</span><br><span class="line">        books.add(<span class="string">"The dark elf"</span>);</span><br><span class="line">        books.add(<span class="string">"Eclipse Introduction"</span>);</span><br><span class="line">        books.add(<span class="string">"History book"</span>);</span><br><span class="line">        books.add(<span class="string">"Der kleine Prinz"</span>);</span><br><span class="line">        books.add(<span class="string">"7 habits of highly effective people"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 1"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 2"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 3"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 4"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 5"</span>);</span><br><span class="line">        books.add(<span class="string">"Other book 6"</span>);</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建<code>activity_books.xml</code> ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/loader"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/books_list"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建``BooksActivity.java `:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.LinearLayoutManager;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.ProgressBar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.schedulers.Schedulers;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Disposable bookSubscription;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView booksRecyclerView;</span><br><span class="line">    <span class="keyword">private</span> ProgressBar progressBar;</span><br><span class="line">    <span class="keyword">private</span> SimpleStringAdapter stringAdapter;</span><br><span class="line">    <span class="keyword">private</span> RestClient restClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        restClient = <span class="keyword">new</span> RestClient(<span class="keyword">this</span>);</span><br><span class="line">        configureLayout();</span><br><span class="line">        createObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Observable&lt;List&lt;String&gt;&gt; booksObservable =</span><br><span class="line">                Observable.fromCallable(() -&gt; restClient.getFavoriteBooks());</span><br><span class="line">        bookSubscription = booksObservable.</span><br><span class="line">                subscribeOn(Schedulers.io()).</span><br><span class="line">                observeOn(AndroidSchedulers.mainThread()).</span><br><span class="line">                subscribe(strings -&gt; displayBooks(strings));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">if</span> (bookSubscription != <span class="keyword">null</span> &amp;&amp; !bookSubscription.isDisposed()) &#123;</span><br><span class="line">            bookSubscription.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">displayBooks</span><span class="params">(List&lt;String&gt; books)</span> </span>&#123;</span><br><span class="line">        stringAdapter.setStrings(books);</span><br><span class="line">        progressBar.setVisibility(View.GONE);</span><br><span class="line">        booksRecyclerView.setVisibility(View.VISIBLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setContentView(R.layout.activity_books);</span><br><span class="line">        progressBar = (ProgressBar) findViewById(R.id.loader);</span><br><span class="line">        booksRecyclerView = (RecyclerView) findViewById(R.id.books_list);</span><br><span class="line">        booksRecyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</span><br><span class="line">        stringAdapter = <span class="keyword">new</span> SimpleStringAdapter(<span class="keyword">this</span>);</span><br><span class="line">        booksRecyclerView.setAdapter(stringAdapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="keyword">if</span> (bookSubscription!=<span class="keyword">null</span> &amp;&amp; !bookSubscription.isDisposed()) &#123;</span><br><span class="line">            bookSubscription.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于 lambdas 表达式，可以参阅：</p>
<p><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html</a></p>
<p>简直令人茅厕顿开。</p>
<h3 id="8-3-Implement-a-long-running-implementation-via-a-Callable"><a href="#8-3-Implement-a-long-running-implementation-via-a-Callable" class="headerlink" title="8.3. Implement a long running implementation via a Callable"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#implement-a-long-running-implementation-via-a-code-callable-code" target="_blank" rel="noopener">8.3. Implement a long running implementation via a <code>Callable</code></a></h3><p><code>java.util.Callable</code>与Runableb类似，不过它能抛出异常，并且返回一个值。</p>
<p>下面的一个<code>activity</code>实现了这样的一个功能：在订阅的时候显示一个进度条，一旦收到数据，立刻隐藏进读条，并且更新界面。</p>
<p>创建 <code>activity_scheduler.xml</code> ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/scheduleLongRunningOperation"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:lines</span>=<span class="string">"3"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Start something long"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"12dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/messagearea"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@+id/scheduleLongRunningOperation"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/progressBar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyle"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignBottom</span>=<span class="string">"@+id/scheduleLongRunningOperation"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/scheduleLongRunningOperation"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建<code>SchedulerActivity.java</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.SystemClock;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.ProgressBar;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.observers.DisposableObserver;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.schedulers.Schedulers;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Demonstrates a long running operation of the main thread</span></span><br><span class="line"><span class="comment"> * during which a  progressbar is shown</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchedulerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Disposable subscription;</span><br><span class="line">    <span class="keyword">private</span> ProgressBar progressBar;</span><br><span class="line">    <span class="keyword">private</span> TextView messagearea;</span><br><span class="line">    <span class="keyword">private</span> View button;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        configureLayout();</span><br><span class="line">        createObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">if</span> (subscription != <span class="keyword">null</span> &amp;&amp; !subscription.isDisposed()) &#123;</span><br><span class="line">            subscription.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setContentView(R.layout.activity_scheduler);</span><br><span class="line">        progressBar = (ProgressBar) findViewById(R.id.progressBar);</span><br><span class="line">        messagearea = (TextView) findViewById(R.id.messagearea);</span><br><span class="line">        button  = findViewById(R.id.scheduleLongRunningOperation);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"><span class="comment">//                progressBar.setVisibility(View.VISIBLE);</span></span><br><span class="line">                Observable.fromCallable(callable).</span><br><span class="line">                        subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).</span><br><span class="line">                        doOnSubscribe(disposable -&gt;</span><br><span class="line">                                &#123;</span><br><span class="line">                                    progressBar.setVisibility(View.VISIBLE);</span><br><span class="line">                                    button.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">                                    messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"Progressbar set visible"</span> );</span><br><span class="line">                                &#125;</span><br><span class="line">                        ).</span><br><span class="line">                        subscribe(getDisposableObserver());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Callable&lt;String&gt; callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> doSomethingLong();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSomethingLong</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Observer</span></span><br><span class="line"><span class="comment">     * Handles the stream of data:</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> DisposableObserver&lt;String&gt; <span class="title">getDisposableObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DisposableObserver&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"OnComplete"</span> );</span><br><span class="line">                progressBar.setVisibility(View.INVISIBLE);</span><br><span class="line">                button.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">                messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"Hidding Progressbar"</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"OnError"</span> );</span><br><span class="line">                progressBar.setVisibility(View.INVISIBLE);</span><br><span class="line">                button.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">                messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"Hidding Progressbar"</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">                messagearea.setText(messagearea.getText().toString() +<span class="string">"\n"</span> +<span class="string">"onNext "</span> + message );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-Testing-RxJava-Observables-and-Subscriptions"><a href="#9-Testing-RxJava-Observables-and-Subscriptions" class="headerlink" title="9. Testing RxJava Observables and Subscriptions"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#testing-rxjava-observables-and-subscriptions" target="_blank" rel="noopener">9. Testing RxJava Observables and Subscriptions</a></h2><h3 id="9-1-Testing-the-observables"><a href="#9-1-Testing-the-observables" class="headerlink" title="9.1. Testing the observables"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#testing-the-observables" target="_blank" rel="noopener">9.1. Testing the observables</a></h3><p><code>io.reactivex.subscribers.TestSubscriber</code>用来测试<code>Flowable</code>，<code>io.reactivex.observers.TestObserver</code>用来测试<code>Observable</code>,<code>Single</code>,<code>Maybe</code> 和 <code>Completable</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">anObservableStreamOfEventsAndDataShouldEmitsEachItemInOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">       Observable&lt;String&gt; pipelineOfData = Observable.just(<span class="string">"Foo"</span>, <span class="string">"Bar"</span>);</span><br><span class="line"></span><br><span class="line">       pipelineOfData.subscribe(testObserver);</span><br><span class="line"></span><br><span class="line">       List&lt;Object&gt; dataEmitted = testObserver.values();</span><br><span class="line">       assertThat(dataEmitted).hasSize(<span class="number">2</span>);</span><br><span class="line">       assertThat(dataEmitted).containsOnlyOnce(<span class="string">"Foo"</span>);</span><br><span class="line">       assertThat(dataEmitted).containsOnlyOnce(<span class="string">"Bar"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>所有基本响应类型都有一个 <code>test()</code> 方法，用起来超级方便。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TestSubscriber&lt;Integer&gt; ts = Flowable.range(<span class="number">1</span>, <span class="number">5</span>).test();</span><br><span class="line"></span><br><span class="line">TestObserver&lt;Integer&gt; to = Observable.range(<span class="number">1</span>, <span class="number">5</span>).test();</span><br><span class="line"></span><br><span class="line">TestObserver&lt;Integer&gt; tso = Single.just(<span class="number">1</span>).test();</span><br><span class="line"></span><br><span class="line">TestObserver&lt;Integer&gt; tmo = Maybe.just(<span class="number">1</span>).test();</span><br><span class="line"></span><br><span class="line">TestObserver&lt;Integer&gt; tco = Completable.complete().test();</span><br></pre></td></tr></table></figure>

<h2 id="10-Exercise-Writing-unit-tests-for-RxJava"><a href="#10-Exercise-Writing-unit-tests-for-RxJava" class="headerlink" title="10. Exercise: Writing unit tests for RxJava"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#exercise-writing-unit-tests-for-rxjava" target="_blank" rel="noopener">10. Exercise: Writing unit tests for RxJava</a></h2><h3 id="10-1-Write-small-unit-test"><a href="#10-1-Write-small-unit-test" class="headerlink" title="10.1. Write small unit test"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#write-small-unit-test" target="_blank" rel="noopener">10.1. Write small unit test</a></h3><p>使用RxJava写一个小的单元测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.vogella.android.rxjava.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.ObservableEmitter;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.ObservableOnSubscribe;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.observers.TestObserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> junit.framework.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxJavaUnitTest</span> </span>&#123;</span><br><span class="line">    String result=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Simple subscription to a fix value</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnAValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        result = <span class="string">""</span>;</span><br><span class="line">        Observable&lt;String&gt; observer = Observable.just(<span class="string">"Hello"</span>); <span class="comment">// provides datea</span></span><br><span class="line">        observer.subscribe(s -&gt; result=s); <span class="comment">// Callable as subscriber</span></span><br><span class="line">        assertTrue(result.equals(<span class="string">"Hello"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Observable&lt;Todo&gt; todoObservable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Todo&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Todo&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    List&lt;Todo&gt; todos = RxJavaUnitTest.<span class="keyword">this</span>.getTodos();</span><br><span class="line">                    <span class="keyword">if</span> (todos!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"todos was null"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> (Todo todo : todos) &#123;</span><br><span class="line">                        emitter.onNext(todo);</span><br><span class="line">                    &#125;</span><br><span class="line">                    emitter.onComplete();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    emitter.onError(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        TestObserver&lt;Object&gt; testObserver = <span class="keyword">new</span> TestObserver&lt;&gt;();</span><br><span class="line">        todoObservable.subscribeWith(testObserver);</span><br><span class="line">        testObserver.assertError(NullPointerException.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Todo&gt; <span class="title">getTodos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-RxJava-resources"><a href="#12-RxJava-resources" class="headerlink" title="12. RxJava resources"></a><a href="http://www.vogella.com/tutorials/RxJava/article.html#resources_rxjava" target="_blank" rel="noopener">12. RxJava resources</a></h2><p><a href="https://github.com/ReactiveX/RxJava/wiki/What%E2%80%99s-different-in-2.0" target="_blank" rel="noopener">RxJava 2.0 to 1.x comparison</a></p>
<p><a href="https://github.com/kaushikgopal/RxJava-Android-Samples" target="_blank" rel="noopener">Rx Java with Android Examples from Kaushik Gopal</a></p>
<p><a href="https://medium.com/@kurtisnusbaum/rxandroid-basics-part-1-c0d5edcf6850#.l74zr3mgh" target="_blank" rel="noopener">RxJava for Android</a></p>
<p><a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1" target="_blank" rel="noopener">Dan Lew’s Grokking with RxJava series</a></p>
<p><a href="https://github.com/tiwiz/RxAndroidCrunch" target="_blank" rel="noopener">Crunching RxAndroid blog series from Roberto Orgiu</a></p>
<p><a href="https://www.youtube.com/watch?v=htIXKI5gOQU" target="_blank" rel="noopener">GOTO 2016 • Exploring RxJava 2 for Android • Jake Wharton</a></p>
<p><a href="https://www.youtube.com/watch?v=hcxMtomE6fI&t=1934s" target="_blank" rel="noopener">Droidcon NYC 2016 - Looking Ahead to RxJava 2</a></p>
<p><a href="https://github.com/amitshekhariitbhu/RxJava2-Android-Samples" target="_blank" rel="noopener">RxJava 2.0 Examples for Android</a></p>

        
      </div>
      
      
      
    </div>
    

    
    
    
  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://github.com/aprz512/pic4aprz512/blob/master/Blog/avatar/avatar.jpeg?raw=true"
      alt="aprz512">
  <p class="site-author-name" itemprop="name">aprz512</p>
  <div class="site-description motion-element" itemprop="description">博客建于2017年02月05日21:39:56</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/aprz512" title="GitHub &rarr; https://github.com/aprz512" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>




        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Using-reactive-programming-with-RxJava-2-0"><span class="nav-number">1.</span> <span class="nav-text">1. Using reactive programming with RxJava 2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-What-is-RxJava-and-reactive-programming"><span class="nav-number">1.1.</span> <span class="nav-text">1.1. What is RxJava and reactive programming</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Build-blocks-for-RxJava"><span class="nav-number">2.</span> <span class="nav-text">2. Build blocks for RxJava</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Observables"><span class="nav-number">2.1.</span> <span class="nav-text">2.1. Observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Subscribers"><span class="nav-number">2.2.</span> <span class="nav-text">2.2. Subscribers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-RxJava-example"><span class="nav-number">3.</span> <span class="nav-text">3. RxJava example</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Why-doing-asynchronous-programming"><span class="nav-number">3.1.</span> <span class="nav-text">3.1. Why doing asynchronous programming</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Adding-RxJava-2-to-a-Java-project"><span class="nav-number">3.2.</span> <span class="nav-text">3.2. Adding RxJava 2 to a Java project</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Creating-Observables-subscribing-to-them-and-disposing-them"><span class="nav-number">4.</span> <span class="nav-text">4. Creating Observables, subscribing to them and disposing them</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Creating-observables"><span class="nav-number">4.1.</span> <span class="nav-text">4.1. Creating observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Convenience-methods-to-create-observables"><span class="nav-number">4.2.</span> <span class="nav-text">4.2. Convenience methods to create observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Subscribing-in-RxJava"><span class="nav-number">4.3.</span> <span class="nav-text">4.3. Subscribing in RxJava</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Disposing-subscriptions-and-using-CompositeDisposable"><span class="nav-number">4.4.</span> <span class="nav-text">4.4. Disposing subscriptions and using CompositeDisposable</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Caching-values-of-completed-observables"><span class="nav-number">5.</span> <span class="nav-text">5. Caching values of completed observables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Conversion-between-types"><span class="nav-number">6.</span> <span class="nav-text">6. Conversion between types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-RxAndroid"><span class="nav-number">7.</span> <span class="nav-text">7. RxAndroid</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Using-RxAndroid"><span class="nav-number">7.1.</span> <span class="nav-text">7.1. Using RxAndroid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Unsubscribe-to-avoid-memory-leaks"><span class="nav-number">7.2.</span> <span class="nav-text">7.2. Unsubscribe to avoid memory leaks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Exercise-First-steps-with-RxJava-and-RxAndroid"><span class="nav-number">8.</span> <span class="nav-text">8. Exercise: First steps with RxJava and RxAndroid</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-Gradle-dependencies"><span class="nav-number">8.1.</span> <span class="nav-text">8.1. Gradle dependencies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-Create-activities"><span class="nav-number">8.2.</span> <span class="nav-text">8.2. Create activities</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-Implement-a-long-running-implementation-via-a-Callable"><span class="nav-number">8.3.</span> <span class="nav-text">8.3. Implement a long running implementation via a Callable</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Testing-RxJava-Observables-and-Subscriptions"><span class="nav-number">9.</span> <span class="nav-text">9. Testing RxJava Observables and Subscriptions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-Testing-the-observables"><span class="nav-number">9.1.</span> <span class="nav-text">9.1. Testing the observables</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Exercise-Writing-unit-tests-for-RxJava"><span class="nav-number">10.</span> <span class="nav-text">10. Exercise: Writing unit tests for RxJava</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-Write-small-unit-test"><span class="nav-number">10.1.</span> <span class="nav-text">10.1. Write small unit test</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-RxJava-resources"><span class="nav-number">11.</span> <span class="nav-text">12. RxJava resources</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数"></span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长"></span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>
      <div class="reading-progress-bar"></div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>

<script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  

  


  
    <script src="/js/scrollspy.js?v=7.3.0"></script><script src="/js/post-details.js?v=7.3.0"></script>

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'g48OrtSq4q4MWp6EAEWbkAsT-gzGzoHsz',
    appKey: 'CXW8M63QPXbQ9qKMgHDy9Be2',
    placeholder: '说点什么吧',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
